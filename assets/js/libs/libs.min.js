function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=_superPropBase(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,i=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){var t=e.noise={};function n(e,t,n){this.x=e,this.y=t,this.z=n}n.prototype.dot2=function(e,t){return this.x*e+this.y*t},n.prototype.dot3=function(e,t,n){return this.x*e+this.y*t+this.z*n};var i=[new n(1,1,0),new n(-1,1,0),new n(1,-1,0),new n(-1,-1,0),new n(1,0,1),new n(-1,0,1),new n(1,0,-1),new n(-1,0,-1),new n(0,1,1),new n(0,-1,1),new n(0,1,-1),new n(0,-1,-1)],r=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],s=new Array(512),a=new Array(512);t.seed=function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var n;n=1&t?r[t]^255&e:r[t]^e>>8&255,s[t]=s[t+256]=n,a[t]=a[t+256]=i[n%12]}},t.seed(0);var o=.5*(Math.sqrt(3)-1),l=(3-Math.sqrt(3))/6,u=1/6;function c(e){return e*e*e*(e*(6*e-15)+10)}function h(e,t,n){return(1-n)*e+n*t}t.simplex2=function(e,t){var n,i,r=(e+t)*o,u=Math.floor(e+r),c=Math.floor(t+r),h=(u+c)*l,d=e-u+h,f=t-c+h;d>f?(n=1,i=0):(n=0,i=1);var p=d-n+l,m=f-i+l,g=d-1+2*l,v=f-1+2*l,y=a[(u&=255)+s[c&=255]],b=a[u+n+s[c+i]],_=a[u+1+s[c+1]],x=.5-d*d-f*f,w=.5-p*p-m*m,k=.5-g*g-v*v;return 70*((x<0?0:(x*=x)*x*y.dot2(d,f))+(w<0?0:(w*=w)*w*b.dot2(p,m))+(k<0?0:(k*=k)*k*_.dot2(g,v)))},t.simplex3=function(e,t,n){var i,r,o,l,c,h,d=(e+t+n)*(1/3),f=Math.floor(e+d),p=Math.floor(t+d),m=Math.floor(n+d),g=(f+p+m)*u,v=e-f+g,y=t-p+g,b=n-m+g;v>=y?y>=b?(i=1,r=0,o=0,l=1,c=1,h=0):v>=b?(i=1,r=0,o=0,l=1,c=0,h=1):(i=0,r=0,o=1,l=1,c=0,h=1):y<b?(i=0,r=0,o=1,l=0,c=1,h=1):v<b?(i=0,r=1,o=0,l=0,c=1,h=1):(i=0,r=1,o=0,l=1,c=1,h=0);var _=v-i+u,x=y-r+u,w=b-o+u,k=v-l+2*u,T=y-c+2*u,E=b-h+2*u,P=v-1+.5,S=y-1+.5,C=b-1+.5,R=a[(f&=255)+s[(p&=255)+s[m&=255]]],A=a[f+i+s[p+r+s[m+o]]],M=a[f+l+s[p+c+s[m+h]]],O=a[f+1+s[p+1+s[m+1]]],L=.6-v*v-y*y-b*b,F=.6-_*_-x*x-w*w,D=.6-k*k-T*T-E*E,I=.6-P*P-S*S-C*C;return 32*((L<0?0:(L*=L)*L*R.dot3(v,y,b))+(F<0?0:(F*=F)*F*A.dot3(_,x,w))+(D<0?0:(D*=D)*D*M.dot3(k,T,E))+(I<0?0:(I*=I)*I*O.dot3(P,S,C)))},t.perlin2=function(e,t){var n=Math.floor(e),i=Math.floor(t);e-=n,t-=i;var r=a[(n&=255)+s[i&=255]].dot2(e,t),o=a[n+s[i+1]].dot2(e,t-1),l=a[n+1+s[i]].dot2(e-1,t),u=a[n+1+s[i+1]].dot2(e-1,t-1),d=c(e);return h(h(r,l,d),h(o,u,d),c(t))},t.perlin3=function(e,t,n){var i=Math.floor(e),r=Math.floor(t),o=Math.floor(n);e-=i,t-=r,n-=o;var l=a[(i&=255)+s[(r&=255)+s[o&=255]]].dot3(e,t,n),u=a[i+s[r+s[o+1]]].dot3(e,t,n-1),d=a[i+s[r+1+s[o]]].dot3(e,t-1,n),f=a[i+s[r+1+s[o+1]]].dot3(e,t-1,n-1),p=a[i+1+s[r+s[o]]].dot3(e-1,t,n),m=a[i+1+s[r+s[o+1]]].dot3(e-1,t,n-1),g=a[i+1+s[r+1+s[o]]].dot3(e-1,t-1,n),v=a[i+1+s[r+1+s[o+1]]].dot3(e-1,t-1,n-1),y=c(e),b=c(t),_=c(n);return h(h(h(l,p,y),h(u,m,y),_),h(h(d,g,y),h(f,v,y),_),b)}}(this),THREE.OrbitControls=function(e,t){var n,i,r,s,a;this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return p.phi},this.getAzimuthalAngle=function(){return p.theta},this.saveState=function(){o.target0.copy(o.target),o.position0.copy(o.object.position),o.zoom0=o.object.zoom},this.reset=function(){o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.zoom=o.zoom0,o.object.updateProjectionMatrix(),o.dispatchEvent(l),o.update(),d=h.NONE},this.update=(n=new THREE.Vector3,i=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),r=i.clone().inverse(),s=new THREE.Vector3,a=new THREE.Quaternion,function(){var e=o.object.position;return n.copy(e).sub(o.target),n.applyQuaternion(i),p.setFromVector3(n),o.autoRotate&&d===h.NONE&&R(2*Math.PI/60/60*o.autoRotateSpeed),p.theta+=m.theta,p.phi+=m.phi,p.theta=Math.max(o.minAzimuthAngle,Math.min(o.maxAzimuthAngle,p.theta)),p.phi=Math.max(o.minPolarAngle,Math.min(o.maxPolarAngle,p.phi)),p.makeSafe(),p.radius*=g,p.radius=Math.max(o.minDistance,Math.min(o.maxDistance,p.radius)),o.target.add(v),n.setFromSpherical(p),n.applyQuaternion(r),e.copy(o.target).add(n),o.object.lookAt(o.target),!0===o.enableDamping?(m.theta*=1-o.dampingFactor,m.phi*=1-o.dampingFactor):m.set(0,0,0),g=1,v.set(0,0,0),!!(y||s.distanceToSquared(o.object.position)>f||8*(1-a.dot(o.object.quaternion))>f)&&(o.dispatchEvent(l),s.copy(o.object.position),a.copy(o.object.quaternion),y=!1,!0)}),this.dispose=function(){o.domElement.removeEventListener("contextmenu",q,!1),o.domElement.removeEventListener("mousedown",N,!1),o.domElement.removeEventListener("wheel",V,!1),o.domElement.removeEventListener("touchstart",j,!1),o.domElement.removeEventListener("touchend",W,!1),o.domElement.removeEventListener("touchmove",H,!1),document.removeEventListener("mousemove",z,!1),document.removeEventListener("mouseup",U,!1),window.removeEventListener("keydown",B,!1)};var o=this,l={type:"change"},u={type:"start"},c={type:"end"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},d=h.NONE,f=1e-6,p=new THREE.Spherical,m=new THREE.Spherical,g=1,v=new THREE.Vector3,y=!1,b=new THREE.Vector2,_=new THREE.Vector2,x=new THREE.Vector2,w=new THREE.Vector2,k=new THREE.Vector2,T=new THREE.Vector2,E=new THREE.Vector2,P=new THREE.Vector2,S=new THREE.Vector2;function C(){return Math.pow(.95,o.zoomSpeed)}function R(e){m.theta-=e}function A(e){m.phi-=e}var M,O=(M=new THREE.Vector3,function(e,t){M.setFromMatrixColumn(t,0),M.multiplyScalar(-e),v.add(M)}),L=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,1),e.multiplyScalar(t),v.add(e)}}(),F=function(){var e=new THREE.Vector3;return function(t,n){var i=o.domElement===document?o.domElement.body:o.domElement;if(o.object.isPerspectiveCamera){var r=o.object.position;e.copy(r).sub(o.target);var s=e.length();s*=Math.tan(o.object.fov/2*Math.PI/180),O(2*t*s/i.clientHeight,o.object.matrix),L(2*n*s/i.clientHeight,o.object.matrix)}else o.object.isOrthographicCamera?(O(t*(o.object.right-o.object.left)/o.object.zoom/i.clientWidth,o.object.matrix),L(n*(o.object.top-o.object.bottom)/o.object.zoom/i.clientHeight,o.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),o.enablePan=!1)}}();function D(e){o.object.isPerspectiveCamera?g/=e:o.object.isOrthographicCamera?(o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom*e)),o.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),o.enableZoom=!1)}function I(e){o.object.isPerspectiveCamera?g*=e:o.object.isOrthographicCamera?(o.object.zoom=Math.max(o.minZoom,Math.min(o.maxZoom,o.object.zoom/e)),o.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),o.enableZoom=!1)}function N(e){if(!1!==o.enabled){switch(e.preventDefault(),e.button){case o.mouseButtons.ORBIT:if(!1===o.enableRotate)return;!function(e){b.set(e.clientX,e.clientY)}(e),d=h.ROTATE;break;case o.mouseButtons.ZOOM:if(!1===o.enableZoom)return;!function(e){E.set(e.clientX,e.clientY)}(e),d=h.DOLLY;break;case o.mouseButtons.PAN:if(!1===o.enablePan)return;!function(e){w.set(e.clientX,e.clientY)}(e),d=h.PAN}d!==h.NONE&&(document.addEventListener("mousemove",z,!1),document.addEventListener("mouseup",U,!1),o.dispatchEvent(u))}}function z(e){if(!1!==o.enabled)switch(e.preventDefault(),d){case h.ROTATE:if(!1===o.enableRotate)return;!function(e){_.set(e.clientX,e.clientY),x.subVectors(_,b);var t=o.domElement===document?o.domElement.body:o.domElement;R(2*Math.PI*x.x/t.clientWidth*o.rotateSpeed),A(2*Math.PI*x.y/t.clientHeight*o.rotateSpeed),b.copy(_),o.update()}(e);break;case h.DOLLY:if(!1===o.enableZoom)return;!function(e){P.set(e.clientX,e.clientY),S.subVectors(P,E),S.y>0?D(C()):S.y<0&&I(C()),E.copy(P),o.update()}(e);break;case h.PAN:if(!1===o.enablePan)return;!function(e){k.set(e.clientX,e.clientY),T.subVectors(k,w),F(T.x,T.y),w.copy(k),o.update()}(e)}}function U(e){!1!==o.enabled&&(document.removeEventListener("mousemove",z,!1),document.removeEventListener("mouseup",U,!1),o.dispatchEvent(c),d=h.NONE)}function V(e){!1===o.enabled||!1===o.enableZoom||d!==h.NONE&&d!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),function(e){e.deltaY<0?I(C()):e.deltaY>0&&D(C()),o.update()}(e),o.dispatchEvent(u),o.dispatchEvent(c))}function B(e){!1!==o.enabled&&!1!==o.enableKeys&&!1!==o.enablePan&&function(e){switch(e.keyCode){case o.keys.UP:F(0,o.keyPanSpeed),o.update();break;case o.keys.BOTTOM:F(0,-o.keyPanSpeed),o.update();break;case o.keys.LEFT:F(o.keyPanSpeed,0),o.update();break;case o.keys.RIGHT:F(-o.keyPanSpeed,0),o.update()}}(e)}function j(e){if(!1!==o.enabled){switch(e.touches.length){case 1:if(!1===o.enableRotate)return;!function(e){b.set(e.touches[0].pageX,e.touches[0].pageY)}(e),d=h.TOUCH_ROTATE;break;case 2:if(!1===o.enableZoom)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);E.set(0,i)}(e),d=h.TOUCH_DOLLY;break;case 3:if(!1===o.enablePan)return;!function(e){w.set(e.touches[0].pageX,e.touches[0].pageY)}(e),d=h.TOUCH_PAN;break;default:d=h.NONE}d!==h.NONE&&o.dispatchEvent(u)}}function H(e){if(!1!==o.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===o.enableRotate)return;if(d!==h.TOUCH_ROTATE)return;!function(e){_.set(e.touches[0].pageX,e.touches[0].pageY),x.subVectors(_,b);var t=o.domElement===document?o.domElement.body:o.domElement;R(2*Math.PI*x.x/t.clientWidth*o.rotateSpeed),A(2*Math.PI*x.y/t.clientHeight*o.rotateSpeed),b.copy(_),o.update()}(e);break;case 2:if(!1===o.enableZoom)return;if(d!==h.TOUCH_DOLLY)return;!function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+n*n);P.set(0,i),S.subVectors(P,E),S.y>0?I(C()):S.y<0&&D(C()),E.copy(P),o.update()}(e);break;case 3:if(!1===o.enablePan)return;if(d!==h.TOUCH_PAN)return;!function(e){k.set(e.touches[0].pageX,e.touches[0].pageY),T.subVectors(k,w),F(T.x,T.y),w.copy(k),o.update()}(e);break;default:d=h.NONE}}function W(e){!1!==o.enabled&&(o.dispatchEvent(c),d=h.NONE)}function q(e){!1!==o.enabled&&e.preventDefault()}o.domElement.addEventListener("contextmenu",q,!1),o.domElement.addEventListener("mousedown",N,!1),o.domElement.addEventListener("wheel",V,!1),o.domElement.addEventListener("touchstart",j,!1),o.domElement.addEventListener("touchend",W,!1),o.domElement.addEventListener("touchmove",H,!1),window.addEventListener("keydown",B,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}}),function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).window=e.window||{})}(this,function(e){"use strict";var t=0;function n(){if(!(t>100)){if(100===t)console.warn("Curtains: too many warnings thrown, stop logging.");else{var e=Array.prototype.slice.call(arguments);console.warn.apply(console,e)}t++}}function i(){var e=Array.prototype.slice.call(arguments);console.error.apply(console,e)}function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16).toUpperCase()})}function s(e){return 0==(e&e-1)}var a=function(){function e(t){if(_classCallCheck(this,e),this.type="Scene",t&&"Renderer"===t.type){if(!t.gl)return void i(this.type+": Renderer WebGL context is undefined",t)}else i(this.type+": Renderer not passed as first argument",t);this.renderer=t,this.gl=t.gl,this.initStacks()}return _createClass(e,[{key:"initStacks",value:function(){this.stacks={pingPong:[],renderTargets:[],opaque:[],transparent:[],renderPasses:[],scenePasses:[]}}},{key:"resetPlaneStacks",value:function(){this.stacks.pingPong=[],this.stacks.renderTargets=[],this.stacks.opaque=[],this.stacks.transparent=[];for(var e=0;e<this.renderer.planes.length;e++)this.addPlane(this.renderer.planes[e])}},{key:"resetShaderPassStacks",value:function(){this.stacks.scenePasses=[],this.stacks.renderPasses=[];for(var e=0;e<this.renderer.shaderPasses.length;e++)this.renderer.shaderPasses[e].index=e,this.renderer.shaderPasses[e]._isScenePass?this.stacks.scenePasses.push(this.renderer.shaderPasses[e]):this.stacks.renderPasses.push(this.renderer.shaderPasses[e]);0===this.stacks.scenePasses.length&&(this.renderer.state.scenePassIndex=null)}},{key:"addToRenderTargetsStack",value:function(e){var t=this.renderer.planes.filter(function(t){return"PingPongPlane"!==t.type&&t.target&&t.uuid!==e.uuid}),n=-1;if(e.target._depth){for(var i=t.length-1;i>=0;i--)if(t[i].target.uuid===e.target.uuid){n=i+1;break}}else n=t.findIndex(function(t){return t.target.uuid===e.target.uuid});n=Math.max(0,n),t.splice(n,0,e),e.target._depth?(t.sort(function(e,t){return e.index-t.index}),t.sort(function(e,t){return t.renderOrder-e.renderOrder})):(t.sort(function(e,t){return t.index-e.index}),t.sort(function(e,t){return e.renderOrder-t.renderOrder})),t.sort(function(e,t){return e.target.index-t.target.index}),this.stacks.renderTargets=t}},{key:"addToRegularPlaneStack",value:function(e){for(var t=this.renderer.planes.filter(function(t){return"PingPongPlane"!==t.type&&!t.target&&t._transparent===e._transparent&&t.uuid!==e.uuid}),n=-1,i=t.length-1;i>=0;i--)if(t[i]._geometry.definition.id===e._geometry.definition.id){n=i+1;break}return n=Math.max(0,n),t.splice(n,0,e),t.sort(function(e,t){return e.index-t.index}),t}},{key:"addPlane",value:function(e){if("PingPongPlane"===e.type)this.stacks.pingPong.push(e);else if(e.target)this.addToRenderTargetsStack(e);else if(e._transparent){var t=this.addToRegularPlaneStack(e);t.sort(function(e,t){return t.relativeTranslation.z-e.relativeTranslation.z}),t.sort(function(e,t){return t.renderOrder-e.renderOrder}),this.stacks.transparent=t}else{var n=this.addToRegularPlaneStack(e);n.sort(function(e,t){return t.renderOrder-e.renderOrder}),this.stacks.opaque=n}}},{key:"removePlane",value:function(e){"PingPongPlane"===e.type?this.stacks.pingPong=this.stacks.pingPong.filter(function(t){return t.uuid!==e.uuid}):e.target?this.stacks.renderTargets=this.stacks.renderTargets.filter(function(t){return t.uuid!==e.uuid}):e._transparent?this.stacks.transparent=this.stacks.transparent.filter(function(t){return t.uuid!==e.uuid}):this.stacks.opaque=this.stacks.opaque.filter(function(t){return t.uuid!==e.uuid})}},{key:"setPlaneRenderOrder",value:function(e){if("ShaderPass"===e.type)this.sortShaderPassStack(e._isScenePass?this.stacks.scenePasses:this.stacks.renderPasses);else if("PingPongPlane"===e.type)return;if(e.target)e.target._depth?(this.stacks.renderTargets.sort(function(e,t){return e.index-t.index}),this.stacks.renderTargets.sort(function(e,t){return t.renderOrder-e.renderOrder})):(this.stacks.renderTargets.sort(function(e,t){return t.index-e.index}),this.stacks.renderTargets.sort(function(e,t){return e.renderOrder-t.renderOrder})),this.stacks.renderTargets.sort(function(e,t){return e.target.index-t.target.index});else{var t=e._transparent?this.stacks.transparent:this.stacks.opaque,n=this.stacks.scenePasses.find(function(e,t){return e._isScenePass&&!e._depth&&0===t});!this.renderer.depth||n?(t.sort(function(e,t){return t.index-e.index}),e._transparent&&t.sort(function(e,t){return e.relativeTranslation.z-t.relativeTranslation.z}),t.sort(function(e,t){return e.renderOrder-t.renderOrder})):(t.sort(function(e,t){return e.index-t.index}),e._transparent&&t.sort(function(e,t){return t.relativeTranslation.z-e.relativeTranslation.z}),t.sort(function(e,t){return t.renderOrder-e.renderOrder}))}}},{key:"addShaderPass",value:function(e){e._isScenePass?(this.stacks.scenePasses.push(e),this.sortShaderPassStack(this.stacks.scenePasses)):(this.stacks.renderPasses.push(e),this.sortShaderPassStack(this.stacks.renderPasses))}},{key:"removeShaderPass",value:function(e){this.resetShaderPassStacks()}},{key:"sortShaderPassStack",value:function(e){e.sort(function(e,t){return e.index-t.index}),e.sort(function(e,t){return e.renderOrder-t.renderOrder})}},{key:"enableShaderPass",value:function(){this.stacks.scenePasses.length&&0===this.stacks.renderPasses.length&&this.renderer.planes.length&&(this.renderer.state.scenePassIndex=0,this.renderer.bindFrameBuffer(this.stacks.scenePasses[0].target))}},{key:"drawRenderPasses",value:function(){this.stacks.scenePasses.length&&this.stacks.renderPasses.length&&this.renderer.planes.length&&(this.renderer.state.scenePassIndex=0,this.renderer.bindFrameBuffer(this.stacks.scenePasses[0].target));for(var e=0;e<this.stacks.renderPasses.length;e++)this.stacks.renderPasses[e]._startDrawing(),this.renderer.clearDepth()}},{key:"drawScenePasses",value:function(){for(var e=0;e<this.stacks.scenePasses.length;e++)this.stacks.scenePasses[e]._startDrawing()}},{key:"drawPingPongStack",value:function(){for(var e=0;e<this.stacks.pingPong.length;e++){var t=this.stacks.pingPong[e];t&&t._startDrawing()}}},{key:"drawStack",value:function(e){for(var t=0;t<this.stacks[e].length;t++){var n=this.stacks[e][t];n&&n._startDrawing()}}},{key:"draw",value:function(){this.drawPingPongStack(),this.enableShaderPass(),this.drawStack("renderTargets"),this.drawRenderPasses(),this.renderer.setBlending(!1),this.drawStack("opaque"),this.stacks.transparent.length&&(this.renderer.setBlending(!0),this.drawStack("transparent")),this.drawScenePasses()}}]),e}(),o=function(){function e(){_classCallCheck(this,e),this.geometries=[],this.clear()}return _createClass(e,[{key:"clear",value:function(){this.textures=[],this.programs=[]}},{key:"getGeometryFromID",value:function(e){return this.geometries.find(function(t){return t.id===e})}},{key:"addGeometry",value:function(e,t,n){this.geometries.push({id:e,vertices:t,uvs:n})}},{key:"isSameShader",value:function(e,t){return 0===e.localeCompare(t)}},{key:"getProgramFromShaders",value:function(e,t){var n=this;return this.programs.find(function(i){return n.isSameShader(i.vsCode,e)&&n.isSameShader(i.fsCode,t)})}},{key:"addProgram",value:function(e){this.programs.push(e)}},{key:"getTextureFromSource",value:function(e){var t="string"==typeof e?e:e.src;return this.textures.find(function(e){return e.source&&e.source.src===t})}},{key:"addTexture",value:function(e){this.getTextureFromSource(e.source)||this.textures.push(e)}},{key:"removeTexture",value:function(e){this.textures=this.textures.filter(function(t){return t.uuid!==e.uuid})}}]),e}(),l=function(){function e(){_classCallCheck(this,e),this.clear()}return _createClass(e,[{key:"clear",value:function(){this.queue=[]}},{key:"add",value:function(e){var t=this,n={callback:e,keep:arguments.length>1&&void 0!==arguments[1]&&arguments[1],timeout:null};return n.timeout=setTimeout(function(){t.queue.push(n)},0),n}},{key:"execute",value:function(){var e=this;this.queue.map(function(t){t.callback&&t.callback(),clearTimeout(e.queue.timeout)}),this.queue=this.queue.filter(function(e){return e.keep})}}]),e}(),u=function(){function e(t){var i=t.alpha,r=t.antialias,s=t.premultipliedAlpha,a=t.depth,o=t.failIfMajorPerformanceCaveat,l=t.preserveDrawingBuffer,u=t.stencil,c=t.container,h=t.pixelRatio,d=t.renderingScale,f=t.production,p=t.onError,m=t.onSuccess,g=t.onContextLost,v=t.onContextRestored,y=t.onDisposed,b=t.onSceneChange;_classCallCheck(this,e),this.type="Renderer",this.alpha=i,this.antialias=r,this.premultipliedAlpha=s,this.depth=a,this.failIfMajorPerformanceCaveat=o,this.preserveDrawingBuffer=l,this.stencil=u,this.container=c,this.pixelRatio=h,this._renderingScale=d,this.production=f,this.onError=p,this.onSuccess=m,this.onContextLost=g,this.onContextRestored=v,this.onDisposed=y,this.onSceneChange=b,this.initState(),this.canvas=document.createElement("canvas");var _={alpha:this.alpha,premultipliedAlpha:this.premultipliedAlpha,antialias:this.antialias,depth:this.depth,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,stencil:this.stencil};if(this.gl=this.canvas.getContext("webgl2",_),this._isWebGL2=!!this.gl,this.gl||(this.gl=this.canvas.getContext("webgl",_)||this.canvas.getContext("experimental-webgl",_)),!this.gl)return this.production||n(this.type+": WebGL context could not be created"),this.state.isActive=!1,void(this.onError&&this.onError());this.onSuccess&&this.onSuccess(),this.initRenderer()}return _createClass(e,[{key:"initState",value:function(){this.state={isActive:!0,isContextLost:!0,drawingEnabled:!0,forceRender:!1,currentProgramID:null,currentGeometryID:null,forceBufferUpdate:!1,depthTest:null,blending:null,cullFace:null,frameBufferID:null,scenePassIndex:null,activeTexture:null,unpackAlignment:null,flipY:null,premultiplyAlpha:null}}},{key:"initCallbackQueueManager",value:function(){this.nextRender=new l}},{key:"initRenderer",value:function(){this.planes=[],this.renderTargets=[],this.shaderPasses=[],this.state.isContextLost=!1,this.initCallbackQueueManager(),this.setBlendFunc(),this.setDepthFunc(),this.setDepthTest(!0),this.cache=new o,this.scene=new a(this),this.getExtensions(),this._contextLostHandler=this.contextLost.bind(this),this.canvas.addEventListener("webglcontextlost",this._contextLostHandler,!1),this._contextRestoredHandler=this.contextRestored.bind(this),this.canvas.addEventListener("webglcontextrestored",this._contextRestoredHandler,!1)}},{key:"getExtensions",value:function(){this.extensions=[],this._isWebGL2?(this.extensions.EXT_color_buffer_float=this.gl.getExtension("EXT_color_buffer_float"),this.extensions.OES_texture_float_linear=this.gl.getExtension("OES_texture_float_linear"),this.extensions.EXT_texture_filter_anisotropic=this.gl.getExtension("EXT_texture_filter_anisotropic"),this.extensions.WEBGL_lose_context=this.gl.getExtension("WEBGL_lose_context")):(this.extensions.OES_vertex_array_object=this.gl.getExtension("OES_vertex_array_object"),this.extensions.OES_texture_float=this.gl.getExtension("OES_texture_float"),this.extensions.OES_texture_float_linear=this.gl.getExtension("OES_texture_float_linear"),this.extensions.OES_texture_half_float=this.gl.getExtension("OES_texture_half_float"),this.extensions.OES_texture_half_float_linear=this.gl.getExtension("OES_texture_half_float_linear"),this.extensions.EXT_texture_filter_anisotropic=this.gl.getExtension("EXT_texture_filter_anisotropic"),this.extensions.OES_element_index_uint=this.gl.getExtension("OES_element_index_uint"),this.extensions.OES_standard_derivatives=this.gl.getExtension("OES_standard_derivatives"),this.extensions.EXT_sRGB=this.gl.getExtension("EXT_sRGB"),this.extensions.WEBGL_depth_texture=this.gl.getExtension("WEBGL_depth_texture"),this.extensions.WEBGL_draw_buffers=this.gl.getExtension("WEBGL_draw_buffers"),this.extensions.WEBGL_lose_context=this.gl.getExtension("WEBGL_lose_context"))}},{key:"contextLost",value:function(e){var t=this;this.state.isContextLost=!0,this.state.isActive&&(e.preventDefault(),this.nextRender.add(function(){return t.onContextLost&&t.onContextLost()}))}},{key:"restoreContext",value:function(){this.state.isActive&&(this.initState(),this.gl&&this.extensions.WEBGL_lose_context?this.extensions.WEBGL_lose_context.restoreContext():(this.gl||this.production?this.extensions.WEBGL_lose_context||this.production||n(this.type+": Could not restore the context because the restore context extension is not defined"):n(this.type+": Could not restore the context because the context is not defined"),this.onError&&this.onError()))}},{key:"isContextexFullyRestored",value:function(){for(var e=!0,t=0;t<this.renderTargets.length;t++){this.renderTargets[t].textures[0]._canDraw||(e=!1);break}if(e)for(var n=0;n<this.planes.length;n++){if(!this.planes[n]._canDraw){e=!1;break}for(var i=0;i<this.planes[n].textures.length;i++)if(!this.planes[n].textures[i]._canDraw){e=!1;break}}if(e)for(var r=0;r<this.shaderPasses.length;r++){if(!this.shaderPasses[r]._canDraw){e=!1;break}for(var s=0;s<this.shaderPasses[r].textures.length;s++)if(!this.shaderPasses[r].textures[s]._canDraw){e=!1;break}}return e}},{key:"contextRestored",value:function(){var e=this;this.getExtensions(),this.setBlendFunc(),this.setDepthFunc(),this.setDepthTest(!0),this.cache.clear(),this.scene.initStacks();for(var t=0;t<this.renderTargets.length;t++)this.renderTargets[t]._restoreContext();for(var n=0;n<this.planes.length;n++)this.planes[n]._restoreContext();for(var i=0;i<this.shaderPasses.length;i++)this.shaderPasses[i]._restoreContext();var r=this.nextRender.add(function(){e.isContextexFullyRestored()&&(r.keep=!1,e.state.isContextLost=!1,e.onContextRestored&&e.onContextRestored(),e.onSceneChange(),e.needRender())},!0)}},{key:"setPixelRatio",value:function(e){this.pixelRatio=e}},{key:"setSize",value:function(){if(this.gl){var e=this.container.getBoundingClientRect();this._boundingRect={width:e.width*this.pixelRatio,height:e.height*this.pixelRatio,top:e.top*this.pixelRatio,left:e.left*this.pixelRatio};var t=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/),n=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;t&&n&&(this._boundingRect.top=function(e){for(var t=0;e&&!isNaN(e.offsetTop);)t+=e.offsetTop-e.scrollTop,e=e.offsetParent;return t}(this.container)*this.pixelRatio),this.canvas.style.width=Math.floor(this._boundingRect.width/this.pixelRatio)+"px",this.canvas.style.height=Math.floor(this._boundingRect.height/this.pixelRatio)+"px",this.canvas.width=Math.floor(this._boundingRect.width*this._renderingScale),this.canvas.height=Math.floor(this._boundingRect.height*this._renderingScale),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}}},{key:"resize",value:function(){for(var e=0;e<this.planes.length;e++)this.planes[e]._canDraw&&this.planes[e].resize();for(var t=0;t<this.shaderPasses.length;t++)this.shaderPasses[t]._canDraw&&this.shaderPasses[t].resize();for(var n=0;n<this.renderTargets.length;n++)this.renderTargets[n].resize();this.needRender()}},{key:"clear",value:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}},{key:"clearDepth",value:function(){this.gl.clear(this.gl.DEPTH_BUFFER_BIT)}},{key:"clearColor",value:function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}},{key:"bindFrameBuffer",value:function(e,t){var n=null;e?(n=e.index)!==this.state.frameBufferID&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e._frameBuffer),this.gl.viewport(0,0,e._size.width,e._size.height),e._shouldClear&&!t&&this.clear()):null!==this.state.frameBufferID&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)),this.state.frameBufferID=n}},{key:"setDepthTest",value:function(e){e&&!this.state.depthTest?(this.state.depthTest=e,this.gl.enable(this.gl.DEPTH_TEST)):!e&&this.state.depthTest&&(this.state.depthTest=e,this.gl.disable(this.gl.DEPTH_TEST))}},{key:"setDepthFunc",value:function(){this.gl.depthFunc(this.gl.LEQUAL)}},{key:"setBlending",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&!this.state.blending?(this.state.blending=e,this.gl.enable(this.gl.BLEND)):!e&&this.state.blending&&(this.state.blending=e,this.gl.disable(this.gl.BLEND))}},{key:"setBlendFunc",value:function(){this.gl.enable(this.gl.BLEND),this.premultipliedAlpha?this.gl.blendFuncSeparate(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)}},{key:"setFaceCulling",value:function(e){if(this.state.cullFace!==e)if(this.state.cullFace=e,"none"===e)this.gl.disable(this.gl.CULL_FACE);else{var t="front"===e?this.gl.FRONT:this.gl.BACK;this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(t)}}},{key:"useProgram",value:function(e){null!==this.state.currentProgramID&&this.state.currentProgramID===e.id||(this.gl.useProgram(e.program),this.state.currentProgramID=e.id)}},{key:"removePlane",value:function(e){this.gl&&(this.planes=this.planes.filter(function(t){return t.uuid!==e.uuid}),this.scene.removePlane(e),e=null,this.gl&&this.clear(),this.onSceneChange())}},{key:"removeRenderTarget",value:function(e){if(this.gl){for(var t=this.planes.find(function(t){return"PingPongPlane"!==t.type&&t.target&&t.target.uuid===e.uuid}),n=0;n<this.planes.length;n++)this.planes[n].target&&this.planes[n].target.uuid===e.uuid&&(this.planes[n].target=null);this.renderTargets=this.renderTargets.filter(function(t){return t.uuid!==e.uuid});for(var i=0;i<this.renderTargets.length;i++)this.renderTargets[i].index=i;e=null,this.gl&&this.clear(),t&&this.scene.resetPlaneStacks(),this.onSceneChange()}}},{key:"removeShaderPass",value:function(e){this.gl&&(this.shaderPasses=this.shaderPasses.filter(function(t){return t.uuid!==e.uuid}),this.scene.removeShaderPass(e),e=null,this.gl&&this.clear(),this.onSceneChange())}},{key:"enableDrawing",value:function(){this.state.drawingEnabled=!0}},{key:"disableDrawing",value:function(){this.state.drawingEnabled=!1}},{key:"needRender",value:function(){this.state.forceRender=!0}},{key:"render",value:function(){this.gl&&(this.clear(),this.state.currentGeometryID=null,this.scene.draw())}},{key:"deletePrograms",value:function(){for(var e=0;e<this.cache.programs.length;e++){var t=this.cache.programs[e];this.gl.deleteProgram(t.program)}}},{key:"dispose",value:function(){var e=this;if(this.gl){for(this.state.isActive=!1;this.planes.length>0;)this.removePlane(this.planes[0]);for(;this.shaderPasses.length>0;)this.removeShaderPass(this.shaderPasses[0]);for(;this.renderTargets.length>0;)this.removeRenderTarget(this.renderTargets[0]);var t=this.nextRender.add(function(){0===e.planes.length&&0===e.shaderPasses.length&&0===e.renderTargets.length&&(t.keep=!1,e.deletePrograms(),e.clear(),e.canvas.removeEventListener("webgllost",e._contextLostHandler,!1),e.canvas.removeEventListener("webglrestored",e._contextRestoredHandler,!1),e.gl&&e.extensions.WEBGL_lose_context&&e.extensions.WEBGL_lose_context.loseContext(),e.canvas.width=e.canvas.width,e.gl=null,e.container.removeChild(e.canvas),e.container=null,e.canvas=null,e.onDisposed&&e.onDisposed())},!0)}}}]),e}(),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.xOffset,i=void 0===n?0:n,r=t.yOffset,s=void 0===r?0:r,a=t.lastXDelta,o=void 0===a?0:a,l=t.lastYDelta,u=void 0===l?0:l,c=t.shouldWatch,h=void 0===c||c,d=t.onScroll,f=void 0===d?function(){}:d;_classCallCheck(this,e),this.xOffset=i,this.yOffset=s,this.lastXDelta=o,this.lastYDelta=u,this.shouldWatch=h,this.onScroll=f,this.handler=this.scroll.bind(this,!0),this.shouldWatch&&window.addEventListener("scroll",this.handler,{passive:!0})}return _createClass(e,[{key:"scroll",value:function(){this.updateScrollValues(window.pageXOffset,window.pageYOffset)}},{key:"updateScrollValues",value:function(e,t){var n=this.xOffset;this.xOffset=e,this.lastXDelta=n-this.xOffset;var i=this.yOffset;this.yOffset=t,this.lastYDelta=i-this.yOffset,this.onScroll&&this.onScroll(this.lastXDelta,this.lastYDelta)}},{key:"dispose",value:function(){this.shouldWatch&&window.removeEventListener("scroll",this.handler,{passive:!0})}}]),e}(),h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.container,r=t.alpha,s=void 0===r||r,a=t.premultipliedAlpha,o=void 0!==a&&a,l=t.antialias,u=void 0===l||l,c=t.depth,h=void 0===c||c,d=t.failIfMajorPerformanceCaveat,f=void 0===d||d,p=t.preserveDrawingBuffer,m=void 0!==p&&p,g=t.stencil,v=void 0!==g&&g,y=t.autoResize,b=void 0===y||y,_=t.autoRender,x=void 0===_||_,w=t.watchScroll,k=void 0===w||w,T=t.pixelRatio,E=void 0===T?window.devicePixelRatio||1:T,P=t.renderingScale,S=void 0===P?1:P,C=t.production,R=void 0!==C&&C;_classCallCheck(this,e),this.type="Curtains",this._autoResize=b,this._autoRender=x,this._watchScroll=k,this.pixelRatio=E,S=isNaN(S)?1:parseFloat(S),this._renderingScale=Math.max(.25,Math.min(1,S)),this.premultipliedAlpha=o,this.alpha=s,this.antialias=u,this.depth=h,this.failIfMajorPerformanceCaveat=f,this.preserveDrawingBuffer=m,this.stencil=v,this.production=R,this.errors=!1,i?this.setContainer(i):this.production||n(this.type+": no container provided in the initial parameters. Use setContainer() method to set one later and initialize the WebGL context")}return _createClass(e,[{key:"setContainer",value:function(e){if(e)if("string"==typeof e)if(e=document.getElementById(e))this.container=e;else{var t=document.createElement("div");t.setAttribute("id","curtains-canvas"),document.body.appendChild(t),this.container=t,this.production||n('Curtains: no valid container HTML element or ID provided, created a div with "curtains-canvas" ID instead')}else e instanceof Element&&(this.container=e);else{var i=document.createElement("div");i.setAttribute("id","curtains-canvas"),document.body.appendChild(i),this.container=i,this.production||n('Curtains: no valid container HTML element or ID provided, created a div with "curtains-canvas" ID instead')}this._initCurtains()}},{key:"_initCurtains",value:function(){this.planes=[],this.renderTargets=[],this.shaderPasses=[],this._initRenderer(),this.gl&&(this._initScroll(),this._setSize(),this._addListeners(),this.container.appendChild(this.canvas),this._animationFrameID=null,this._autoRender&&this._animate())}},{key:"_initRenderer",value:function(){var e=this;this.renderer=new u({alpha:this.alpha,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,depth:this.depth,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,stencil:this.stencil,container:this.container,pixelRatio:this.pixelRatio,renderingScale:this._renderingScale,production:this.production,onError:function(){return e._onRendererError()},onSuccess:function(){return e._onRendererSuccess()},onContextLost:function(){return e._onRendererContextLost()},onContextRestored:function(){return e._onRendererContextRestored()},onDisposed:function(){return e._onRendererDisposed()},onSceneChange:function(){return e._keepSync()}}),this.gl=this.renderer.gl,this.canvas=this.renderer.canvas}},{key:"restoreContext",value:function(){this.renderer.restoreContext()}},{key:"_animate",value:function(){this.render(),this._animationFrameID=window.requestAnimationFrame(this._animate.bind(this))}},{key:"enableDrawing",value:function(){this.renderer.enableDrawing()}},{key:"disableDrawing",value:function(){this.renderer.disableDrawing()}},{key:"needRender",value:function(){this.renderer.needRender()}},{key:"nextRender",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.renderer.nextRender.add(e,t)}},{key:"clear",value:function(){this.renderer&&this.renderer.clear()}},{key:"clearDepth",value:function(){this.renderer&&this.renderer.clearDepth()}},{key:"clearColor",value:function(){this.renderer&&this.renderer.clearColor()}},{key:"isWebGL2",value:function(){return!!this.gl&&this.renderer._isWebGL2}},{key:"render",value:function(){this.renderer.nextRender.execute(),(this.renderer.state.drawingEnabled||this.renderer.state.forceRender)&&(this.renderer.state.forceRender&&(this.renderer.state.forceRender=!1),this._onRenderCallback&&this._onRenderCallback(),this.renderer.render())}},{key:"_addListeners",value:function(){this._resizeHandler=null,this._autoResize&&(this._resizeHandler=this.resize.bind(this,!0),window.addEventListener("resize",this._resizeHandler,!1))}},{key:"setPixelRatio",value:function(e,t){this.pixelRatio=parseFloat(Math.max(e,1))||1,this.renderer.setPixelRatio(e),this.resize(t)}},{key:"_setSize",value:function(){this.renderer.setSize(),this._scrollManager.shouldWatch&&(this._scrollManager.xOffset=window.pageXOffset,this._scrollManager.yOffset=window.pageYOffset)}},{key:"getBoundingRect",value:function(){return this.renderer._boundingRect}},{key:"resize",value:function(e){var t=this;this.gl&&(this._setSize(),this.renderer.resize(),this.nextRender(function(){t._onAfterResizeCallback&&e&&t._onAfterResizeCallback()}))}},{key:"_initScroll",value:function(){var e=this;this._scrollManager=new c({xOffset:window.pageXOffset,yOffset:window.pageYOffset,lastXDelta:0,lastYDelta:0,shouldWatch:this._watchScroll,onScroll:function(t,n){return e._updateScroll(t,n)}})}},{key:"_updateScroll",value:function(e,t){for(var n=0;n<this.planes.length;n++)this.planes[n].watchScroll&&this.planes[n].updateScrollPosition(e,t);this.renderer.needRender(),this._onScrollCallback&&this._onScrollCallback()}},{key:"updateScrollValues",value:function(e,t){this._scrollManager.updateScrollValues(e,t)}},{key:"getScrollDeltas",value:function(){return{x:this._scrollManager.lastXDelta,y:this._scrollManager.lastYDelta}}},{key:"getScrollValues",value:function(){return{x:this._scrollManager.xOffset,y:this._scrollManager.yOffset}}},{key:"_keepSync",value:function(){this.planes=this.renderer.planes,this.shaderPasses=this.renderer.shaderPasses,this.renderTargets=this.renderer.renderTargets}},{key:"lerp",value:function(e,t,n){return function(e,t,n){return(1-n)*e+n*t}(e,t,n)}},{key:"onAfterResize",value:function(e){return e&&(this._onAfterResizeCallback=e),this}},{key:"onError",value:function(e){return e&&(this._onErrorCallback=e),this}},{key:"_onRendererError",value:function(){var e=this;setTimeout(function(){e._onErrorCallback&&!e.errors&&e._onErrorCallback(),e.errors=!0},0)}},{key:"onSuccess",value:function(e){return e&&(this._onSuccessCallback=e),this}},{key:"_onRendererSuccess",value:function(){var e=this;setTimeout(function(){e._onSuccessCallback&&e._onSuccessCallback()},0)}},{key:"onContextLost",value:function(e){return e&&(this._onContextLostCallback=e),this}},{key:"_onRendererContextLost",value:function(){this._onContextLostCallback&&this._onContextLostCallback()}},{key:"onContextRestored",value:function(e){return e&&(this._onContextRestoredCallback=e),this}},{key:"_onRendererContextRestored",value:function(){this._onContextRestoredCallback&&this._onContextRestoredCallback()}},{key:"onRender",value:function(e){return e&&(this._onRenderCallback=e),this}},{key:"onScroll",value:function(e){return e&&(this._onScrollCallback=e),this}},{key:"dispose",value:function(){this.renderer.dispose()}},{key:"_onRendererDisposed",value:function(){this._animationFrameID&&window.cancelAnimationFrame(this._animationFrameID),this._resizeHandler&&window.removeEventListener("resize",this._resizeHandler,!1),this._scrollManager&&this._scrollManager.dispose()}}]),e}(),d=function(){function e(t,n,r){if(_classCallCheck(this,e),this.type="Uniforms",t&&"Renderer"===t.type){if(!t.gl)return void i(this.type+": Renderer WebGL context is undefined",t)}else i(this.type+": Renderer not passed as first argument",t);if(this.renderer=t,this.gl=t.gl,this.program=n,this.uniforms={},r)for(var s in r){var a=r[s];this.uniforms[s]={name:a.name,type:a.type,value:a.value.clone&&"function"==typeof a.value.clone?a.value.clone():a.value,update:null}}}return _createClass(e,[{key:"handleUniformSetting",value:function(e){switch(e.type){case"1i":e.update=this.setUniform1i.bind(this);break;case"1iv":e.update=this.setUniform1iv.bind(this);break;case"1f":e.update=this.setUniform1f.bind(this);break;case"1fv":e.update=this.setUniform1fv.bind(this);break;case"2i":e.update=this.setUniform2i.bind(this);break;case"2iv":e.update=this.setUniform2iv.bind(this);break;case"2f":e.update=this.setUniform2f.bind(this);break;case"2fv":e.update=this.setUniform2fv.bind(this);break;case"3i":e.update=this.setUniform3i.bind(this);break;case"3iv":e.update=this.setUniform3iv.bind(this);break;case"3f":e.update=this.setUniform3f.bind(this);break;case"3fv":e.update=this.setUniform3fv.bind(this);break;case"4i":e.update=this.setUniform4i.bind(this);break;case"4iv":e.update=this.setUniform4iv.bind(this);break;case"4f":e.update=this.setUniform4f.bind(this);break;case"4fv":e.update=this.setUniform4fv.bind(this);break;case"mat2":e.update=this.setUniformMatrix2fv.bind(this);break;case"mat3":e.update=this.setUniformMatrix3fv.bind(this);break;case"mat4":e.update=this.setUniformMatrix4fv.bind(this);break;default:this.renderer.production||n(this.type+": This uniform type is not handled : ",e.type)}}},{key:"setInternalFormat",value:function(e){"Vec2"===e.value.type?(e._internalFormat="Vec2",e.lastValue=e.value.clone()):"Vec3"===e.value.type?(e._internalFormat="Vec3",e.lastValue=e.value.clone()):"Mat4"===e.value.type?(e._internalFormat="Mat4",e.lastValue=e.value.clone()):"Quat"===e.value.type?(e._internalFormat="Quat",e.lastValue=e.value.clone()):Array.isArray(e.value)?(e._internalFormat="array",e.lastValue=Array.from(e.value)):e.value.constructor===Float32Array?(e._internalFormat="mat",e.lastValue=e.value):(e._internalFormat="float",e.lastValue=e.value)}},{key:"setUniforms",value:function(){if(this.uniforms)for(var e in this.uniforms){var t=this.uniforms[e];t.location=this.gl.getUniformLocation(this.program,t.name),t._internalFormat||this.setInternalFormat(t),t.type||("Vec2"===t._internalFormat?t.type="2f":"Vec3"===t._internalFormat?t.type="3f":"Mat4"===t._internalFormat?t.type="mat4":"array"===t._internalFormat?4===t.value.length?(t.type="4f",this.renderer.production||n(this.type+": No uniform type declared for "+t.name+", applied a 4f (array of 4 floats) uniform type")):3===t.value.length?(t.type="3f",this.renderer.production||n(this.type+": No uniform type declared for "+t.name+", applied a 3f (array of 3 floats) uniform type")):2===t.value.length&&(t.type="2f",this.renderer.production||n(this.type+": No uniform type declared for "+t.name+", applied a 2f (array of 2 floats) uniform type")):"mat"===t._internalFormat?16===t.value.length?(t.type="mat4",this.renderer.production||n(this.type+": No uniform type declared for "+t.name+", applied a mat4 (4x4 matrix array) uniform type")):9===t.value.length?(t.type="mat3",this.renderer.production||n(this.type+": No uniform type declared for "+t.name+", applied a mat3 (3x3 matrix array) uniform type")):4===t.value.length&&(t.type="mat2",this.renderer.production||n(this.type+": No uniform type declared for "+t.name+", applied a mat2 (2x2 matrix array) uniform type")):(t.type="1f",this.renderer.production||n(this.type+": No uniform type declared for "+t.name+", applied a 1f (float) uniform type"))),this.handleUniformSetting(t),t.update&&t.update(t)}}},{key:"updateUniforms",value:function(){if(this.uniforms)for(var e in this.uniforms){var t=this.uniforms[e],n=!1;"Vec2"===t._internalFormat||"Vec3"===t._internalFormat||"Quat"===t._internalFormat?t.value.equals(t.lastValue)||(n=!0,t.lastValue.copy(t.value)):t.value.length?JSON.stringify(t.value)!==JSON.stringify(t.lastValue)&&(n=!0,t.lastValue=Array.from(t.value)):t.value!==t.lastValue&&(n=!0,t.lastValue=t.value),n&&t.update&&t.update(t)}}},{key:"setUniform1i",value:function(e){this.gl.uniform1i(e.location,e.value)}},{key:"setUniform1iv",value:function(e){this.gl.uniform1iv(e.location,e.value)}},{key:"setUniform1f",value:function(e){this.gl.uniform1f(e.location,e.value)}},{key:"setUniform1fv",value:function(e){this.gl.uniform1fv(e.location,e.value)}},{key:"setUniform2i",value:function(e){"Vec2"===e._internalFormat?this.gl.uniform2i(e.location,e.value.x,e.value.y):this.gl.uniform2i(e.location,e.value[0],e.value[1])}},{key:"setUniform2iv",value:function(e){"Vec2"===e._internalFormat?this.gl.uniform2iv(e.location,[e.value.x,e.value.y]):this.gl.uniform2iv(e.location,e.value)}},{key:"setUniform2f",value:function(e){"Vec2"===e._internalFormat?this.gl.uniform2f(e.location,e.value.x,e.value.y):this.gl.uniform2f(e.location,e.value[0],e.value[1])}},{key:"setUniform2fv",value:function(e){"Vec2"===e._internalFormat?this.gl.uniform2fv(e.location,[e.value.x,e.value.y]):this.gl.uniform2fv(e.location,e.value)}},{key:"setUniform3i",value:function(e){"Vec3"===e._internalFormat?this.gl.uniform3i(e.location,e.value.x,e.value.y,e.value.z):this.gl.uniform3i(e.location,e.value[0],e.value[1],e.value[2])}},{key:"setUniform3iv",value:function(e){"Vec3"===e._internalFormat?this.gl.uniform3iv(e.location,[e.value.x,e.value.y,e.value.z]):this.gl.uniform3iv(e.location,e.value)}},{key:"setUniform3f",value:function(e){"Vec3"===e._internalFormat?this.gl.uniform3f(e.location,e.value.x,e.value.y,e.value.z):this.gl.uniform3f(e.location,e.value[0],e.value[1],e.value[2])}},{key:"setUniform3fv",value:function(e){"Vec3"===e._internalFormat?this.gl.uniform3fv(e.location,[e.value.x,e.value.y,e.value.z]):this.gl.uniform3fv(e.location,e.value)}},{key:"setUniform4i",value:function(e){"Quat"===e._internalFormat?this.gl.uniform4i(e.location,e.value.elements[0],e.value.elements[1],e.value.elements[2],e.value[3]):this.gl.uniform4i(e.location,e.value[0],e.value[1],e.value[2],e.value[3])}},{key:"setUniform4iv",value:function(e){"Quat"===e._internalFormat?this.gl.uniform4iv(e.location,[e.value.elements[0],e.value.elements[1],e.value.elements[2],e.value[3]]):this.gl.uniform4iv(e.location,e.value)}},{key:"setUniform4f",value:function(e){"Quat"===e._internalFormat?this.gl.uniform4f(e.location,e.value.elements[0],e.value.elements[1],e.value.elements[2],e.value[3]):this.gl.uniform4f(e.location,e.value[0],e.value[1],e.value[2],e.value[3])}},{key:"setUniform4fv",value:function(e){"Quat"===e._internalFormat?this.gl.uniform4fv(e.location,[e.value.elements[0],e.value.elements[1],e.value.elements[2],e.value[3]]):this.gl.uniform4fv(e.location,e.value)}},{key:"setUniformMatrix2fv",value:function(e){this.gl.uniformMatrix2fv(e.location,!1,e.value)}},{key:"setUniformMatrix3fv",value:function(e){this.gl.uniformMatrix3fv(e.location,!1,e.value)}},{key:"setUniformMatrix4fv",value:function(e){"Mat4"===e._internalFormat?this.gl.uniformMatrix4fv(e.location,!1,e.value.elements):this.gl.uniformMatrix4fv(e.location,!1,e.value)}}]),e}(),f="\nprecision mediump float;\n".replace(/\n/g,""),p="\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n".replace(/\n/g,""),m="\nvarying vec3 vVertexPosition;\nvarying vec2 vTextureCoord;\n".replace(/\n/g,""),g=(f+p+m+"\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\n\nvoid main() {\n    vTextureCoord = aTextureCoord;\n    vVertexPosition = aVertexPosition;\n    \n    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n}\n").replace(/\n/g,""),v=(f+m+"\nvoid main() {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n").replace(/\n/g,""),y=(f+p+m+"\nvoid main() {\n    vTextureCoord = aTextureCoord;\n    vVertexPosition = aVertexPosition;\n    \n    gl_Position = vec4(aVertexPosition, 1.0);\n}\n").replace(/\n/g,""),b=(f+m+"\nuniform sampler2D uRenderTexture;\n\nvoid main() {\n    gl_FragColor = texture2D(uRenderTexture, vTextureCoord);\n}\n").replace(/\n/g,""),_=0,x=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=r.parent,a=r.vertexShader,o=r.fragmentShader;if(_classCallCheck(this,e),this.type="Program",t&&"Renderer"===t.type){if(!t.gl)return void i(this.type+": Renderer WebGL context is undefined",t)}else i(this.type+": Renderer not passed as first argument",t);this.renderer=t,this.gl=this.renderer.gl,this.parent=s,this.defaultVsCode="Plane"===this.parent.type?g:y,this.defaultFsCode="Plane"===this.parent.type?v:b,a?this.vsCode=a:(this.renderer.production||"Plane"!==this.parent.type||n(this.parent.type+": No vertex shader provided, will use a default one"),this.vsCode=this.defaultVsCode),o?this.fsCode=o:(this.renderer.production||n(this.parent.type+": No fragment shader provided, will use a default one"),this.fsCode=this.defaultFsCode),this.compiled=!0,this.setupProgram()}return _createClass(e,[{key:"createShader",value:function(e,t){var r=this.gl.createShader(t);if(this.gl.shaderSource(r,e),this.gl.compileShader(r),!this.renderer.production&&!this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)){for(var s=t===this.gl.VERTEX_SHADER?"vertex shader":"fragment shader",a=this.gl.getShaderSource(r).split("\n"),o=0;o<a.length;o++)a[o]=o+1+": "+a[o];return a=a.join("\n"),n(this.type+": Errors occurred while compiling the",s,":\n",this.gl.getShaderInfoLog(r)),i(a),n(this.type+": Will use a default",s),this.createShader(t===this.gl.VERTEX_SHADER?this.defaultVsCode:this.defaultFsCode,t)}return r}},{key:"useNewShaders",value:function(){this.vertexShader=this.createShader(this.vsCode,this.gl.VERTEX_SHADER),this.fragmentShader=this.createShader(this.fsCode,this.gl.FRAGMENT_SHADER),this.vertexShader&&this.fragmentShader||this.renderer.production||n(this.type+": Unable to find or compile the vertex or fragment shader")}},{key:"setupProgram",value:function(){var e=this.renderer.cache.getProgramFromShaders(this.vsCode,this.fsCode);e?(this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.activeUniforms=e.activeUniforms,this.activeAttributes=e.activeAttributes,this.createProgram()):(this.useNewShaders(),this.compiled&&(this.createProgram(),this.renderer.cache.addProgram(this)))}},{key:"createProgram",value:function(){if(_++,this.id=_,this.program=this.gl.createProgram(),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),!this.renderer.production&&!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))return n(this.type+": Unable to initialize the shader program: "+this.gl.getProgramInfoLog(this.program)),n(this.type+": Will use default vertex and fragment shaders"),this.vertexShader=this.createShader(this.defaultVsCode,this.gl.VERTEX_SHADER),this.fragmentShader=this.createShader(this.defaultFsCode,this.gl.FRAGMENT_SHADER),void this.createProgram();if(this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),!this.activeUniforms||!this.activeAttributes){this.activeUniforms={textures:[],textureMatrices:[]};for(var e=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_UNIFORMS),t=0;t<e;t++){var i=this.gl.getActiveUniform(this.program,t);i.type===this.gl.SAMPLER_2D&&this.activeUniforms.textures.push(i.name),i.type===this.gl.FLOAT_MAT4&&"uMVMatrix"!==i.name&&"uPMatrix"!==i.name&&this.activeUniforms.textureMatrices.push(i.name)}this.activeAttributes=[];for(var r=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES),s=0;s<r;s++){var a=this.gl.getActiveAttrib(this.program,s);this.activeAttributes.push(a.name)}}}},{key:"createUniforms",value:function(e){this.uniformsManager=new d(this.renderer,this.program,e),this.setUniforms()}},{key:"setUniforms",value:function(){this.renderer.useProgram(this),this.uniformsManager.setUniforms()}},{key:"updateUniforms",value:function(){this.renderer.useProgram(this),this.uniformsManager.updateUniforms()}}]),e}(),w=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(n.program,n.width),s=void 0===r?1:r,a=n.height,o=void 0===a?1:a;if(_classCallCheck(this,e),this.type="Geometry",t&&"Renderer"===t.type){if(!t.gl)return void i(this.type+": Renderer WebGL context is undefined",t)}else i(this.type+": Renderer not passed as first argument",t);this.renderer=t,this.gl=this.renderer.gl,this.definition={id:s*o+s,width:s,height:o},this.setDefaultAttributes(),this.setVerticesUVs()}return _createClass(e,[{key:"restoreContext",value:function(e){this.program=null,this.setDefaultAttributes(),this.setVerticesUVs(),this.setProgram(e)}},{key:"setDefaultAttributes",value:function(){this.attributes={vertexPosition:{name:"aVertexPosition",size:3,isActive:!1},textureCoord:{name:"aTextureCoord",size:3,isActive:!1}}}},{key:"setVerticesUVs",value:function(){var e=this.renderer.cache.getGeometryFromID(this.definition.id);e?(this.attributes.vertexPosition.array=e.vertices,this.attributes.textureCoord.array=e.uvs):(this.computeVerticesUVs(),this.renderer.cache.addGeometry(this.definition.id,this.attributes.vertexPosition.array,this.attributes.textureCoord.array))}},{key:"setProgram",value:function(e){this.program=e,this.initAttributes(),this.renderer._isWebGL2?(this._vao=this.gl.createVertexArray(),this.gl.bindVertexArray(this._vao)):this.renderer.extensions.OES_vertex_array_object&&(this._vao=this.renderer.extensions.OES_vertex_array_object.createVertexArrayOES(),this.renderer.extensions.OES_vertex_array_object.bindVertexArrayOES(this._vao)),this.initializeBuffers()}},{key:"initAttributes",value:function(){for(var e in this.attributes){if(this.attributes[e].isActive=this.program.activeAttributes.includes(this.attributes[e].name),!this.attributes[e].isActive)return;this.attributes[e].location=this.gl.getAttribLocation(this.program.program,this.attributes[e].name),this.attributes[e].buffer=this.gl.createBuffer(),this.attributes[e].numberOfItems=this.definition.width*this.definition.height*this.attributes[e].size*2}}},{key:"computeVerticesUVs",value:function(){this.attributes.vertexPosition.array=[],this.attributes.textureCoord.array=[];for(var e=this.attributes.vertexPosition.array,t=this.attributes.textureCoord.array,n=0;n<this.definition.height;n++)for(var i=n/this.definition.height,r=0;r<this.definition.width;r++){var s=r/this.definition.width;t.push(s),t.push(i),t.push(0),e.push(2*(s-.5)),e.push(2*(i-.5)),e.push(0),t.push(s+1/this.definition.width),t.push(i),t.push(0),e.push(2*(s+1/this.definition.width-.5)),e.push(2*(i-.5)),e.push(0),t.push(s),t.push(i+1/this.definition.height),t.push(0),e.push(2*(s-.5)),e.push(2*(i+1/this.definition.height-.5)),e.push(0),t.push(s),t.push(i+1/this.definition.height),t.push(0),e.push(2*(s-.5)),e.push(2*(i+1/this.definition.height-.5)),e.push(0),t.push(s+1/this.definition.width),t.push(i),t.push(0),e.push(2*(s+1/this.definition.width-.5)),e.push(2*(i-.5)),e.push(0),t.push(s+1/this.definition.width),t.push(i+1/this.definition.height),t.push(0),e.push(2*(s+1/this.definition.width-.5)),e.push(2*(i+1/this.definition.height-.5)),e.push(0)}}},{key:"initializeBuffers",value:function(){if(this.attributes){for(var e in this.attributes){if(!this.attributes[e].isActive)return;this.gl.enableVertexAttribArray(this.attributes[e].location),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attributes[e].buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.attributes[e].array),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.attributes[e].location,this.attributes[e].size,this.gl.FLOAT,!1,0,0)}this.renderer.state.currentGeometryID=this.definition.id}}},{key:"bindBuffers",value:function(){if(this._vao)this.renderer._isWebGL2?this.gl.bindVertexArray(this._vao):this.renderer.extensions.OES_vertex_array_object.bindVertexArrayOES(this._vao);else for(var e in this.attributes){if(!this.attributes[e].isActive)return;this.gl.enableVertexAttribArray(this.attributes[e].location),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attributes[e].buffer),this.gl.vertexAttribPointer(this.attributes[e].location,this.attributes[e].size,this.gl.FLOAT,!1,0,0)}this.renderer.state.currentGeometryID=this.definition.id}},{key:"draw",value:function(){this.gl.drawArrays(this.gl.TRIANGLES,0,this.attributes.vertexPosition.numberOfItems)}},{key:"dispose",value:function(){for(var e in this._vao&&(this.renderer._isWebGL2?this.gl.deleteVertexArray(this._vao):this.renderer.extensions.OES_vertex_array_object.deleteVertexArrayOES(this._vao)),this.attributes){if(!this.attributes[e].isActive)return;this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attributes[e].buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,1,this.gl.STATIC_DRAW),this.gl.deleteBuffer(this.attributes[e].buffer)}this.attributes=null,this.renderer.state.currentGeometryID=null}}]),e}(),k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);_classCallCheck(this,e),this.type="Mat4",this.elements=t}return _createClass(e,[{key:"setFromArray",value:function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]=e[t];return this}},{key:"copy",value:function(e){var t=e.elements;return this.elements[0]=t[0],this.elements[1]=t[1],this.elements[2]=t[2],this.elements[3]=t[3],this.elements[4]=t[4],this.elements[5]=t[5],this.elements[6]=t[6],this.elements[7]=t[7],this.elements[8]=t[8],this.elements[9]=t[9],this.elements[10]=t[10],this.elements[11]=t[11],this.elements[12]=t[12],this.elements[13]=t[13],this.elements[14]=t[14],this.elements[15]=t[15],this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"multiply",value:function(t){var n=this.elements,i=t.elements,r=new e;return r.elements[0]=i[0]*n[0]+i[1]*n[4]+i[2]*n[8]+i[3]*n[12],r.elements[1]=i[0]*n[1]+i[1]*n[5]+i[2]*n[9]+i[3]*n[13],r.elements[2]=i[0]*n[2]+i[1]*n[6]+i[2]*n[10]+i[3]*n[14],r.elements[3]=i[0]*n[3]+i[1]*n[7]+i[2]*n[11]+i[3]*n[15],r.elements[4]=i[4]*n[0]+i[5]*n[4]+i[6]*n[8]+i[7]*n[12],r.elements[5]=i[4]*n[1]+i[5]*n[5]+i[6]*n[9]+i[7]*n[13],r.elements[6]=i[4]*n[2]+i[5]*n[6]+i[6]*n[10]+i[7]*n[14],r.elements[7]=i[4]*n[3]+i[5]*n[7]+i[6]*n[11]+i[7]*n[15],r.elements[8]=i[8]*n[0]+i[9]*n[4]+i[10]*n[8]+i[11]*n[12],r.elements[9]=i[8]*n[1]+i[9]*n[5]+i[10]*n[9]+i[11]*n[13],r.elements[10]=i[8]*n[2]+i[9]*n[6]+i[10]*n[10]+i[11]*n[14],r.elements[11]=i[8]*n[3]+i[9]*n[7]+i[10]*n[11]+i[11]*n[15],r.elements[12]=i[12]*n[0]+i[13]*n[4]+i[14]*n[8]+i[15]*n[12],r.elements[13]=i[12]*n[1]+i[13]*n[5]+i[14]*n[9]+i[15]*n[13],r.elements[14]=i[12]*n[2]+i[13]*n[6]+i[14]*n[10]+i[15]*n[14],r.elements[15]=i[12]*n[3]+i[13]*n[7]+i[14]*n[11]+i[15]*n[15],r}},{key:"getInverse",value:function(){var t=this.elements,n=new e,i=n.elements,r=t[0],s=t[1],a=t[2],o=t[3],l=t[4],u=t[5],c=t[6],h=t[7],d=t[8],f=t[9],p=t[10],m=t[11],g=t[12],v=t[13],y=t[14],b=t[15],_=r*u-s*l,x=r*c-a*l,w=r*h-o*l,k=s*c-a*u,T=s*h-o*u,E=a*h-o*c,P=d*v-f*g,S=d*y-p*g,C=d*b-m*g,R=f*y-p*v,A=f*b-m*v,M=p*b-m*y,O=_*M-x*A+w*R+k*C-T*S+E*P;return O?(O=1/O,i[0]=(u*M-c*A+h*R)*O,i[1]=(a*A-s*M-o*R)*O,i[2]=(v*E-y*T+b*k)*O,i[3]=(p*T-f*E-m*k)*O,i[4]=(c*C-l*M-h*S)*O,i[5]=(r*M-a*C+o*S)*O,i[6]=(y*w-g*E-b*x)*O,i[7]=(d*E-p*w+m*x)*O,i[8]=(l*A-u*C+h*P)*O,i[9]=(s*C-r*A-o*P)*O,i[10]=(g*T-v*w+b*_)*O,i[11]=(f*w-d*T-m*_)*O,i[12]=(u*S-l*R-c*P)*O,i[13]=(r*R-s*S+a*P)*O,i[14]=(v*x-g*k-y*_)*O,i[15]=(d*k-f*x+p*_)*O,n):null}},{key:"scale",value:function(e){var t=this.elements;return t[0]*=e.x,t[1]*=e.x,t[2]*=e.x,t[3]*=e.x,t[4]*=e.y,t[5]*=e.y,t[6]*=e.y,t[7]*=e.y,t[8]*=e.z,t[9]*=e.z,t[10]*=e.z,t[11]*=e.z,this}},{key:"compose",value:function(e,t,n){var i=this.elements,r=t.elements[0],s=t.elements[1],a=t.elements[2],o=t.elements[3],l=r+r,u=s+s,c=a+a,h=r*l,d=r*u,f=r*c,p=s*u,m=s*c,g=a*c,v=o*l,y=o*u,b=o*c,_=n.x,x=n.y,w=n.z;return i[0]=(1-(p+g))*_,i[1]=(d+b)*_,i[2]=(f-y)*_,i[3]=0,i[4]=(d-b)*x,i[5]=(1-(h+g))*x,i[6]=(m+v)*x,i[7]=0,i[8]=(f+y)*w,i[9]=(m-v)*w,i[10]=(1-(h+p))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}},{key:"composeFromOrigin",value:function(e,t,n,i){var r=this.elements,s=t.elements[0],a=t.elements[1],o=t.elements[2],l=t.elements[3],u=s+s,c=a+a,h=o+o,d=s*u,f=s*c,p=s*h,m=a*c,g=a*h,v=o*h,y=l*u,b=l*c,_=l*h,x=n.x,w=n.y,k=n.z,T=i.x,E=i.y,P=i.z,S=(1-(m+v))*x,C=(f+_)*x,R=(p-b)*x,A=(f-_)*w,M=(1-(d+v))*w,O=(g+y)*w,L=(p+b)*k,F=(g-y)*k,D=(1-(d+m))*k;return r[0]=S,r[1]=C,r[2]=R,r[3]=0,r[4]=A,r[5]=M,r[6]=O,r[7]=0,r[8]=L,r[9]=F,r[10]=D,r[11]=0,r[12]=e.x+T-(S*T+A*E+L*P),r[13]=e.y+E-(C*T+M*E+F*P),r[14]=e.z+P-(R*T+O*E+D*P),r[15]=1,this}}]),e}(),T=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;_classCallCheck(this,e),this.type="Vec2",this._x=t,this._y=n}return _createClass(e,[{key:"onChange",value:function(e){return e&&(this._onChangeCallback=e),this}},{key:"set",value:function(e,t){return this._x=e,this._y=t,this}},{key:"add",value:function(e){return this._x+=e.x,this._y+=e.y,this}},{key:"addScalar",value:function(e){return this._x+=e,this._y+=e,this}},{key:"sub",value:function(e){return this._x-=e.x,this._y-=e.y,this}},{key:"subScalar",value:function(e){return this._x-=e,this._y-=e,this}},{key:"multiply",value:function(e){return this._x*=e.x,this._y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this._x*=e,this._y*=e,this}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this}},{key:"clone",value:function(){return new e(this._x,this._y)}},{key:"sanitizeNaNValuesWith",value:function(e){return this._x=isNaN(this._x)?e.x:parseFloat(this._x),this._y=isNaN(this._y)?e.y:parseFloat(this._y),this}},{key:"max",value:function(e){return this._x=Math.max(this._x,e.x),this._y=Math.max(this._y,e.y),this}},{key:"min",value:function(e){return this._x=Math.min(this._x,e.x),this._y=Math.min(this._y,e.y),this}},{key:"equals",value:function(e){return this._x===e.x&&this._y===e.y}},{key:"normalize",value:function(){var e=this._x*this._x+this._y*this._y;return e>0&&(e=1/Math.sqrt(e)),this._x*=e,this._y*=e,this}},{key:"dot",value:function(e){return this._x*e.x+this._y*e.y}},{key:"x",get:function(){return this._x},set:function(e){var t=e!==this._x;this._x=e,t&&this._onChangeCallback&&this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){var t=e!==this._y;this._y=e,t&&this._onChangeCallback&&this._onChangeCallback()}}]),e}(),E=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;_classCallCheck(this,e),this.type="Vec3",this._x=t,this._y=n,this._z=i}return _createClass(e,[{key:"onChange",value:function(e){return e&&(this._onChangeCallback=e),this}},{key:"set",value:function(e,t,n){return this._x=e,this._y=t,this._z=n,this}},{key:"add",value:function(e){return this._x+=e.x,this._y+=e.y,this._z+=e.z,this}},{key:"addScalar",value:function(e){return this._x+=e,this._y+=e,this._z+=e,this}},{key:"sub",value:function(e){return this._x-=e.x,this._y-=e.y,this._z-=e.z,this}},{key:"subScalar",value:function(e){return this._x-=e,this._y-=e,this._z-=e,this}},{key:"multiply",value:function(e){return this._x*=e.x,this._y*=e.y,this._z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this._x*=e,this._y*=e,this._z*=e,this}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this}},{key:"clone",value:function(){return new e(this._x,this._y,this._z)}},{key:"sanitizeNaNValuesWith",value:function(e){return this._x=isNaN(this._x)?e.x:parseFloat(this._x),this._y=isNaN(this._y)?e.y:parseFloat(this._y),this._z=isNaN(this._z)?e.z:parseFloat(this._z),this}},{key:"max",value:function(e){return this._x=Math.max(this._x,e.x),this._y=Math.max(this._y,e.y),this._z=Math.max(this._z,e.z),this}},{key:"min",value:function(e){return this._x=Math.min(this._x,e.x),this._y=Math.min(this._y,e.y),this._z=Math.min(this._z,e.z),this}},{key:"equals",value:function(e){return this._x===e.x&&this._y===e.y&&this._z===e.z}},{key:"normalize",value:function(){var e=this._x*this._x+this._y*this._y+this._z*this._z;return e>0&&(e=1/Math.sqrt(e)),this._x*=e,this._y*=e,this._z*=e,this}},{key:"dot",value:function(e){return this._x*e.x+this._y*e.y+this._z*e.z}},{key:"applyMat4",value:function(e){var t=this._x,n=this._y,i=this._z,r=e.elements,s=r[3]*t+r[7]*n+r[11]*i+r[15];return s=s||1,this._x=(r[0]*t+r[4]*n+r[8]*i+r[12])/s,this._y=(r[1]*t+r[5]*n+r[9]*i+r[13])/s,this._z=(r[2]*t+r[6]*n+r[10]*i+r[14])/s,this}},{key:"applyQuat",value:function(e){var t=this._x,n=this._y,i=this._z,r=e.elements[0],s=e.elements[1],a=e.elements[2],o=e.elements[3],l=o*t+s*i-a*n,u=o*n+a*t-r*i,c=o*i+r*n-s*t,h=-r*t-s*n-a*i;return this._x=l*o+h*-r+u*-a-c*-s,this._y=u*o+h*-s+c*-r-l*-a,this._z=c*o+h*-a+l*-s-u*-r,this}},{key:"project",value:function(e){return this.applyMat4(e.viewMatrix).applyMat4(e.projectionMatrix),this}},{key:"unproject",value:function(e){return this.applyMat4(e.projectionMatrix.getInverse()).applyMat4(e.worldMatrix),this}},{key:"x",get:function(){return this._x},set:function(e){var t=e!==this._x;this._x=e,t&&this._onChangeCallback&&this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){var t=e!==this._y;this._y=e,t&&this._onChangeCallback&&this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){var t=e!==this._z;this._z=e,t&&this._onChangeCallback&&this._onChangeCallback()}}]),e}(),P=new T,S=new E,C=new k,R=function(){function e(t){var n=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=s.isFBOTexture,o=void 0!==a&&a,l=s.fromTexture,u=void 0!==l&&l,c=s.loader,h=s.sampler,d=s.floatingPoint,f=void 0===d?"none":d,p=s.premultiplyAlpha,m=void 0!==p&&p,g=s.anisotropy,v=void 0===g?1:g,y=s.generateMipmap,b=void 0===y?null:y,_=s.wrapS,x=s.wrapT,w=s.minFilter,E=s.magFilter;if(_classCallCheck(this,e),this.type="Texture",(t=t&&t.renderer||t)&&"Renderer"===t.type){if(!t.gl)return void(t.production||i(this.type+": Unable to create a "+this.type+" because the Renderer WebGL context is not defined"))}else i(this.type+": Renderer not passed as first argument",t);if(this.renderer=t,this.gl=this.renderer.gl,this.uuid=r(),this._globalParameters={unpackAlignment:4,flipY:!o,premultiplyAlpha:!1,shouldPremultiplyAlpha:m,floatingPoint:f,type:this.gl.UNSIGNED_BYTE,internalFormat:this.gl.RGBA,format:this.gl.RGBA},this.parameters={anisotropy:v,generateMipmap:b,wrapS:_||this.gl.CLAMP_TO_EDGE,wrapT:x||this.gl.CLAMP_TO_EDGE,minFilter:w||this.gl.LINEAR,magFilter:E||this.gl.LINEAR,_shouldUpdate:!0},this._initState(),this.sourceType=o?"fbo":"empty",this._useCache=!0,this._samplerName=h,this._sampler={isActive:!1,isTextureBound:!1,texture:this.gl.createTexture()},this._textureMatrix={matrix:new k,isActive:!1},this._size={width:1,height:1},this.scale=new T(1),this.scale.onChange(function(){return n.resize()}),this.offset=new T,this.offset.onChange(function(){return n.resize()}),this._loader=c,this._sourceLoaded=!1,this._uploaded=!1,this._willUpdate=!1,this.shouldUpdate=!1,this._forceUpdate=!1,this.userData={},this._canDraw=!1,u)return this._copyOnInit=!0,void(this._copiedFrom=u);this._copyOnInit=!1,this._initTexture()}return _createClass(e,[{key:"_initState",value:function(){this._state={anisotropy:1,generateMipmap:!1,wrapS:null,wrapT:null,minFilter:null,magFilter:this.gl.LINEAR}}},{key:"_initTexture",value:function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this._sampler.texture),"empty"===this.sourceType&&(this._globalParameters.flipY=!1,this._updateGlobalTexParameters(),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([0,0,0,255])),this._canDraw=!0)}},{key:"_restoreFromTexture",value:function(){this._copyOnInit||this._initTexture(),this._parent&&(this._setTextureUniforms(),this._setSize()),this.copy(this._copiedFrom),this._canDraw=!0}},{key:"_restoreContext",value:function(){var e=this;if(this._canDraw=!1,this._sampler.texture=this.gl.createTexture(),this._sampler.isActive=!1,this._sampler.isTextureBound=!1,this._textureMatrix.isActive=!1,this._initState(),this._state.generateMipmap=!1,this.parameters._shouldUpdate=!0,this._copiedFrom)var t=this.renderer.nextRender.add(function(){e._copiedFrom._canDraw&&(e._restoreFromTexture(),t.keep=!1)},!0);else this._initTexture(),this._parent&&this._setParent(),this.source&&(this.setSource(this.source),"image"===this.sourceType?this.renderer.cache.addTexture(this):this.needUpdate()),this._canDraw=!0}},{key:"addParent",value:function(e){!e||"Plane"!==e.type&&"PingPongPlane"!==e.type&&"ShaderPass"!==e.type&&"RenderTarget"!==e.type?this.renderer.production||n(this.type+": cannot add texture as a child of ",e," because it is not a valid parent"):(this._parent=e,this.index=this._parent.textures.length,this._parent.textures.push(this),this._setParent())}},{key:"_setParent",value:function(){var e=this;if(this._sampler.name=this._samplerName||"uSampler"+this.index,this._textureMatrix.name=this._samplerName?this._samplerName+"Matrix":"uTextureMatrix"+this.index,this._parent._program){if(!this._parent._program.compiled)return void(this.renderer.production||n(this.type+": Unable to create the texture because the program is not valid"));if(this._setTextureUniforms(),this._copyOnInit){var t=this.renderer.nextRender.add(function(){e._copiedFrom._canDraw&&e._copiedFrom._uploaded&&(e.copy(e._copiedFrom),t.keep=!1)},!0);return}this.source?this._parent.loader&&this._parent.loader._addSourceToParent(this.source,this.sourceType):this._size={width:this._parent._boundingRect.document.width,height:this._parent._boundingRect.document.height},this._setSize()}else"RenderTarget"===this._parent.type&&(this._size={width:this._parent._size&&this._parent._size.width||this.renderer._boundingRect.width,height:this._parent._size&&this._parent._size.height||this.renderer._boundingRect.height},this._upload(),this._updateTexParameters(),this._canDraw=!0)}},{key:"hasParent",value:function(){return!!this._parent}},{key:"_setTextureUniforms",value:function(){for(var e=this,t=this._parent._program.activeUniforms,n=0;n<t.textures.length;n++)t.textures[n]===this._sampler.name&&(this._sampler.isActive=!0,this.renderer.useProgram(this._parent._program),this._sampler.location=this.gl.getUniformLocation(this._parent._program.program,this._sampler.name),t.textureMatrices.find(function(t){return t===e._textureMatrix.name})&&(this._textureMatrix.isActive=!0,this._textureMatrix.location=this.gl.getUniformLocation(this._parent._program.program,this._textureMatrix.name)),this.gl.uniform1i(this._sampler.location,this.index))}},{key:"copy",value:function(e){e&&"Texture"===e.type?(this._globalParameters=e._globalParameters,this._state=e._state,this._size=e._size,!this._sourceLoaded&&e._sourceLoaded&&this._onSourceLoadedCallback&&this._onSourceLoadedCallback(),this._sourceLoaded=e._sourceLoaded,!this._uploaded&&e._uploaded&&this._onSourceUploadedCallback&&this._onSourceUploadedCallback(),this._uploaded=e._uploaded,this.sourceType=e.sourceType,this.source=e.source,this._videoFrameCallbackID=e._videoFrameCallbackID,this._sampler.texture=e._sampler.texture,this._copiedFrom=e,!this._parent||!this._parent._program||this._canDraw&&this._textureMatrix.matrix||(this._setSize(),this._canDraw=!0),this.renderer.needRender()):this.renderer.production||n(this.type+": Unable to set the texture from texture:",e)}},{key:"setSource",value:function(e){var t=this;this._sourceLoaded||this.renderer.nextRender.add(function(){return t._onSourceLoadedCallback&&t._onSourceLoadedCallback()});var i="IMG"===e.tagName.toUpperCase()?"image":e.tagName.toLowerCase();if("video"!==i&&"canvas"!==i||(this._useCache=!1),this._useCache){var r=this.renderer.cache.getTextureFromSource(e);if(r&&r.uuid!==this.uuid)return this._uploaded||(this.renderer.nextRender.add(function(){return t._onSourceUploadedCallback&&t._onSourceUploadedCallback()}),this._uploaded=!0),this.copy(r),void this.resize()}if("empty"===this.sourceType||this.sourceType!==i)if("video"===i)this._willUpdate=!1,this.shouldUpdate=!0;else if("canvas"===i)this._willUpdate=!0,this.shouldUpdate=!0;else{if("image"!==i)return void(this.renderer.production||n(this.type+": this HTML tag could not be converted into a texture:",e.tagName));this._willUpdate=!1,this.shouldUpdate=!1}this.source=e,this.sourceType=i,this._size={width:this.source.naturalWidth||this.source.width||this.source.videoWidth,height:this.source.naturalHeight||this.source.height||this.source.videoHeight},this._sourceLoaded=!0,this.gl.bindTexture(this.gl.TEXTURE_2D,this._sampler.texture),this.resize(),this._globalParameters.flipY=!0,this._globalParameters.premultiplyAlpha=this._globalParameters.shouldPremultiplyAlpha,"image"===this.sourceType&&(this.parameters.generateMipmap=this.parameters.generateMipmap||null===this.parameters.generateMipmap,this.parameters._shouldUpdate=this.parameters.generateMipmap,this._state.generateMipmap=!1,this._upload()),this.renderer.needRender()}},{key:"_updateGlobalTexParameters",value:function(){this.renderer.state.unpackAlignment!==this._globalParameters.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this._globalParameters.unpackAlignment),this.renderer.state.unpackAlignment=this._globalParameters.unpackAlignment),this.renderer.state.flipY!==this._globalParameters.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this._globalParameters.flipY),this.renderer.state.flipY=this._globalParameters.flipY),this.renderer.state.premultiplyAlpha!==this._globalParameters.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._globalParameters.premultiplyAlpha),this.renderer.state.premultiplyAlpha=this._globalParameters.premultiplyAlpha),"half-float"===this._globalParameters.floatingPoint?this.renderer._isWebGL2&&this.renderer.extensions.EXT_color_buffer_float?(this._globalParameters.internalFormat=this.gl.RGBA16F,this._globalParameters.type=this.gl.HALF_FLOAT):this.renderer.extensions.OES_texture_half_float?this._globalParameters.type=this.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES:this.renderer.production||n(this.type+": could not use half-float textures because the extension is not available"):"float"===this._globalParameters.floatingPoint&&(this.renderer._isWebGL2&&this.renderer.extensions.EXT_color_buffer_float?(this._globalParameters.internalFormat=this.gl.RGBA16F,this._globalParameters.type=this.gl.FLOAT):this.renderer.extensions.OES_texture_float?this._globalParameters.type=this.renderer.extensions.OES_texture_half_float.FLOAT:this.renderer.production||n(this.type+": could not use float textures because the extension is not available"))}},{key:"_updateTexParameters",value:function(){this.index&&this.renderer.state.activeTexture!==this.index&&this._bindTexture(),this.parameters.wrapS!==this._state.wrapS&&(this.renderer._isWebGL2||s(this._size.width)&&s(this._size.height)||(this.parameters.wrapS=this.gl.CLAMP_TO_EDGE),this.parameters.wrapS!==this.gl.REPEAT&&this.parameters.wrapS!==this.gl.CLAMP_TO_EDGE&&this.parameters.wrapS!==this.gl.MIRRORED_REPEAT&&(this.renderer.production||n(this.type+": Wrong wrapS value",this.parameters.wrapS,"for this texture:",this,"\ngl.CLAMP_TO_EDGE wrapping will be used instead"),this.parameters.wrapS=this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.parameters.wrapS),this._state.wrapS=this.parameters.wrapS),this.parameters.wrapT!==this._state.wrapT&&(this.renderer._isWebGL2||s(this._size.width)&&s(this._size.height)||(this.parameters.wrapT=this.gl.CLAMP_TO_EDGE),this.parameters.wrapT!==this.gl.REPEAT&&this.parameters.wrapT!==this.gl.CLAMP_TO_EDGE&&this.parameters.wrapT!==this.gl.MIRRORED_REPEAT&&(this.renderer.production||n(this.type+": Wrong wrapT value",this.parameters.wrapT,"for this texture:",this,"\ngl.CLAMP_TO_EDGE wrapping will be used instead"),this.parameters.wrapT=this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.parameters.wrapT),this._state.wrapT=this.parameters.wrapT),this.parameters.generateMipmap&&!this._state.generateMipmap&&this.source&&(this.renderer._isWebGL2||s(this._size.width)&&s(this._size.height)?this.gl.generateMipmap(this.gl.TEXTURE_2D):this.parameters.generateMipmap=!1,this._state.generateMipmap=this.parameters.generateMipmap),this.parameters.minFilter!==this._state.minFilter&&(this.renderer._isWebGL2||s(this._size.width)&&s(this._size.height)||(this.parameters.minFilter=this.gl.LINEAR),this.parameters.generateMipmap||null===this.parameters.generateMipmap||(this.parameters.minFilter=this.gl.LINEAR),this.parameters.minFilter!==this.gl.LINEAR&&this.parameters.minFilter!==this.gl.NEAREST&&this.parameters.minFilter!==this.gl.NEAREST_MIPMAP_NEAREST&&this.parameters.minFilter!==this.gl.LINEAR_MIPMAP_NEAREST&&this.parameters.minFilter!==this.gl.NEAREST_MIPMAP_LINEAR&&this.parameters.minFilter!==this.gl.LINEAR_MIPMAP_LINEAR&&(this.renderer.production||n(this.type+": Wrong minFilter value",this.parameters.minFilter,"for this texture:",this,"\ngl.LINEAR filtering will be used instead"),this.parameters.minFilter=this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.parameters.minFilter),this._state.minFilter=this.parameters.minFilter),this.parameters.magFilter!==this._state.magFilter&&(this.renderer._isWebGL2||s(this._size.width)&&s(this._size.height)||(this.parameters.magFilter=this.gl.LINEAR),this.parameters.magFilter!==this.gl.LINEAR&&this.parameters.magFilter!==this.gl.NEAREST&&(this.renderer.production||n(this.type+": Wrong magFilter value",this.parameters.magFilter,"for this texture:",this,"\ngl.LINEAR filtering will be used instead"),this.parameters.magFilter=this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.parameters.magFilter),this._state.magFilter=this.parameters.magFilter);var e=this.renderer.extensions.EXT_texture_filter_anisotropic;if(e&&this.parameters.anisotropy!==this._state.anisotropy){var t=this.gl.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.parameters.anisotropy=Math.max(1,Math.min(this.parameters.anisotropy,t)),this.gl.texParameterf(this.gl.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,this.parameters.anisotropy),this._state.anisotropy=this.parameters.anisotropy}}},{key:"setWrapS",value:function(e){this.parameters.wrapS!==e&&(this.parameters.wrapS=e,this.parameters._shouldUpdate=!0)}},{key:"setWrapT",value:function(e){this.parameters.wrapT!==e&&(this.parameters.wrapT=e,this.parameters._shouldUpdate=!0)}},{key:"setMinFilter",value:function(e){this.parameters.minFilter!==e&&(this.parameters.minFilter=e,this.parameters._shouldUpdate=!0)}},{key:"setMagFilter",value:function(e){this.parameters.magFilter!==e&&(this.parameters.magFilter=e,this.parameters._shouldUpdate=!0)}},{key:"setAnisotropy",value:function(e){e=isNaN(e)?this.parameters.anisotropy:e,this.parameters.anisotropy!==e&&(this.parameters.anisotropy=e,this.parameters._shouldUpdate=!0)}},{key:"needUpdate",value:function(){this._forceUpdate=!0}},{key:"_videoFrameCallback",value:function(){var e=this;this._willUpdate=!0,this.source.requestVideoFrameCallback(function(){return e._videoFrameCallback()})}},{key:"_upload",value:function(){var e=this;this._updateGlobalTexParameters(),this.source?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this._globalParameters.internalFormat,this._globalParameters.format,this._globalParameters.type,this.source):"fbo"===this.sourceType&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,this._globalParameters.internalFormat,this._size.width,this._size.height,0,this._globalParameters.format,this._globalParameters.type,this.source||null),this._uploaded||(this.renderer.nextRender.add(function(){return e._onSourceUploadedCallback&&e._onSourceUploadedCallback()}),this._uploaded=!0)}},{key:"_getSizes",value:function(){if("fbo"===this.sourceType)return{parentWidth:this._parent._boundingRect.document.width,parentHeight:this._parent._boundingRect.document.height,sourceWidth:this._parent._boundingRect.document.width,sourceHeight:this._parent._boundingRect.document.height,xOffset:0,yOffset:0};var e=this._parent.scale?P.set(this._parent.scale.x,this._parent.scale.y):P.set(1,1),t=this._parent._boundingRect.document.width*e.x,n=this._parent._boundingRect.document.height*e.y,i=this._size.width,r=this._size.height,s=i/r,a=t/n,o=0,l=0;return a>s?l=Math.min(0,n-t*(1/s)):a<s&&(o=Math.min(0,t-n*s)),{parentWidth:t,parentHeight:n,sourceWidth:i,sourceHeight:r,xOffset:o,yOffset:l}}},{key:"setScale",value:function(e){e.type&&"Vec2"===e.type?(e.sanitizeNaNValuesWith(this.scale).max(P.set(.001,.001)),e.equals(this.scale)||(this.scale.copy(e),this.resize())):this.renderer.production||n(this.type+": Cannot set scale because the parameter passed is not of Vec2 type:",e)}},{key:"setOffset",value:function(e){e.type&&"Vec2"===e.type?(e.sanitizeNaNValuesWith(this.offset),e.equals(this.offset)||(this.offset.copy(e),this.resize())):this.renderer.production||n(this.type+": Cannot set offset because the parameter passed is not of Vec2 type:",scale)}},{key:"_setSize",value:function(){if(this._parent&&this._parent._program){var e=this._getSizes();this._updateTextureMatrix(e)}}},{key:"resize",value:function(){"fbo"===this.sourceType?(this._size={width:this._parent._size&&this._parent._size.width||this._parent._boundingRect.document.width,height:this._parent._size&&this._parent._size.height||this._parent._boundingRect.document.height},this._copiedFrom||(this.gl.bindTexture(this.gl.TEXTURE_2D,this._sampler.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this._globalParameters.internalFormat,this._size.width,this._size.height,0,this._globalParameters.format,this._globalParameters.type,null))):this.source&&(this._size={width:this.source.naturalWidth||this.source.width||this.source.videoWidth,height:this.source.naturalHeight||this.source.height||this.source.videoHeight}),this._setSize()}},{key:"_updateTextureMatrix",value:function(e){var t=S.set(e.parentWidth/(e.parentWidth-e.xOffset),e.parentHeight/(e.parentHeight-e.yOffset),1);t.x/=this.scale.x,t.y/=this.scale.y,this._textureMatrix.matrix=C.setFromArray([t.x,0,0,0,0,t.y,0,0,0,0,1,0,(1-t.x)/2+this.offset.x,(1-t.y)/2+this.offset.y,0,1]),this._updateMatrixUniform()}},{key:"_updateMatrixUniform",value:function(){this._textureMatrix.isActive&&(this.renderer.useProgram(this._parent._program),this.gl.uniformMatrix4fv(this._textureMatrix.location,!1,this._textureMatrix.matrix.elements))}},{key:"_onSourceLoaded",value:function(e){this.setSource(e),"image"===this.sourceType&&this.renderer.cache.addTexture(this)}},{key:"_bindTexture",value:function(){this._canDraw&&(this.renderer.state.activeTexture!==this.index&&(this.gl.activeTexture(this.gl.TEXTURE0+this.index),this.renderer.state.activeTexture=this.index),this.gl.bindTexture(this.gl.TEXTURE_2D,this._sampler.texture),this._sampler.isTextureBound||(this._sampler.isTextureBound=!!this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._sampler.isTextureBound&&this.renderer.needRender()))}},{key:"_draw",value:function(){this._sampler.isActive&&(this._bindTexture(),"video"===this.sourceType&&this.source&&!this._videoFrameCallbackID&&this.source.readyState>=this.source.HAVE_CURRENT_DATA&&!this.source.paused&&(this._willUpdate=!0),(this._forceUpdate||this._willUpdate&&this.shouldUpdate)&&(this._state.generateMipmap=!1,this._upload()),"video"===this.sourceType&&(this._willUpdate=!1),this._forceUpdate=!1),this.parameters._shouldUpdate&&(this._updateTexParameters(),this.parameters._shouldUpdate=!1)}},{key:"onSourceLoaded",value:function(e){return e&&(this._onSourceLoadedCallback=e),this}},{key:"onSourceUploaded",value:function(e){return e&&(this._onSourceUploadedCallback=e),this}},{key:"_dispose",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];"video"===this.sourceType||"image"===this.sourceType&&!this.renderer.state.isActive?(this._loader&&this._loader._removeSource(this),this.source=null):"canvas"===this.sourceType&&(this.source.width=this.source.width,this.source=null),this._parent=null,this.gl&&!this._copiedFrom&&(e||"image"!==this.sourceType||!this.renderer.state.isActive)&&(this._canDraw=!1,this.renderer.cache.removeTexture(this),this.gl.activeTexture(this.gl.TEXTURE0+this.index),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.deleteTexture(this._sampler.texture))}}]),e}(),A=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"anonymous";if(_classCallCheck(this,e),this.type="TextureLoader",(t=t&&t.renderer||t)&&"Renderer"===t.type){if(!t.gl)return void i(this.type+": Renderer WebGL context is undefined",t)}else i(this.type+": Renderer not passed as first argument",t);this.renderer=t,this.gl=this.renderer.gl,this.crossOrigin=n,this.elements=[]}return _createClass(e,[{key:"_addElement",value:function(e,t,n,i){var r={source:e,texture:t,load:this._sourceLoaded.bind(this,e,t,n),error:this._sourceLoadError.bind(this,e,i)};return this.elements.push(r),r}},{key:"_sourceLoadError",value:function(e,t,n){t&&t(e,n)}},{key:"_sourceLoaded",value:function(e,t,n){var i=this;t._sourceLoaded||(t._onSourceLoaded(e),this._parent&&(this._increment&&this._increment(),this.renderer.nextRender.add(function(){return i._parent._onLoadingCallback&&i._parent._onLoadingCallback(t)})),n&&n(t))}},{key:"_getSourceType",value:function(e){var t;return"string"==typeof e?null!==e.match(/\.(jpeg|jpg|jfif|pjpeg|pjp|gif|bmp|png|webp|svg|avif|apng)$/)?t="image":null!==e.match(/\.(webm|mp4|mpg|mpeg|avi|ogg|ogm|ogv|mov|av1)$/)&&(t="video"):"IMG"===e.tagName.toUpperCase()?t="image":"VIDEO"===e.tagName.toUpperCase()?t="video":"CANVAS"===e.tagName.toUpperCase()&&(t="canvas"),t}},{key:"_createImage",value:function(e){if("string"!=typeof e&&e.hasAttribute("crossOrigin"))return e;var t=new Image;return t.crossOrigin=this.crossOrigin,"string"==typeof e?t.src=e:(t.src=e.src,e.hasAttribute("data-sampler")&&t.setAttribute("data-sampler",e.getAttribute("data-sampler"))),t}},{key:"_createVideo",value:function(e){if("string"==typeof e||null===e.getAttribute("crossOrigin")){var t=document.createElement("video");return t.crossOrigin=this.crossOrigin,"string"==typeof e?t.src=e:(t.src=e.src,e.hasAttribute("data-sampler")&&t.setAttribute("data-sampler",e.getAttribute("data-sampler"))),t}return e}},{key:"loadSource",value:function(e,t,n,i){switch(this._getSourceType(e)){case"image":this.loadImage(e,t,n,i);break;case"video":this.loadVideo(e,t,n,i);break;case"canvas":this.loadCanvas(e,t,n);break;default:this._sourceLoadError(e,i,"this source could not be converted into a texture: "+e)}}},{key:"loadSources",value:function(e,t,n,i){for(var r=0;r<e.length;r++)this.loadSource(e[r],t,n,i)}},{key:"loadImage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=this.renderer.cache.getTextureFromSource(e),s=Object.assign({},t);if(this._parent&&(s=Object.assign(s,this._parent._texturesOptions)),s.loader=this,r){s.sampler="string"!=typeof e&&e.hasAttribute("data-sampler")?e.getAttribute("data-sampler"):s.sampler,s.fromTexture=r;var a=new R(this.renderer,s);return this._sourceLoaded(r.source,a,n),void(this._parent&&this._addToParent(a,r.source,"image"))}var o=this._createImage(e);s.sampler=o.hasAttribute("data-sampler")?o.getAttribute("data-sampler"):s.sampler;var l=new R(this.renderer,s),u=this._addElement(o,l,n,i);o.complete?this._sourceLoaded(o,l,n):o.decode?o.decode().then(this._sourceLoaded.bind(this,o,l,n)).catch(function(){o.addEventListener("load",u.load,!1),o.addEventListener("error",u.error,!1)}):(o.addEventListener("load",u.load,!1),o.addEventListener("error",u.error,!1)),this._parent&&this._addToParent(l,o,"image")}},{key:"loadImages",value:function(e,t,n,i){for(var r=0;r<e.length;r++)this.loadImage(e[r],t,n,i)}},{key:"loadVideo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=this._createVideo(e);r.preload=!0,r.muted=!0,r.loop=!0,r.setAttribute("playsinline",""),r.crossOrigin=this.crossOrigin;var s=Object.assign({},t);this._parent&&(s=Object.assign(t,this._parent._texturesOptions)),s.loader=this,s.sampler=r.hasAttribute("data-sampler")?r.getAttribute("data-sampler"):s.sampler;var a=new R(this.renderer,s),o=this._addElement(r,a,n,i);r.addEventListener("canplaythrough",o.load,!1),r.addEventListener("error",o.error,!1),r.readyState>=r.HAVE_FUTURE_DATA&&n&&this._sourceLoaded(r,a,n),r.load(),this._addToParent&&this._addToParent(a,r,"video"),"requestVideoFrameCallback"in HTMLVideoElement.prototype&&(o.videoFrameCallback=a._videoFrameCallback.bind(a),a._videoFrameCallbackID=r.requestVideoFrameCallback(o.videoFrameCallback))}},{key:"loadVideos",value:function(e,t,n,i){for(var r=0;r<e.length;r++)this.loadVideo(e[r],t,n,i)}},{key:"loadCanvas",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=Object.assign({},t);this._parent&&(i=Object.assign(t,this._parent._texturesOptions)),i.loader=this,i.sampler=e.hasAttribute("data-sampler")?e.getAttribute("data-sampler"):i.sampler;var r=new R(this.renderer,i);this._addElement(e,r,n,null),this._sourceLoaded(e,r,n),this._parent&&this._addToParent(r,e,"canvas")}},{key:"loadCanvases",value:function(e,t,n){for(var i=0;i<e.length;i++)this.loadCanvas(e[i],t,n)}},{key:"_removeSource",value:function(e){var t=this.elements.find(function(t){return t.texture.uuid===e.uuid});t&&("image"===e.sourceType?t.source.removeEventListener("load",t.load,!1):"video"===e.sourceType&&(t.videoFrameCallback&&e._videoFrameCallbackID&&t.source.cancelVideoFrameCallback(e._videoFrameCallbackID),t.source.removeEventListener("canplaythrough",t.load,!1),t.source.pause(),t.source.removeAttribute("src"),t.source.load()),t.source.removeEventListener("error",t.error,!1))}}]),e}(),M=function(e){_inherits(i,A);var t=_createSuper(i);function i(e,r){var s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.sourcesLoaded,l=void 0===o?0:o,u=a.sourcesToLoad,c=void 0===u?0:u,h=a.complete,d=void 0!==h&&h,f=a.onComplete,p=void 0===f?function(){}:f;return _classCallCheck(this,i),(s=t.call(this,e,r.crossOrigin)).type="PlaneTextureLoader",s._parent=r,"Plane"!==s._parent.type&&"PingPongPlane"!==s._parent.type&&"ShaderPass"!==s._parent.type&&(n(s.type+": Wrong parent type assigned to this loader"),s._parent=null),s.sourcesLoaded=l,s.sourcesToLoad=c,s.complete=d,s.onComplete=p,s}return _createClass(i,[{key:"_setLoaderSize",value:function(e){var t=this;this.sourcesToLoad=e,0===this.sourcesToLoad&&(this.complete=!0,this.renderer.nextRender.add(function(){return t.onComplete&&t.onComplete()}))}},{key:"_increment",value:function(){var e=this;this.sourcesLoaded++,this.sourcesLoaded>=this.sourcesToLoad&&!this.complete&&(this.complete=!0,this.renderer.nextRender.add(function(){return e.onComplete&&e.onComplete()}))}},{key:"_addSourceToParent",value:function(e,t){if("image"===t){var n=this._parent.images;!n.find(function(t){return t.src===e.src})&&n.push(e)}else if("video"===t){var i=this._parent.videos;!i.find(function(t){return t.src===e.src})&&i.push(e)}else if("canvas"===t){var r=this._parent.canvases;!r.find(function(t){return t.isSameNode(e)})&&r.push(e)}}},{key:"_addToParent",value:function(e,t,n){this._addSourceToParent(t,n),this._parent&&e.addParent(this._parent)}}]),i}(),O=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mesh",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=s.vertexShaderID,o=s.fragmentShaderID,l=s.vertexShader,u=s.fragmentShader,c=s.uniforms,h=void 0===c?{}:c,d=s.widthSegments,f=void 0===d?1:d,p=s.heightSegments,m=void 0===p?1:p,g=s.renderOrder,v=void 0===g?0:g,y=s.depthTest,b=void 0===y||y,_=s.cullFace,k=void 0===_?"back":_,T=s.texturesOptions,E=void 0===T?{}:T,P=s.crossOrigin,S=void 0===P?"anonymous":P;if(_classCallCheck(this,e),this.type=r,(t=t&&t.renderer||t)&&"Renderer"===t.type||(i(this.type+": Curtains not passed as first argument or Curtains Renderer is missing",t),setTimeout(function(){n._onErrorCallback&&n._onErrorCallback()},0)),this.renderer=t,this.gl=this.renderer.gl,!this.gl)return this.renderer.production||i(this.type+": Unable to create a "+this.type+" because the Renderer WebGL context is not defined"),void setTimeout(function(){n._onErrorCallback&&n._onErrorCallback()},0);this._canDraw=!1,this.renderOrder=v,this._depthTest=b,this.cullFace=k,"back"!==this.cullFace&&"front"!==this.cullFace&&"none"!==this.cullFace&&(this.cullFace="back"),this.textures=[],this._texturesOptions=Object.assign({premultiplyAlpha:!1,anisotropy:1,floatingPoint:"none",wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,minFilter:this.gl.LINEAR,magFilter:this.gl.LINEAR},E),this.crossOrigin=S,!l&&a&&document.getElementById(a)&&(l=document.getElementById(a).innerHTML),!u&&o&&document.getElementById(o)&&(u=document.getElementById(o).innerHTML),this._initMesh(),f=parseInt(f),m=parseInt(m),this._geometry=new w(this.renderer,{width:f,height:m}),this._program=new x(this.renderer,{parent:this,vertexShader:l,fragmentShader:u}),this._program.compiled?(this._program.createUniforms(h),this.uniforms=this._program.uniformsManager.uniforms,this._geometry.setProgram(this._program),this.renderer.onSceneChange()):this.renderer.nextRender.add(function(){return n._onErrorCallback&&n._onErrorCallback()})}return _createClass(e,[{key:"_initMesh",value:function(){var e=this;this.uuid=r(),this.loader=new M(this.renderer,this,{sourcesLoaded:0,initSourcesToLoad:0,complete:!1,onComplete:function(){e._onReadyCallback&&e._onReadyCallback(),e.renderer.needRender()}}),this.images=[],this.videos=[],this.canvases=[],this.userData={},this._canDraw=!0}},{key:"_restoreContext",value:function(){this._canDraw=!1,this._matrices&&(this._matrices=null),this._program=new x(this.renderer,{parent:this,vertexShader:this._program.vsCode,fragmentShader:this._program.fsCode}),this._program.compiled&&(this._geometry.restoreContext(this._program),this._program.createUniforms(this.uniforms),this.uniforms=this._program.uniformsManager.uniforms,this._programRestored())}},{key:"setRenderTarget",value:function(e){e&&"RenderTarget"===e.type?("Plane"===this.type&&this.renderer.scene.removePlane(this),this.target=e,"Plane"===this.type&&this.renderer.scene.addPlane(this)):this.renderer.production||n(this.type+": Could not set the render target because the argument passed is not a RenderTarget class object",e)}},{key:"setRenderOrder",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(e=isNaN(e)?this.renderOrder:parseInt(e))!==this.renderOrder&&(this.renderOrder=e,this.renderer.scene.setPlaneRenderOrder(this))}},{key:"createTexture",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new R(this.renderer,Object.assign(this._texturesOptions,e));return t.addParent(this),t}},{key:"addTexture",value:function(e){e&&"Texture"===e.type?e.addParent(this):this.renderer.production||n(this.type+": cannot add ",e," to this "+this.type+" because it is not a valid texture")}},{key:"loadSources",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=0;r<e.length;r++)this.loadSource(e[r],t,n,i)}},{key:"loadSource",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;this.loader.loadSource(e,Object.assign(i,this._texturesOptions),function(e){r&&r(e)},function(e,i){t.renderer.production||n(t.type+": this HTML tag could not be converted into a texture:",e.tagName),s&&s(e,i)})}},{key:"loadImage",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;this.loader.loadImage(e,Object.assign(i,this._texturesOptions),function(e){r&&r(e)},function(e,i){t.renderer.production||n(t.type+": There has been an error:\n",i,"\nwhile loading this image:\n",e),s&&s(e,i)})}},{key:"loadVideo",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;this.loader.loadVideo(e,Object.assign(i,this._texturesOptions),function(e){r&&r(e)},function(e,i){t.renderer.production||n(t.type+": There has been an error:\n",i,"\nwhile loading this video:\n",e),s&&s(e,i)})}},{key:"loadCanvas",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;this.loader.loadCanvas(e,Object.assign(t,this._texturesOptions),function(e){n&&n(e)})}},{key:"loadImages",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=0;r<e.length;r++)this.loadImage(e[r],t,n,i)}},{key:"loadVideos",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=0;r<e.length;r++)this.loadVideo(e[r],t,n,i)}},{key:"loadCanvases",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,i=0;i<e.length;i++)this.loadCanvas(e[i],t,n)}},{key:"playVideos",value:function(){for(var e=this,t=0;t<this.textures.length;t++){var i=this.textures[t];if("video"===i.sourceType){var r=i.source.play();void 0!==r&&r.catch(function(t){e.renderer.production||n(e.type+": Could not play the video : ",t)})}}}},{key:"_draw",value:function(){this.renderer.setDepthTest(this._depthTest),this.renderer.setFaceCulling(this.cullFace),this._program.updateUniforms(),this._geometry.bindBuffers(),this.renderer.state.forceBufferUpdate=!1;for(var e=0;e<this.textures.length;e++)if(this.textures[e]._draw(),this.textures[e]._sampler.isActive&&!this.textures[e]._sampler.isTextureBound)return;this._geometry.draw(),this.renderer.state.activeTexture=null,this._onAfterRenderCallback&&this._onAfterRenderCallback()}},{key:"onError",value:function(e){return e&&(this._onErrorCallback=e),this}},{key:"onLoading",value:function(e){return e&&(this._onLoadingCallback=e),this}},{key:"onReady",value:function(e){return e&&(this._onReadyCallback=e),this}},{key:"onRender",value:function(e){return e&&(this._onRenderCallback=e),this}},{key:"onAfterRender",value:function(e){return e&&(this._onAfterRenderCallback=e),this}},{key:"remove",value:function(){this._canDraw=!1,this.target&&this.renderer.bindFrameBuffer(null),this._dispose(),"Plane"===this.type?this.renderer.removePlane(this):"ShaderPass"===this.type&&(this.target&&(this.target._shaderPass=null,this.target.remove(),this.target=null),this.renderer.removeShaderPass(this))}},{key:"_dispose",value:function(){if(this.gl){this._geometry&&this._geometry.dispose(),this.target&&"ShaderPass"===this.type&&(this.renderer.removeRenderTarget(this.target),this.textures.shift());for(var e=0;e<this.textures.length;e++)this.textures[e]._dispose();this.textures=[]}}}]),e}(),L=new T,F=new T,D=function(e){_inherits(i,O);var t=_createSuper(i);function i(e,r){var s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"DOMMesh",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=o.widthSegments,u=o.heightSegments,c=o.renderOrder,h=o.depthTest,d=o.cullFace,f=o.uniforms,p=o.vertexShaderID,m=o.fragmentShaderID,g=o.vertexShader,v=o.fragmentShader,y=o.texturesOptions,b=o.crossOrigin;return _classCallCheck(this,i),p=p||r&&r.getAttribute("data-vs-id"),m=m||r&&r.getAttribute("data-fs-id"),(s=t.call(this,e,a,{widthSegments:l,heightSegments:u,renderOrder:c,depthTest:h,cullFace:d,uniforms:f,vertexShaderID:p,fragmentShaderID:m,vertexShader:g,fragmentShader:v,texturesOptions:y,crossOrigin:b})).gl?(s.htmlElement=r,s.htmlElement&&0!==s.htmlElement.length||s.renderer.production||n(s.type+": The HTML element you specified does not currently exists in the DOM"),s._setDocumentSizes(),s):_possibleConstructorReturn(s)}return _createClass(i,[{key:"_setDocumentSizes",value:function(){var e=this.htmlElement.getBoundingClientRect();this._boundingRect||(this._boundingRect={}),this._boundingRect.document={width:e.width*this.renderer.pixelRatio,height:e.height*this.renderer.pixelRatio,top:e.top*this.renderer.pixelRatio,left:e.left*this.renderer.pixelRatio}}},{key:"getBoundingRect",value:function(){return{width:this._boundingRect.document.width,height:this._boundingRect.document.height,top:this._boundingRect.document.top,left:this._boundingRect.document.left,right:this._boundingRect.document.left+this._boundingRect.document.width,bottom:this._boundingRect.document.top+this._boundingRect.document.height}}},{key:"resize",value:function(){var e=this;this._setDocumentSizes(),"Plane"===this.type&&(this.setPerspective(this.camera.fov,this.camera.near,this.camera.far),this._setWorldSizes(),this._applyWorldPositions());for(var t=0;t<this.textures.length;t++)this.textures[t].resize();this.renderer.nextRender.add(function(){return e._onAfterResizeCallback&&e._onAfterResizeCallback()})}},{key:"mouseToPlaneCoords",value:function(e){var t=this.scale?this.scale:F.set(1,1),n=L.set((this._boundingRect.document.width-this._boundingRect.document.width*t.x)/2,(this._boundingRect.document.height-this._boundingRect.document.height*t.y)/2),i=this._boundingRect.document.width*t.x/this.renderer.pixelRatio,r=this._boundingRect.document.height*t.y/this.renderer.pixelRatio,s=(this._boundingRect.document.top+n.y)/this.renderer.pixelRatio,a=(this._boundingRect.document.left+n.x)/this.renderer.pixelRatio;return L.set((e.x-a)/i*2-1,1-(e.y-s)/r*2)}},{key:"onAfterResize",value:function(e){return e&&(this._onAfterResizeCallback=e),this}}]),i}(),I=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.fov,i=void 0===n?50:n,r=t.near,s=void 0===r?.1:r,a=t.far,o=void 0===a?150:a,l=t.width,u=t.height,c=t.pixelRatio,h=void 0===c?1:c;_classCallCheck(this,e),this.position=new E,this.projectionMatrix=new k,this.worldMatrix=new k,this.viewMatrix=new k,this._shouldUpdate=!1,this.setSize(),this.setPerspective(i,s,o,l,u,h)}return _createClass(e,[{key:"setFov",value:function(e){e=isNaN(e)?this.fov:parseFloat(e),(e=Math.max(1,Math.min(e,179)))!==this.fov&&(this.fov=e,this.setPosition(),this._shouldUpdate=!0),this.setCSSPerspective()}},{key:"setNear",value:function(e){e=isNaN(e)?this.near:parseFloat(e),(e=Math.max(e,.01))!==this.near&&(this.near=e,this._shouldUpdate=!0)}},{key:"setFar",value:function(e){e=isNaN(e)?this.far:parseFloat(e),(e=Math.max(e,50))!==this.far&&(this.far=e,this._shouldUpdate=!0)}},{key:"setPixelRatio",value:function(e){e!==this.pixelRatio&&(this._shouldUpdate=!0),this.pixelRatio=e}},{key:"setSize",value:function(e,t){e===this.width&&t===this.height||(this._shouldUpdate=!0),this.width=e,this.height=t}},{key:"setPerspective",value:function(e,t,n,i,r,s){this.setPixelRatio(s),this.setSize(i,r),this.setFov(e),this.setNear(t),this.setFar(n),this._shouldUpdate&&this.updateProjectionMatrix()}},{key:"setPosition",value:function(){this.position.set(0,0,1),this.worldMatrix.setFromArray([1,0,0,0,0,1,0,0,0,0,1,0,this.position.x,this.position.y,this.position.z,1]),this.viewMatrix=this.viewMatrix.copy(this.worldMatrix).getInverse()}},{key:"setCSSPerspective",value:function(){this.CSSPerspective=Math.pow(Math.pow(this.width/(2*this.pixelRatio),2)+Math.pow(this.height/(2*this.pixelRatio),2),.5)/Math.tan(.5*this.fov*Math.PI/180)}},{key:"getScreenRatiosFromFov",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.position.z;e<t?e-=t:e+=t;var n=this.fov*Math.PI/180,i=2*Math.tan(n/2)*Math.abs(e);return{width:i*this.width/this.height,height:i}}},{key:"updateProjectionMatrix",value:function(){var e=this.width/this.height,t=this.near*Math.tan(Math.PI/180*.5*this.fov),n=2*t,i=e*n,r=-.5*i,s=r+i,a=t-n,o=2*this.near/(s-r),l=2*this.near/(t-a),u=(s+r)/(s-r),c=(t+a)/(t-a),h=-(this.far+this.near)/(this.far-this.near),d=-2*this.far*this.near/(this.far-this.near);this.projectionMatrix.setFromArray([o,0,0,0,0,l,0,0,u,c,h,-1,0,0,d,0])}},{key:"forceUpdate",value:function(){this._shouldUpdate=!0}},{key:"cancelUpdate",value:function(){this._shouldUpdate=!1}}]),e}(),N=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Float32Array([0,0,0,1]),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"XYZ";_classCallCheck(this,e),this.type="Quat",this.elements=t,this.axisOrder=n}return _createClass(e,[{key:"setFromArray",value:function(e){return this.elements[0]=e[0],this.elements[1]=e[1],this.elements[2]=e[2],this.elements[3]=e[3],this}},{key:"setAxisOrder",value:function(e){switch(e=e.toUpperCase()){case"XYZ":case"YXZ":case"ZXY":case"ZYX":case"YZX":case"XZY":this.axisOrder=e;break;default:this.axisOrder="XYZ"}return this}},{key:"copy",value:function(e){return this.elements=e.elements,this.axisOrder=e.axisOrder,this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"equals",value:function(e){return this.elements[0]===e.elements[0]&&this.elements[1]===e.elements[1]&&this.elements[2]===e.elements[2]&&this.elements[3]===e.elements[3]&&this.axisOrder===e.axisOrder}},{key:"setFromVec3",value:function(e){var t=.5*e.x,n=.5*e.y,i=.5*e.z,r=Math.cos(t),s=Math.cos(n),a=Math.cos(i),o=Math.sin(t),l=Math.sin(n),u=Math.sin(i);return"XYZ"===this.axisOrder?(this.elements[0]=o*s*a+r*l*u,this.elements[1]=r*l*a-o*s*u,this.elements[2]=r*s*u+o*l*a,this.elements[3]=r*s*a-o*l*u):"YXZ"===this.axisOrder?(this.elements[0]=o*s*a+r*l*u,this.elements[1]=r*l*a-o*s*u,this.elements[2]=r*s*u-o*l*a,this.elements[3]=r*s*a+o*l*u):"ZXY"===this.axisOrder?(this.elements[0]=o*s*a-r*l*u,this.elements[1]=r*l*a+o*s*u,this.elements[2]=r*s*u+o*l*a,this.elements[3]=r*s*a-o*l*u):"ZYX"===this.axisOrder?(this.elements[0]=o*s*a-r*l*u,this.elements[1]=r*l*a+o*s*u,this.elements[2]=r*s*u-o*l*a,this.elements[3]=r*s*a+o*l*u):"YZX"===this.axisOrder?(this.elements[0]=o*s*a+r*l*u,this.elements[1]=r*l*a+o*s*u,this.elements[2]=r*s*u-o*l*a,this.elements[3]=r*s*a-o*l*u):"XZY"===this.axisOrder&&(this.elements[0]=o*s*a-r*l*u,this.elements[1]=r*l*a-o*s*u,this.elements[2]=r*s*u+o*l*a,this.elements[3]=r*s*a+o*l*u),this}}]),e}(),z=new T,U=new E,V=new E,B=new E,j=new E,H=new E,W=new E,q=new E,X=new E,G=new N,Y=new E(.5,.5,0),Z=new E,K=new E,Q=new E,$=new E,J=new T,ee=function(e){_inherits(i,D);var t=_createSuper(i);function i(e,n){var r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=s.widthSegments,o=s.heightSegments,l=s.renderOrder,u=s.depthTest,c=s.cullFace,h=s.uniforms,d=s.vertexShaderID,f=s.fragmentShaderID,p=s.vertexShader,m=s.fragmentShader,g=s.texturesOptions,v=s.crossOrigin,y=s.alwaysDraw,b=void 0!==y&&y,_=s.visible,x=void 0===_||_,w=s.transparent,k=void 0!==w&&w,T=s.drawCheckMargins,E=void 0===T?{top:0,right:0,bottom:0,left:0}:T,P=s.autoloadSources,S=void 0===P||P,C=s.watchScroll,R=void 0===C||C,A=s.fov,M=void 0===A?50:A;return _classCallCheck(this,i),(r=t.call(this,e,n,"Plane",{widthSegments:a,heightSegments:o,renderOrder:l,depthTest:u,cullFace:c,uniforms:h,vertexShaderID:d,fragmentShaderID:f,vertexShader:p,fragmentShader:m,texturesOptions:g,crossOrigin:v})).gl?(r.index=r.renderer.planes.length,r.target=null,r.alwaysDraw=b,r._shouldDraw=!0,r.visible=x,r._transparent=k,r.drawCheckMargins=E,r.autoloadSources=S,r.watchScroll=R,r._updateMVMatrix=!1,r.camera=new I({fov:M,width:r.renderer._boundingRect.width,height:r.renderer._boundingRect.height,pixelRatio:r.renderer.pixelRatio}),r._program.compiled&&(r._initPlane(),r.renderer.scene.addPlane(_assertThisInitialized(r)),r.renderer.planes.push(_assertThisInitialized(r))),r):_possibleConstructorReturn(r)}return _createClass(i,[{key:"_programRestored",value:function(){this.target&&this.setRenderTarget(this.renderer.renderTargets[this.target.index]),this._initMatrices(),this.setPerspective(this.camera.fov,this.camera.near,this.camera.far),this._setWorldSizes(),this._applyWorldPositions(),this.renderer.scene.addPlane(this);for(var e=0;e<this.textures.length;e++)this.textures[e]._parent=this,this.textures[e]._restoreContext();this._canDraw=!0}},{key:"_initPlane",value:function(){this._initTransformValues(),this._initPositions(),this.setPerspective(this.camera.fov,this.camera.near,this.camera.far),this._initSources()}},{key:"_initTransformValues",value:function(){var e=this;this.rotation=new E,this.rotation.onChange(function(){return e._applyRotation()}),this.quaternion=new N,this.relativeTranslation=new E,this.relativeTranslation.onChange(function(){return e._setTranslation()}),this._translation=new E,this.scale=new E(1),this.scale.onChange(function(){e.scale.z=1,e._applyScale()}),this.transformOrigin=new E(.5,.5,0),this.transformOrigin.onChange(function(){e._setWorldTransformOrigin(),e._updateMVMatrix=!0})}},{key:"resetPlane",value:function(e){this._initTransformValues(),this._setWorldTransformOrigin(),null!==e&&e?(this.htmlElement=e,this.resize()):e||this.renderer.production||n(this.type+": You are trying to reset a plane with a HTML element that does not exist. The old HTML element will be kept instead.")}},{key:"removeRenderTarget",value:function(){this.target&&(this.renderer.scene.removePlane(this),this.target=null,this.renderer.scene.addPlane(this))}},{key:"_initPositions",value:function(){this._initMatrices(),this._setWorldSizes(),this._applyWorldPositions()}},{key:"_initMatrices",value:function(){var e=new k;this._matrices={world:{matrix:e},modelView:{name:"uMVMatrix",matrix:e,location:this.gl.getUniformLocation(this._program.program,"uMVMatrix")},projection:{name:"uPMatrix",matrix:e,location:this.gl.getUniformLocation(this._program.program,"uPMatrix")},modelViewProjection:{matrix:e}}}},{key:"_setPerspectiveMatrix",value:function(){this.camera._shouldUpdate&&(this.renderer.useProgram(this._program),this.gl.uniformMatrix4fv(this._matrices.projection.location,!1,this._matrices.projection.matrix.elements)),this.camera.cancelUpdate()}},{key:"setPerspective",value:function(e,t,n){this.camera.setPerspective(e,t,n,this.renderer._boundingRect.width,this.renderer._boundingRect.height,this.renderer.pixelRatio),this.renderer.state.isContextLost&&this.camera.forceUpdate(),this._matrices.projection.matrix=this.camera.projectionMatrix,this.camera._shouldUpdate&&(this._setWorldSizes(),this._applyWorldPositions(),this._translation.z=this.relativeTranslation.z/this.camera.CSSPerspective),this._updateMVMatrix=this.camera._shouldUpdate}},{key:"_setMVMatrix",value:function(){this._updateMVMatrix&&(this._matrices.world.matrix=this._matrices.world.matrix.composeFromOrigin(this._translation,this.quaternion,this.scale,this._boundingRect.world.transformOrigin),this._matrices.world.matrix.scale({x:this._boundingRect.world.width,y:this._boundingRect.world.height,z:1}),this._matrices.modelView.matrix.copy(this._matrices.world.matrix),this._matrices.modelView.matrix.elements[14]-=this.camera.position.z,this._matrices.modelViewProjection.matrix=this._matrices.projection.matrix.multiply(this._matrices.modelView.matrix),this.alwaysDraw||this._shouldDrawCheck(),this.renderer.useProgram(this._program),this.gl.uniformMatrix4fv(this._matrices.modelView.location,!1,this._matrices.modelView.matrix.elements)),this._updateMVMatrix=!1}},{key:"_setWorldTransformOrigin",value:function(){this._boundingRect.world.transformOrigin=new E((2*this.transformOrigin.x-1)*this._boundingRect.world.width,-(2*this.transformOrigin.y-1)*this._boundingRect.world.height,this.transformOrigin.z)}},{key:"_documentToWorldSpace",value:function(e){return V.set(e.x*this.renderer.pixelRatio/this.renderer._boundingRect.width*this._boundingRect.world.ratios.width,-e.y*this.renderer.pixelRatio/this.renderer._boundingRect.height*this._boundingRect.world.ratios.height,e.z)}},{key:"_setWorldSizes",value:function(){var e=this.camera.getScreenRatiosFromFov();this._boundingRect.world={width:this._boundingRect.document.width/this.renderer._boundingRect.width*e.width/2,height:this._boundingRect.document.height/this.renderer._boundingRect.height*e.height/2,ratios:e},this._setWorldTransformOrigin()}},{key:"_setWorldPosition",value:function(){var e=this._boundingRect.document.width/2+this._boundingRect.document.left,t=this._boundingRect.document.height/2+this._boundingRect.document.top,n=this.renderer._boundingRect.width/2+this.renderer._boundingRect.left,i=this.renderer._boundingRect.height/2+this.renderer._boundingRect.top;this._boundingRect.world.top=(i-t)/this.renderer._boundingRect.height*this._boundingRect.world.ratios.height,this._boundingRect.world.left=(e-n)/this.renderer._boundingRect.width*this._boundingRect.world.ratios.width}},{key:"setScale",value:function(e){e.type&&"Vec2"===e.type?(e.sanitizeNaNValuesWith(this.scale).max(z.set(.001,.001)),e.x===this.scale.x&&e.y===this.scale.y||(this.scale.set(e.x,e.y,1),this._applyScale())):this.renderer.production||n(this.type+": Cannot set scale because the parameter passed is not of Vec2 type:",e)}},{key:"_applyScale",value:function(){for(var e=0;e<this.textures.length;e++)this.textures[e].resize();this._updateMVMatrix=!0}},{key:"setRotation",value:function(e){e.type&&"Vec3"===e.type?(e.sanitizeNaNValuesWith(this.rotation),e.equals(this.rotation)||(this.rotation.copy(e),this._applyRotation())):this.renderer.production||n(this.type+": Cannot set rotation because the parameter passed is not of Vec3 type:",e)}},{key:"_applyRotation",value:function(){this.quaternion.setFromVec3(this.rotation),this._updateMVMatrix=!0}},{key:"setTransformOrigin",value:function(e){e.type&&"Vec3"===e.type?(e.sanitizeNaNValuesWith(this.transformOrigin),e.equals(this.transformOrigin)||(this.transformOrigin.copy(e),this._setWorldTransformOrigin(),this._updateMVMatrix=!0)):this.renderer.production||n(this.type+": Cannot set transform origin because the parameter passed is not of Vec3 type:",e)}},{key:"_setTranslation",value:function(){var e=U.set(0,0,0);this.relativeTranslation.equals(e)||(e=this._documentToWorldSpace(this.relativeTranslation)),this._translation.set(this._boundingRect.world.left+e.x,this._boundingRect.world.top+e.y,this.relativeTranslation.z/this.camera.CSSPerspective),this._updateMVMatrix=!0}},{key:"setRelativeTranslation",value:function(e){e.type&&"Vec3"===e.type?(e.sanitizeNaNValuesWith(this.relativeTranslation),e.equals(this.relativeTranslation)||(this.relativeTranslation.copy(e),this._setTranslation())):this.renderer.production||n(this.type+": Cannot set translation because the parameter passed is not of Vec3 type:",e)}},{key:"_applyWorldPositions",value:function(){this._setWorldPosition(),this._setTranslation()}},{key:"updatePosition",value:function(){this._setDocumentSizes(),this._applyWorldPositions()}},{key:"updateScrollPosition",value:function(e,t){(e||t)&&(this._boundingRect.document.top+=t*this.renderer.pixelRatio,this._boundingRect.document.left+=e*this.renderer.pixelRatio,this._applyWorldPositions())}},{key:"_getIntersection",value:function(e,t){for(var n=t.clone().sub(e),i=e.clone();i.z>-1;)i.add(n);return i}},{key:"_getNearPlaneIntersections",value:function(e,t,n){var i=this._matrices.modelViewProjection.matrix;if(1===n.length)0===n[0]?(t[0]=this._getIntersection(t[1],q.set(.95,1,0).applyMat4(i)),t.push(this._getIntersection(t[3],X.set(-1,-.95,0).applyMat4(i)))):1===n[0]?(t[1]=this._getIntersection(t[0],q.set(-.95,1,0).applyMat4(i)),t.push(this._getIntersection(t[2],X.set(1,-.95,0).applyMat4(i)))):2===n[0]?(t[2]=this._getIntersection(t[3],q.set(-.95,-1,0).applyMat4(i)),t.push(this._getIntersection(t[1],X.set(1,.95,0).applyMat4(i)))):3===n[0]&&(t[3]=this._getIntersection(t[2],q.set(.95,-1,0).applyMat4(i)),t.push(this._getIntersection(t[0],X.set(-1,.95,0).applyMat4(i))));else if(2===n.length)0===n[0]&&1===n[1]?(t[0]=this._getIntersection(t[3],q.set(-1,-.95,0).applyMat4(i)),t[1]=this._getIntersection(t[2],X.set(1,-.95,0).applyMat4(i))):1===n[0]&&2===n[1]?(t[1]=this._getIntersection(t[0],q.set(-.95,1,0).applyMat4(i)),t[2]=this._getIntersection(t[3],X.set(-.95,-1,0).applyMat4(i))):2===n[0]&&3===n[1]?(t[2]=this._getIntersection(t[1],q.set(1,.95,0).applyMat4(i)),t[3]=this._getIntersection(t[0],X.set(-1,.95,0).applyMat4(i))):0===n[0]&&3===n[1]&&(t[0]=this._getIntersection(t[1],q.set(.95,1,0).applyMat4(i)),t[3]=this._getIntersection(t[2],X.set(.95,-1,0).applyMat4(i)));else if(3===n.length){for(var r=0,s=0;s<e.length;s++)n.includes(s)||(r=s);t=[t[r]],0===r?(t.push(this._getIntersection(t[0],q.set(-.95,1,0).applyMat4(i))),t.push(this._getIntersection(t[0],X.set(-1,.95,0).applyMat4(i)))):1===r?(t.push(this._getIntersection(t[0],q.set(.95,1,0).applyMat4(i))),t.push(this._getIntersection(t[0],X.set(1,.95,0).applyMat4(i)))):2===r?(t.push(this._getIntersection(t[0],q.set(.95,-1,0).applyMat4(i))),t.push(this._getIntersection(t[0],X.set(1,-.95,0).applyMat4(i)))):3===r&&(t.push(this._getIntersection(t[0],q.set(-.95,-1,0).applyMat4(i))),t.push(this._getIntersection(t[0],X.set(-1.95,0).applyMat4(i))))}else for(var a=0;a<e.length;a++)t[a][0]=1e4,t[a][1]=1e4;return t}},{key:"_getWorldCoords",value:function(){for(var e=[B.set(-1,1,0),j.set(1,1,0),H.set(1,-1,0),W.set(-1,-1,0)],t=[],n=[],i=0;i<e.length;i++){var r=e[i].applyMat4(this._matrices.modelViewProjection.matrix);t.push(r),Math.abs(r.z)>1&&n.push(i)}n.length&&(t=this._getNearPlaneIntersections(e,t,n));for(var s=1/0,a=-1/0,o=1/0,l=-1/0,u=0;u<t.length;u++){var c=t[u];c.x<s&&(s=c.x),c.x>a&&(a=c.x),c.y<o&&(o=c.y),c.y>l&&(l=c.y)}return{top:l,right:a,bottom:o,left:s}}},{key:"_computeWebGLBoundingRect",value:function(){var e=this._getWorldCoords(),t={top:1-(e.top+1)/2,right:(e.right+1)/2,bottom:1-(e.bottom+1)/2,left:(e.left+1)/2};t.width=t.right-t.left,t.height=t.bottom-t.top,this._boundingRect.worldToDocument={width:t.width*this.renderer._boundingRect.width,height:t.height*this.renderer._boundingRect.height,top:t.top*this.renderer._boundingRect.height+this.renderer._boundingRect.top,left:t.left*this.renderer._boundingRect.width+this.renderer._boundingRect.left,right:t.left*this.renderer._boundingRect.width+this.renderer._boundingRect.left+t.width*this.renderer._boundingRect.width,bottom:t.top*this.renderer._boundingRect.height+this.renderer._boundingRect.top+t.height*this.renderer._boundingRect.height}}},{key:"getWebGLBoundingRect",value:function(){return this._matrices.modelViewProjection?(this._boundingRect.worldToDocument&&!this.alwaysDraw||this._computeWebGLBoundingRect(),this._boundingRect.worldToDocument):this._boundingRect.document}},{key:"_getWebGLDrawRect",value:function(){return this._computeWebGLBoundingRect(),{top:this._boundingRect.worldToDocument.top-this.drawCheckMargins.top,right:this._boundingRect.worldToDocument.right+this.drawCheckMargins.right,bottom:this._boundingRect.worldToDocument.bottom+this.drawCheckMargins.bottom,left:this._boundingRect.worldToDocument.left-this.drawCheckMargins.left}}},{key:"_shouldDrawCheck",value:function(){var e=this,t=this._getWebGLDrawRect();Math.round(t.right)<=this.renderer._boundingRect.left||Math.round(t.left)>=this.renderer._boundingRect.left+this.renderer._boundingRect.width||Math.round(t.bottom)<=this.renderer._boundingRect.top||Math.round(t.top)>=this.renderer._boundingRect.top+this.renderer._boundingRect.height?this._shouldDraw&&(this._shouldDraw=!1,this.renderer.nextRender.add(function(){return e._onLeaveViewCallback&&e._onLeaveViewCallback()})):(this._shouldDraw||this.renderer.nextRender.add(function(){return e._onReEnterViewCallback&&e._onReEnterViewCallback()}),this._shouldDraw=!0)}},{key:"isDrawn",value:function(){return this._canDraw&&this.visible&&(this._shouldDraw||this.alwaysDraw)}},{key:"enableDepthTest",value:function(e){this._depthTest=e}},{key:"_initSources",value:function(){var e=0;if(this.autoloadSources){var t=this.htmlElement.getElementsByTagName("img"),n=this.htmlElement.getElementsByTagName("video"),i=this.htmlElement.getElementsByTagName("canvas");t.length&&this.loadImages(t),n.length&&this.loadVideos(n),i.length&&this.loadCanvases(i),e=t.length+n.length+i.length}this.loader._setLoaderSize(e),this._canDraw=!0}},{key:"_startDrawing",value:function(){this._canDraw&&(this._onRenderCallback&&this._onRenderCallback(),this.target?this.renderer.bindFrameBuffer(this.target):null===this.renderer.state.scenePassIndex&&this.renderer.bindFrameBuffer(null),this._setPerspectiveMatrix(),this._setMVMatrix(),(this.alwaysDraw||this._shouldDraw)&&this.visible&&this._draw())}},{key:"mouseToPlaneCoords",value:function(e){if(G.setAxisOrder(this.quaternion.axisOrder),G.equals(this.quaternion)&&Y.equals(this.transformOrigin))return _get(_getPrototypeOf(i.prototype),"mouseToPlaneCoords",this).call(this,e);var t={x:e.x/(this.renderer._boundingRect.width/this.renderer.pixelRatio)*2-1,y:2*(1-e.y/(this.renderer._boundingRect.height/this.renderer.pixelRatio))-1},n=this.camera.position.clone(),r=Z.set(t.x,t.y,-.5);r.unproject(this.camera),r.sub(n).normalize();var s=K.set(0,0,-1);s.applyQuat(this.quaternion).normalize();var a=$.set(0,0,0),o=s.dot(r);if(Math.abs(o)>=1e-4){var l=this._matrices.world.matrix.getInverse().multiply(this.camera.viewMatrix),u=this._boundingRect.world.transformOrigin.clone().add(this._translation),c=Q.set(this._translation.x-u.x,this._translation.y-u.y,this._translation.z-u.z);c.applyQuat(this.quaternion),u.add(c);var h=s.dot(u.clone().sub(n))/o;a.copy(n.add(r.multiplyScalar(h))),a.applyMat4(l)}else a.set(1/0,1/0,1/0);return J.set(a.x,a.y)}},{key:"onReEnterView",value:function(e){return e&&(this._onReEnterViewCallback=e),this}},{key:"onLeaveView",value:function(e){return e&&(this._onLeaveViewCallback=e),this}}]),i}(),te=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=n.shaderPass,a=n.depth,o=void 0!==a&&a,l=n.clear,u=void 0===l||l,c=n.minWidth,h=void 0===c?1024:c,d=n.minHeight,f=void 0===d?1024:d,p=n.texturesOptions,m=void 0===p?{}:p;if(_classCallCheck(this,e),this.type="RenderTarget",(t=t&&t.renderer||t)&&"Renderer"===t.type){if(!t.gl)return void(t.production||i(this.type+": Unable to create a "+this.type+" because the Renderer WebGL context is not defined"))}else i(this.type+": Renderer not passed as first argument",t);this.renderer=t,this.gl=this.renderer.gl,this.index=this.renderer.renderTargets.length,this._shaderPass=s,this._depth=o,this._shouldClear=u,this._minSize={width:h*this.renderer.pixelRatio,height:f*this.renderer.pixelRatio},m=Object.assign({sampler:"uRenderTexture",isFBOTexture:!0,premultiplyAlpha:!1,anisotropy:1,generateMipmap:!1,floatingPoint:"none",wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,minFilter:this.gl.LINEAR,magFilter:this.gl.LINEAR},m),this._texturesOptions=m,this.userData={},this.uuid=r(),this.renderer.renderTargets.push(this),this.renderer.onSceneChange(),this._initRenderTarget()}return _createClass(e,[{key:"_initRenderTarget",value:function(){this._setSize(),this.textures=[],this._createFrameBuffer()}},{key:"_restoreContext",value:function(){this._setSize(),this._createFrameBuffer()}},{key:"_setSize",value:function(){this._shaderPass&&this._shaderPass._isScenePass?this._size={width:this.renderer._boundingRect.width,height:this.renderer._boundingRect.height}:this._size={width:Math.max(this._minSize.width,this.renderer._boundingRect.width),height:Math.max(this._minSize.height,this.renderer._boundingRect.height)}}},{key:"resize",value:function(){this._shaderPass&&(this._setSize(),this.textures[0].resize(),this.renderer.bindFrameBuffer(this,!0),this._depth&&this._bindDepthBuffer(),this.renderer.bindFrameBuffer(null))}},{key:"_bindDepthBuffer",value:function(){this._depthBuffer&&(this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this._depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this._size.width,this._size.height),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this._depthBuffer))}},{key:"_createFrameBuffer",value:function(){this._frameBuffer=this.gl.createFramebuffer(),this.renderer.bindFrameBuffer(this,!0),this.textures.length?(this.textures[0]._parent=this,this.textures[0]._restoreContext()):new R(this.renderer,this._texturesOptions).addParent(this),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.textures[0]._sampler.texture,0),this._depth&&(this._depthBuffer=this.gl.createRenderbuffer(),this._bindDepthBuffer()),this.renderer.bindFrameBuffer(null)}},{key:"getTexture",value:function(){return this.textures[0]}},{key:"remove",value:function(){this._shaderPass?this.renderer.production||n(this.type+": You're trying to remove a RenderTarget attached to a ShaderPass. You should remove that ShaderPass instead:",this._shaderPass):(this._dispose(),this.renderer.removeRenderTarget(this))}},{key:"_dispose",value:function(){this._frameBuffer&&(this.gl.deleteFramebuffer(this._frameBuffer),this._frameBuffer=null),this._depthBuffer&&(this.gl.deleteRenderbuffer(this._depthBuffer),this._depthBuffer=null),this.textures[0]._dispose(),this.textures=[]}}]),e}(),ne=function(e){_inherits(n,D);var t=_createSuper(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=(r.widthSegments,r.heightSegments,r.renderOrder),a=r.depthTest,o=(r.cullFace,r.uniforms),l=r.vertexShaderID,u=r.fragmentShaderID,c=r.vertexShader,h=r.fragmentShader,d=r.texturesOptions,f=r.crossOrigin,p=r.depth,m=void 0!==p&&p,g=r.clear,v=void 0===g||g,y=r.renderTarget;return _classCallCheck(this,n),1,1,"back",(i=t.call(this,e,e.container,"ShaderPass",{widthSegments:1,heightSegments:1,renderOrder:s,depthTest:a,cullFace:"back",uniforms:o,vertexShaderID:l,fragmentShaderID:u,vertexShader:c,fragmentShader:h,texturesOptions:d,crossOrigin:f})).gl?(i._isScenePass=!0,i.index=i.renderer.shaderPasses.length,i._depth=m,i._shouldClear=v,i.target=y,i.target&&(i._isScenePass=!1,i._shouldClear=i.target._shouldClear),i._program.compiled&&(i._initShaderPass(),i.renderer.shaderPasses.push(_assertThisInitialized(i)),i.renderer.nextRender.add(function(){i.renderer.scene.addShaderPass(_assertThisInitialized(i))})),i):_possibleConstructorReturn(i)}return _createClass(n,[{key:"_programRestored",value:function(){this.renderer.scene.addShaderPass(this);for(var e=0;e<this.textures.length;e++)this.textures[e]._parent=this,this.textures[e]._restoreContext();this._canDraw=!0}},{key:"_initShaderPass",value:function(){this.target?(this.setRenderTarget(this.target),this.target._shaderPass=this):this._createFrameBuffer(),new R(this.renderer,{sampler:"uRenderTexture",isFBOTexture:!0,fromTexture:this.target.getTexture()}).addParent(this),this.loader._setLoaderSize(0),this._canDraw=!0,this.renderer.needRender()}},{key:"_createFrameBuffer",value:function(){var e=new te(this.renderer,{shaderPass:this,clear:this._shouldClear,depth:this._depth,texturesOptions:this._texturesOptions});this.setRenderTarget(e)}},{key:"_startDrawing",value:function(){this._canDraw&&(this._onRenderCallback&&this._onRenderCallback(),this._isScenePass?this.renderer.state.scenePassIndex+1<this.renderer.scene.stacks.scenePasses.length?(this.renderer.bindFrameBuffer(this.renderer.scene.stacks.scenePasses[this.renderer.state.scenePassIndex+1].target),this.renderer.state.scenePassIndex++):this.renderer.bindFrameBuffer(null):null===this.renderer.state.scenePassIndex&&this.renderer.bindFrameBuffer(null),this.renderer.state.forceBufferUpdate=!0,this._draw())}}]),n}(),ie=function(e){_inherits(n,ee);var t=_createSuper(n);function n(e,i){var r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=s.sampler,o=void 0===a?"uPingPongTexture":a,l=s.widthSegments,u=s.heightSegments,c=s.renderOrder,h=(s.depthTest,s.cullFace),d=s.uniforms,f=s.vertexShaderID,p=s.fragmentShaderID,m=s.vertexShader,g=s.fragmentShader,v=s.texturesOptions,y=s.crossOrigin,b=s.alwaysDraw,_=s.visible,x=s.transparent,w=s.drawCheckMargins,k=(s.autoloadSources,s.watchScroll),T=s.fov;if(_classCallCheck(this,n),!1,!1,!(r=t.call(this,e,i,{widthSegments:l,heightSegments:u,renderOrder:c,depthTest:!1,cullFace:h,uniforms:d,vertexShaderID:f,fragmentShaderID:p,vertexShader:m,fragmentShader:g,texturesOptions:v,crossOrigin:y,alwaysDraw:b,visible:_,transparent:x,drawCheckMargins:w,autoloadSources:!1,watchScroll:k,fov:T})).gl)return _possibleConstructorReturn(r);r.renderer.scene.removePlane(_assertThisInitialized(r)),r.type="PingPongPlane",r.renderer.scene.addPlane(_assertThisInitialized(r)),r.readPass=new te(e,{depth:!1,clear:!1,texturesOptions:v}),r.writePass=new te(e,{depth:!1,clear:!1,texturesOptions:v}),r.createTexture({sampler:o});var E=0;return r.readPass.getTexture().onSourceUploaded(function(){E++,r._checkIfReady(E)}),r.writePass.getTexture().onSourceUploaded(function(){E++,r._checkIfReady(E)}),r.setRenderTarget(r.readPass),r._onRenderCallback=function(){r.readPass&&r.writePass&&r.textures[0]&&r.textures[0]._uploaded&&r.setRenderTarget(r.writePass),r._onPingPongRenderCallback&&r._onPingPongRenderCallback()},r._onAfterRenderCallback=function(){r.readPass&&r.writePass&&r.textures[0]&&r.textures[0]._uploaded&&r._swapPasses(),r._onPingPongAfterRenderCallback&&r._onPingPongAfterRenderCallback()},r}return _createClass(n,[{key:"_checkIfReady",value:function(e){var t=this;2===e&&this.renderer.nextRender.add(function(){t.textures[0].copy(t.target.getTexture())})}},{key:"_swapPasses",value:function(){var e=this.readPass;this.readPass=this.writePass,this.writePass=e,this.textures[0].copy(this.readPass.getTexture())}},{key:"getTexture",value:function(){return this.textures[0]}},{key:"onRender",value:function(e){return e&&(this._onPingPongRenderCallback=e),this}},{key:"onAfterRender",value:function(e){return e&&(this._onPingPongAfterRenderCallback=e),this}},{key:"remove",value:function(){this.target=null,this.renderer.bindFrameBuffer(null),this.writePass&&(this.writePass.remove(),this.writePass=null),this.readPass&&(this.readPass.remove(),this.readPass=null),_get(_getPrototypeOf(n.prototype),"remove",this).call(this)}}]),n}(),re=function(e){_inherits(n,ne);var t=_createSuper(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=r.renderOrder,a=r.depthTest,o=r.texturesOptions,l=r.crossOrigin,u=r.depth,c=r.clear,h=r.renderTarget;_classCallCheck(this,n);return(i=t.call(this,e,{fragmentShader:"\n            precision mediump float;\n            \n            varying vec3 vVertexPosition;\n            varying vec2 vTextureCoord;\n        \n            uniform sampler2D uRenderTexture;\n            \n            uniform vec2 uResolution;\n            \n            #define FXAA_REDUCE_MIN   (1.0/128.0)\n            #define FXAA_REDUCE_MUL   (1.0/8.0)\n            #define FXAA_SPAN_MAX     8.0\n            \n            void main() {\n                vec2 res = 1.0 / uResolution;\n            \n                vec3 rgbNW = texture2D(uRenderTexture, (vTextureCoord.xy + vec2(-1.0, -1.0) * res)).xyz;\n                vec3 rgbNE = texture2D(uRenderTexture, (vTextureCoord.xy + vec2(1.0, -1.0) * res)).xyz;\n                vec3 rgbSW = texture2D(uRenderTexture, (vTextureCoord.xy + vec2(-1.0, 1.0) * res)).xyz;\n                vec3 rgbSE = texture2D(uRenderTexture, (vTextureCoord.xy + vec2(1.0, 1.0) * res)).xyz;\n                vec4 rgbaM = texture2D(uRenderTexture, vTextureCoord.xy * res);\n                vec3 rgbM = rgbaM.xyz;\n                vec3 luma = vec3(0.299, 0.587, 0.114);\n            \n                float lumaNW = dot(rgbNW, luma);\n                float lumaNE = dot(rgbNE, luma);\n                float lumaSW = dot(rgbSW, luma);\n                float lumaSE = dot(rgbSE, luma);\n                float lumaM  = dot(rgbM,  luma);\n                float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n                float lumaMax = max(lumaM, max(max(lumaNW, lumaNE) , max(lumaSW, lumaSE)));\n            \n                vec2 dir;\n                dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n                dir.y = ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n            \n                float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n            \n                float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n                dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n                      max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                            dir * rcpDirMin)) * res;\n                vec4 rgbA = (1.0/2.0) * (\n                texture2D(uRenderTexture, vTextureCoord.xy + dir * (1.0/3.0 - 0.5)) +\n                texture2D(uRenderTexture, vTextureCoord.xy + dir * (2.0/3.0 - 0.5)));\n                vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (\n                texture2D(uRenderTexture, vTextureCoord.xy + dir * (0.0/3.0 - 0.5)) +\n                texture2D(uRenderTexture, vTextureCoord.xy + dir * (3.0/3.0 - 0.5)));\n                float lumaB = dot(rgbB, vec4(luma, 0.0));\n            \n                if ((lumaB < lumaMin) || (lumaB > lumaMax)) {\n                    gl_FragColor = rgbA;\n                } else {\n                    gl_FragColor = rgbB;\n                }\n            }\n        ",uniforms:{resolution:{name:"uResolution",type:"2f",value:[0,0]}},renderOrder:s,depthTest:a,texturesOptions:o,crossOrigin:l,depth:u,clear:c,renderTarget:h})).gl?(i.uniforms.resolution.value=[i.renderer._boundingRect.width,i.renderer._boundingRect.height],i._onAfterResizeCallback=function(){i.uniforms.resolution.value=[i.renderer._boundingRect.width,i.renderer._boundingRect.height],i._onFXAAPassAfterResizeCallback&&i._onFXAAPassAfterResizeCallback()},i):_possibleConstructorReturn(i)}return _createClass(n,[{key:"onAfterResize",value:function(e){return e&&(this._onFXAAPassAfterResizeCallback=e),this}}]),n}();e.Curtains=h,e.FXAAPass=re,e.Mat4=k,e.PingPongPlane=ie,e.Plane=ee,e.Quat=N,e.RenderTarget=te,e.ShaderPass=ne,e.Texture=R,e.TextureLoader=A,e.Vec2=T,e.Vec3=E,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).EmblaCarousel=t()}(this,function(){"use strict";function e(){return(e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function t(e){return e?e/Math.abs(e):0}function n(e,t){return Math.abs(e-t)}function i(e){var t=Math.pow(10,e);return function(e){return Math.round(e*t)/t}}function r(e){return Object.keys(e).map(Number)}function s(e,t){var n=e.classList;t&&n.contains(t)&&n.remove(t)}function a(e,t){var n=e.classList;t&&!n.contains(t)&&n.add(t)}function o(e){var n=e.start,i=e.limit,r=e.loop,s=i.min,a=i.max,l=i[r?"loop":"constrain"],u=l(n);function c(){return u}function h(e){return u=l(e),d}var d={add:function e(n){if(0!==n){var i=t(n);return h(c()+i),e(n+-1*i)}return d},clone:function(){return o({start:c(),limit:i,loop:r})},get:c,max:a,min:s,set:h};return d}function l(){var e=[],t={add:function(n,i,r,s){return void 0===s&&(s=!1),n.addEventListener(i,r,s),e.push(function(){return n.removeEventListener(i,r,s)}),t},removeAll:function(){return e=e.filter(function(e){return e()}),t}};return t}function u(e){var t=e;function n(e){return t/=e,r}function i(e){return"number"==typeof e?e:e.get()}var r={add:function(e){return t+=i(e),r},divide:n,get:function(){return t},multiply:function(e){return t*=e,r},normalize:function(){return 0!==t&&n(t),r},set:function(e){return t=i(e),r},subtract:function(e){return t-=i(e),r}};return r}function c(e){var i=e.target,r=e.scrollBody,s=e.dragFree,a=e.animation,o=e.axis,c=e.scrollTo,h=e.root,d=e.dragTracker,f=e.location,p=e.events,m=e.limit,g=e.direction,v=o.scroll,y=o.cross,b=["INPUT","SELECT","TEXTAREA"],_=u(0),x=u(0),w=u(0),k=l(),T=l(),E={mouse:2.5,touch:3.5},P={mouse:5,touch:7},S=s?5:12,C=!1,R=!1,A=!1,M=!1;function O(e){if(!(M="mousedown"===e.type)||0===e.button){var t,s=n(i.get(),f.get())>=2,a=M||!s,o=(t=e.target.nodeName||"",!(b.indexOf(t)>-1)),l=s||M&&o;C=!0,d.pointerDown(e),w.set(i),i.set(f),r.useBaseMass().useSpeed(80),function(){var e=M?document:h;T.add(e,"touchmove",L).add(e,"touchend",F).add(e,"mousemove",L).add(e,"mouseup",F)}(),_.set(d.readPoint(e,v)),x.set(d.readPoint(e,y)),p.emit("pointerDown"),a&&(A=!1),l&&e.preventDefault()}}function L(e){if(!R&&!M){if(!e.cancelable)return F();var t=d.readPoint(e,v).get(),r=d.readPoint(e,y).get(),s=n(t,_.get()),o=n(r,x.get());if(!(R=s>o)&&!A)return F()}var l=d.pointerMove(e);!A&&l&&(A=!0),a.start(),i.add(g.applyTo(l)),e.preventDefault()}function F(){var a=d.pointerUp()*(s?P:E)[M?"mouse":"touch"],o=function(n){var i=e.scrollTarget,r=e.index,a=!(i.byDistance(0,!1).index!==r.get())&&Math.abs(n)>4,o=n+f.get();if(a&&!s&&!m.reachedAny(o)){var l=r.clone().add(-1*t(n));return i.byIndex(l.get(),0).distance}return i.byDistance(n,!s).distance}(g.applyTo(a)),l=function(e,t){if(0===e||0===t)return 0;if(Math.abs(e)<=Math.abs(t))return 0;var i=n(Math.abs(e),Math.abs(t));return Math.abs(i/e)}(a,o);n(i.get(),w.get())>=.5&&!M&&(A=!0),R=!1,C=!1,T.removeAll(),r.useSpeed(S+S*l),c.distance(o,!s),M=!1,p.emit("pointerUp")}function D(e){A&&e.preventDefault()}return{addActivationEvents:function(){var e=h;k.add(e,"touchmove",function(){}).add(e,"touchend",function(){}).add(e,"touchstart",O).add(e,"mousedown",O).add(e,"touchcancel",F).add(e,"contextmenu",F).add(e,"click",D)},clickAllowed:function(){return!A},pointerDown:function(){return C},removeAllEvents:function(){k.removeAll(),T.removeAll()}}}function h(e){var t=e.axis,n=e.pxToPercent,i=t.scroll,r={x:"clientX",y:"clientY"},s=u(0),a=u(0),o=u(0),l=u(0),c=[],h=(new Date).getTime(),d=!1;function f(e,t){d=!e.touches;var n=r[t],i=d?e[n]:e.touches[0][n];return l.set(i)}return{pointerDown:function(e){var t=f(e,i);return s.set(t),o.set(t),n.measure(s.get())},pointerMove:function(e){var t=f(e,i),r=(new Date).getTime(),s=r-h;return s>=10&&(s>=100&&(c=[]),c.push(t.get()),h=r),a.set(t).subtract(o),o.set(t),n.measure(a.get())},pointerUp:function(){var e=(new Date).getTime()-h,t=o.get(),i=c.slice(-5).map(function(e){return t-e}).sort(function(e,t){return Math.abs(e)<Math.abs(t)?1:-1})[0];return o.set(e>100||!i?0:i),c=[],n.measure(o.get())},readPoint:f}}function d(e){var t=e.min,n=e.max,i=Math.abs(t-n);function r(e){return e<t}function s(e){return e>n}function a(e){return r(e)||s(e)}return{constrain:function(e){return a(e)?r(e)?t:n:e},length:i,loop:function(e){return a(e)?r(e)?n:t:e},max:n,min:t,reachedAny:a,reachedMax:s,reachedMin:r,removeOffset:function(e){if(t===n)return e;for(;r(e);)e+=i;for(;s(e);)e-=i;return e}}}function f(e){var n=e.location,r=e.speed,s=e.mass,a=i(2),o=u(0),l=u(0),c=u(0),h=0,d=r,f=s;function p(e){return d=e,g}function m(e){return f=e,g}var g={direction:function(){return h},seek:function(e){c.set(e).subtract(n);var i=0+(c.get()-0)/100*(d-0);return h=t(c.get()),c.normalize().multiply(i).subtract(o),function(e){e.divide(f),l.add(e)}(c),g},settle:function(e){var t=e.get()-n.get(),i=!a(t);return i&&n.set(e),i},update:function(){o.add(l),n.add(o),l.multiply(0)},useBaseMass:function(){return m(s)},useBaseSpeed:function(){return p(r)},useMass:m,useSpeed:p};return g}function p(e){var t=e.limit,n=e.location,i=e.scrollBody,r=!1;return{constrain:function(e,s){if(function(e){return!r&&!!t.reachedAny(e.get())&&!!t.reachedAny(n.get())}(e)){var a=s?.7:.4,o=e.get()-n.get();e.subtract(o*a),!s&&Math.abs(o)<10&&(e.set(t.constrain(e.get())),i.useSpeed(10).useMass(3))}},toggleActive:function(e){r=!e}}}function m(e){var t=e.contentSize,n=e.location,i=e.limit,r=e.pxToPercent,s=d({min:i.min+r.measure(.1),max:i.max+r.measure(.1)}),a=s.reachedMin,o=s.reachedMax;return{loop:function(e,i){if(function(e){return 1===e?o(n.get()):-1===e&&a(n.get())}(i)){var r=t*(-1*i);e.forEach(function(e){return e.add(r)})}}}}function g(e){var t,n=e.axis,i=e.location,s=e.slidesInView,a=e.direction,o=e.contentSize,l=e.viewSize,u=e.slideSizes,c=e.scrollSnaps,h=r(u),d=r(u).reverse(),f=(t=c[0]-1,v(g(d,t),"end")).concat(function(){var e=l-c[0]-1;return v(g(h,e),"start")}()),p="x"===n.scroll?"left":"top";function m(e,t){return e.reduce(function(e,t){return e-u[t]},t)}function g(e,t){return e.reduce(function(e,n){return m(e,t)>0?e.concat([n]):e},[])}function v(e,t){var n="start"===t,r=n?-o:o,a=s.findSlideBounds(r);return e.map(function(e){var t=n?0:-o,r=n?o:0,s=a.filter(function(t){return t.index===e})[0][n?"end":"start"];return{point:s,getTarget:function(){return i.get()>s?t:r},index:e,location:-1}})}return{canLoop:function(){return f.every(function(e){var t=e.index;return m(h.filter(function(e){return e!==t}),l)<=0})},clear:function(e){f.forEach(function(t){var n=t.index;e[n].style[p]=""})},loop:function(e){f.forEach(function(t){var n=t.getTarget,i=t.location,r=t.index,s=n();s!==i&&(e[r].style[p]=a.applyTo(s)+"%",t.location=s)})},loopPoints:f}}function v(e){var t=e.scrollTo,n=e.slidesToScroll,i=e.root,r=l(),s=r.removeAll,a=0;function o(e){9===e.keyCode&&(a=(new Date).getTime())}function u(e,s){r.add(e,"focus",function(){if(!((new Date).getTime()-a>10)){i.scrollLeft=0;var e=Math.floor(s/n);t.index(e,0)}},!0)}return{addActivationEvents:function(e){r.add(document,"keydown",o,!1),e.forEach(u)},removeAllEvents:s}}function y(e){var t=e.axis,n=e.container,r=e.direction,s=n.style,a="x"===t.scroll?function(e){return"translate3d("+e+"%,0px,0px)"}:function(e){return"translate3d(0px,"+e+"%,0px)"},o=i(2),l=!1,u=0;return{clear:function(){s.transform="",u=0},to:function(e){var t=o(e.get());l||u===t||(getComputedStyle(n).transform,s.transform=a(r.applyTo(t)),u=t)},toggleActive:function(e){l=!e}}}function b(e,t,n,i,s){var a,l,b,_,x,w=i.align,k=i.axis,T=i.direction,E=i.startIndex,P=i.inViewThreshold,S=i.loop,C=i.speed,R=i.dragFree,A=i.slidesToScroll,M=i.containScroll,O=function(e){var t="y"===k?"y":"x";return{cross:"y"===k?"x":"y",measure:function(e){var n=e.getBoundingClientRect(),i=n.width,r=n.height;return"x"===t?i:r},scroll:t}}(),L=(a=O.measure(t),{measure:function(e){return e/a*100},totalPercent:100}),F=L.totalPercent,D=n.map(O.measure).map(L.measure),I=r(D),N=function(e,t){for(var n=[],i=0;i<e.length;i+=t)n.push(e.slice(i,i+t));return n}(D,A).map(function(e){return e.reduce(function(e,t){return e+t})}),z=D.reduce(function(e,t){return e+t},0),U=function(e){var t=e.viewSize,n=e.align,i={start:function(){return 0},center:function(e){return r(e)/2},end:r};function r(e){return t-e}return{measure:function(e){return"number"==typeof n?t*Number(n):i[n](e)}}}({align:w,viewSize:F}),V=function(e){var t,n=e.snapSizes,i=e.alignment,r=e.loop,s=n.map(i.measure),a=(t=o({limit:d({min:0,max:n.length-1}),start:0,loop:r}),n.map(function(e,n){var i=t.set(n+1).get();return e+s[n]-s[i]}));return{measure:function(e){return a.slice(0,e).reduce(function(e,t){return e-t},s[0])}}}({snapSizes:N,alignment:U,loop:S}),B=r(N).map(V.measure),j=function(e){var t=e.alignment,n=e.contentSize,i=e.viewSize,r=d({min:-n+i,max:0}),s=[t.measure(n)],a=n>i;return{measure:function(e,t){var n=e.map(r.constrain),i=function(e){var t=e[0],n=e[e.length-1];return d({min:e.lastIndexOf(t)+1,max:e.indexOf(n)})}(n),o=i.min,l=i.max;return a?t?n.slice(o-1,l+1):n:s}}}({alignment:U,contentSize:z,viewSize:F}),H=!S&&""!==M,W="trimSnaps"===M,q=j.measure(B,W),X=H?q:B,G=function(e){var t=e.contentSize,n=e.loop;return{measure:function(e){var i=e[0],r=e[e.length-1];return d({min:n?i-t:r,max:i})}}}({loop:S,contentSize:z}).measure(X),Y=function(e){var t="rtl"===T?-1:1;return{applyTo:function(e){return e*t}}}(),Z=o({limit:d({min:0,max:Math.max(0,X.length-1)}),start:E,loop:S}),K=Z.clone(),Q=function(e){var t=0;function n(e,n){return function(){e===!!t&&n()}}function i(){t=window.requestAnimationFrame(e)}return{proceed:n(!0,i),start:n(!1,i),stop:n(!0,function(){window.cancelAnimationFrame(t),t=0})}}(function(){S||ae.scrollBounds.constrain(ee,ae.dragHandler.pointerDown()),ae.scrollBody.seek(ee).update();var e=ae.scrollBody.settle(ee);e&&!ae.dragHandler.pointerDown()&&(ae.animation.stop(),s.emit("settle")),e||s.emit("scroll"),S&&(ae.scrollLooper.loop(te,ae.scrollBody.direction()),ae.slideLooper.loop(n)),ae.translate.to(J),ae.animation.proceed()}),$=X[Z.get()],J=u($),ee=u($),te=[J,ee],ne=f({location:J,speed:C,mass:1}),ie=function(e){var t=e.loop,n=e.limit,i=e.scrollSnaps,r=e.contentSize,s=n.reachedMax,a=n.reachedAny,o=n.removeOffset;function l(e,t){return Math.abs(e)<Math.abs(t)?e:t}function u(e,n){var i=e,s=e+r,a=e-r;if(!t)return i;if(!n)return l(l(i,s),a);var o=l(i,1===n?s:a);return Math.abs(o)*n}return{byDistance:function(n,r){var l=e.target.get()+n,c=function(e){var t=o(l);return{index:i.map(function(e){return e-t}).map(function(e){return u(e,0)}).map(function(e,t){return{diff:e,index:t}}).sort(function(e,t){return Math.abs(e.diff)-Math.abs(t.diff)})[0].index,distance:t}}(),h=function(n,i){if(t||!a(n))return i;var r=e.index,o=r.min,l=r.max;return s(n)?o:l}(l,c.index),d=!t&&a(l);return!r||d?{index:h,distance:n}:{index:h,distance:n+u(i[h]-c.distance,0)}},byIndex:function(t,n){return{index:t,distance:u(i[t]-e.target.get(),n)}},shortcut:u}}({contentSize:z,index:Z,limit:G,loop:S,scrollSnaps:X,target:ee}),re=function(e){var t=e.index,n=e.scrollTarget,i=e.animation,r=e.indexPrevious,s=e.events,a=e.target;function o(e){var n=e.distance,o=e.index!==t.get();n&&(i.start(),a.add(n)),o&&(r.set(t.get()),t.set(e.index),s.emit("select"))}return{distance:function(e,t){o(n.byDistance(e,t))},index:function(e,i){var r=t.clone().set(e);o(n.byIndex(r.get(),i))}}}({animation:Q,events:s,index:Z,indexPrevious:K,scrollTarget:ie,target:ee}),se=function(e){var t=e.contentSize,n=e.slideSizes,i=e.viewSize,s=e.inViewThreshold,a=e.loop,o=Math.min(Math.max(s,.01),.99),l=r(n).map(function(e){return n.slice(0,e).reduce(function(e,t){return e-t},0)}),u=(a?[0,t,-t]:[0]).reduce(function(e,t){return e.concat(c(t,o))},[]);function c(e,t){var r=n.map(function(e){return e*(t||0)});return l.map(function(t,s){return{start:t-n[s]+r[s]+e,end:t+i-r[s]+e,index:s}})}return{check:function(e){return u.reduce(function(t,n){var i=n.index,r=n.start,s=n.end;return-1===t.indexOf(i)&&r<e&&s>e?t.concat([i]):t},[])},findSlideBounds:c}}({contentSize:z,inViewThreshold:P,loop:S,slideSizes:D,viewSize:F}),ae={animation:Q,axis:O,direction:Y,dragHandler:c({animation:Q,axis:O,direction:Y,dragFree:R,dragTracker:h({axis:O,pxToPercent:L}),root:e,events:s,index:Z,limit:G,location:J,scrollBody:ne,scrollTo:re,scrollTarget:ie,target:ee}),pxToPercent:L,index:Z,indexPrevious:K,limit:G,location:J,options:i,scrollBody:ne,scrollBounds:p({limit:G,location:J,scrollBody:ne}),scrollLooper:m({contentSize:z,limit:G,location:J,pxToPercent:L}),scrollProgress:(l={limit:G},b=l.limit,_=b.max,x=b.length,{get:function(e){return(e-_)/-x}}),scrollSnaps:X,scrollTarget:ie,scrollTo:re,slideFocus:v({root:e,scrollTo:re,slidesToScroll:A}),slideLooper:g({axis:O,contentSize:z,direction:Y,location:J,scrollSnaps:X,slideSizes:D,slidesInView:se,viewSize:F}),slidesInView:se,slideIndexes:I,target:ee,translate:y({axis:O,container:t,direction:Y})};return ae}var _={align:"center",axis:"x",containScroll:"",containerSelector:"*",direction:"ltr",dragFree:!1,draggable:!0,draggableClass:"is-draggable",draggingClass:"is-dragging",inViewThreshold:0,loop:!1,selectedClass:"is-selected",slidesToScroll:1,speed:10,startIndex:0};return function(t,n){var i,r,o,u,c,h=function(){var e={};function t(t){return e[t]||[]}var n={emit:function(e){return t(e).forEach(function(t){return t(e)}),n},off:function(i,r){return e[i]=t(i).filter(function(e){return e!==r}),n},on:function(i,r){return e[i]=t(i).concat([r]),n}};return n}(),d=l(),f=(i=function(){if(v){var e=o.axis.measure(t);x!==e&&P(),h.emit("resize")}},500,r=0,function(){window.clearTimeout(r),r=window.setTimeout(i,500)||0}),p=P,m=h.on,g=h.off,v=!1,y=e({},_),x=0;function w(n){if(function(){if(!t)throw new Error("Missing root node 😢");var e=y.containerSelector,n=t.querySelector(e);if(!n)throw new Error("Missing container node 😢");u=n,c=Array.prototype.slice.call(u.children)}(),y=e(y,n),o=b(t,u,c,y,h),x=o.axis.measure(t),d.add(window,"resize",f),o.translate.to(o.location),y.loop){if(!o.slideLooper.canLoop())return E(),w({loop:!1});o.slideLooper.loop(c)}y.draggable&&c.length&&(o.dragHandler.addActivationEvents(),y.draggableClass&&a(t,y.draggableClass),y.draggingClass&&h.on("pointerDown",k).on("pointerUp",k)),c.length&&o.slideFocus.addActivationEvents(c),y.selectedClass&&(T(),h.on("select",T).on("pointerUp",T)),v||(setTimeout(function(){return h.emit("init")},0),v=!0)}function k(e){var n=y.draggingClass;"pointerDown"===e?a(t,n):s(t,n)}function T(){var e=y.selectedClass,t=S(!0);C(!0).forEach(function(t){return s(c[t],e)}),t.forEach(function(t){return a(c[t],e)})}function E(){o.dragHandler.removeAllEvents(),o.slideFocus.removeAllEvents(),o.animation.stop(),d.removeAll(),o.translate.clear(),o.slideLooper.clear(c),s(t,y.draggableClass),c.forEach(function(e){return s(e,y.selectedClass)}),h.off("select",T),h.off("pointerUp",T),h.off("pointerDown",k),h.off("pointerUp",k)}function P(t){if(v){var n=e({startIndex:A()},t);E(),w(n),h.emit("reInit")}}function S(e){var t=o[e?"target":"location"].get(),n=y.loop?"removeOffset":"constrain";return o.slidesInView.check(o.limit[n](t))}function C(e){var t=S(e);return o.slideIndexes.filter(function(e){return-1===t.indexOf(e)})}function R(e,t){o.scrollBody.useBaseMass().useBaseSpeed(),v&&o.scrollTo.index(e,t||0)}function A(){return o.index.get()}return w(n),{canScrollNext:function(){return o.index.clone().add(1).get()!==A()},canScrollPrev:function(){return o.index.clone().add(-1).get()!==A()},clickAllowed:function(){return o.dragHandler.clickAllowed()},containerNode:function(){return u},dangerouslyGetEngine:function(){return o},destroy:function(){v&&(E(),v=!1,h.emit("destroy"))},off:g,on:m,previousScrollSnap:function(){return o.indexPrevious.get()},reInit:p,scrollNext:function(){R(o.index.clone().add(1).get(),-1)},scrollPrev:function(){R(o.index.clone().add(-1).get(),1)},scrollProgress:function(){return o.scrollProgress.get(o.location.get())},scrollSnapList:function(){return o.scrollSnaps.map(o.scrollProgress.get)},scrollTo:R,selectedScrollSnap:A,slideNodes:function(){return c},slidesInView:S,slidesNotInView:C}}}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.anime=t()}(this,function(){"use strict";var e={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},t={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},n=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],i={CSS:{},springs:{}};function r(e,t,n){return Math.min(Math.max(e,t),n)}function s(e,t){return e.indexOf(t)>-1}function a(e,t){return e.apply(null,t)}var o={arr:function(e){return Array.isArray(e)},obj:function(e){return s(Object.prototype.toString.call(e),"Object")},pth:function(e){return o.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return e.nodeType||o.svg(e)},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return void 0===e},nil:function(e){return o.und(e)||null===e},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return o.hex(e)||o.rgb(e)||o.hsl(e)},key:function(n){return!e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&"targets"!==n&&"keyframes"!==n}};function l(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map(function(e){return parseFloat(e)}):[]}function u(e,t){var n=l(e),s=r(o.und(n[0])?1:n[0],.1,100),a=r(o.und(n[1])?100:n[1],.1,100),u=r(o.und(n[2])?10:n[2],.1,100),c=r(o.und(n[3])?0:n[3],.1,100),h=Math.sqrt(a/s),d=u/(2*Math.sqrt(a*s)),f=d<1?h*Math.sqrt(1-d*d):0,p=1,m=d<1?(d*h-c)/f:-c+h;function g(e){var n=t?t*e/1e3:e;return n=d<1?Math.exp(-n*d*h)*(p*Math.cos(f*n)+m*Math.sin(f*n)):(p+m*n)*Math.exp(-n*h),0===e||1===e?e:1-n}return t?g:function(){var t=i.springs[e];if(t)return t;for(var n=0,r=0;;)if(1===g(n+=1/6)){if(++r>=16)break}else r=0;var s=n*(1/6)*1e3;return i.springs[e]=s,s}}function c(e){return void 0===e&&(e=10),function(t){return Math.ceil(r(t,1e-6,1)*e)*(1/e)}}var h,d,f=function(){var e=11,t=1/(e-1);function n(e,t){return 1-3*t+3*e}function i(e,t){return 3*t-6*e}function r(e){return 3*e}function s(e,t,s){return((n(t,s)*e+i(t,s))*e+r(t))*e}function a(e,t,s){return 3*n(t,s)*e*e+2*i(t,s)*e+r(t)}return function(n,i,r,o){if(0<=n&&n<=1&&0<=r&&r<=1){var l=new Float32Array(e);if(n!==i||r!==o)for(var u=0;u<e;++u)l[u]=s(u*t,n,r);return function(e){return n===i&&r===o?e:0===e||1===e?e:s(c(e),i,o)}}function c(i){for(var o=0,u=1,c=e-1;u!==c&&l[u]<=i;++u)o+=t;var h=o+(i-l[--u])/(l[u+1]-l[u])*t,d=a(h,n,r);return d>=.001?function(e,t,n,i){for(var r=0;r<4;++r){var o=a(t,n,i);if(0===o)return t;t-=(s(t,n,i)-e)/o}return t}(i,h,n,r):0===d?h:function(e,t,n,i,r){for(var a,o,l=0;(a=s(o=t+(n-t)/2,i,r)-e)>0?n=o:t=o,Math.abs(a)>1e-7&&++l<10;);return o}(i,o,o+t,n,r)}}}(),p=(h={linear:function(){return function(e){return e}}},d={Sine:function(){return function(e){return 1-Math.cos(e*Math.PI/2)}},Circ:function(){return function(e){return 1-Math.sqrt(1-e*e)}},Back:function(){return function(e){return e*e*(3*e-2)}},Bounce:function(){return function(e){for(var t,n=4;e<((t=Math.pow(2,--n))-1)/11;);return 1/Math.pow(4,3-n)-7.5625*Math.pow((3*t-2)/22-e,2)}},Elastic:function(e,t){void 0===e&&(e=1),void 0===t&&(t=.5);var n=r(e,1,10),i=r(t,.1,2);return function(e){return 0===e||1===e?e:-n*Math.pow(2,10*(e-1))*Math.sin((e-1-i/(2*Math.PI)*Math.asin(1/n))*(2*Math.PI)/i)}}},["Quad","Cubic","Quart","Quint","Expo"].forEach(function(e,t){d[e]=function(){return function(e){return Math.pow(e,t+2)}}}),Object.keys(d).forEach(function(e){var t=d[e];h["easeIn"+e]=t,h["easeOut"+e]=function(e,n){return function(i){return 1-t(e,n)(1-i)}},h["easeInOut"+e]=function(e,n){return function(i){return i<.5?t(e,n)(2*i)/2:1-t(e,n)(-2*i+2)/2}},h["easeOutIn"+e]=function(e,n){return function(i){return i<.5?(1-t(e,n)(1-2*i))/2:(t(e,n)(2*i-1)+1)/2}}}),h);function m(e,t){if(o.fnc(e))return e;var n=e.split("(")[0],i=p[n],r=l(e);switch(n){case"spring":return u(e,t);case"cubicBezier":return a(f,r);case"steps":return a(c,r);default:return a(i,r)}}function g(e){try{return document.querySelectorAll(e)}catch(e){return}}function v(e,t){for(var n=e.length,i=arguments.length>=2?arguments[1]:void 0,r=[],s=0;s<n;s++)if(s in e){var a=e[s];t.call(i,a,s,e)&&r.push(a)}return r}function y(e){return e.reduce(function(e,t){return e.concat(o.arr(t)?y(t):t)},[])}function b(e){return o.arr(e)?e:(o.str(e)&&(e=g(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function _(e,t){return e.some(function(e){return e===t})}function x(e){var t={};for(var n in e)t[n]=e[n];return t}function w(e,t){var n=x(e);for(var i in e)n[i]=t.hasOwnProperty(i)?t[i]:e[i];return n}function k(e,t){var n=x(e);for(var i in t)n[i]=o.und(e[i])?t[i]:e[i];return n}function T(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function E(e,t){return o.fnc(e)?e(t.target,t.id,t.total):e}function P(e,t){return e.getAttribute(t)}function S(e,t,n){if(_([n,"deg","rad","turn"],T(t)))return t;var r=i.CSS[t+n];if(!o.und(r))return r;var s=document.createElement(e.tagName),a=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;a.appendChild(s),s.style.position="absolute",s.style.width=100+n;var l=100/s.offsetWidth;a.removeChild(s);var u=l*parseFloat(t);return i.CSS[t+n]=u,u}function C(e,t,n){if(t in e.style){var i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=e.style[t]||getComputedStyle(e).getPropertyValue(i)||"0";return n?S(e,r,n):r}}function R(e,t){return o.dom(e)&&!o.inp(e)&&(!o.nil(P(e,t))||o.svg(e)&&e[t])?"attribute":o.dom(e)&&_(n,t)?"transform":o.dom(e)&&"transform"!==t&&C(e,t)?"css":null!=e[t]?"object":void 0}function A(e){if(o.dom(e)){for(var t,n=e.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map;t=i.exec(n);)r.set(t[1],t[2]);return r}}function M(e,t,n,i){switch(R(e,t)){case"transform":return function(e,t,n,i){var r,a=s(t,"scale")?1:0+(s(r=t,"translate")||"perspective"===r?"px":s(r,"rotate")||s(r,"skew")?"deg":void 0),o=A(e).get(t)||a;return n&&(n.transforms.list.set(t,o),n.transforms.last=t),i?S(e,o,i):o}(e,t,i,n);case"css":return C(e,t,n);case"attribute":return P(e,t);default:return e[t]||0}}function O(e,t){var n=/^(\*=|\+=|-=)/.exec(e);if(!n)return e;var i=T(e)||0,r=parseFloat(t),s=parseFloat(e.replace(n[0],""));switch(n[0][0]){case"+":return r+s+i;case"-":return r-s+i;case"*":return r*s+i}}function L(e,t){if(o.col(e))return function(e){return o.rgb(e)?(n=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(t=e))?"rgba("+n[1]+",1)":t:o.hex(e)?(i=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,i){return t+t+n+n+i+i}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),"rgba("+parseInt(r[1],16)+","+parseInt(r[2],16)+","+parseInt(r[3],16)+",1)"):o.hsl(e)?function(e){var t,n,i,r=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),s=parseInt(r[1],10)/360,a=parseInt(r[2],10)/100,o=parseInt(r[3],10)/100,l=r[4]||1;function u(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(0==a)t=n=i=o;else{var c=o<.5?o*(1+a):o+a-o*a,h=2*o-c;t=u(h,c,s+1/3),n=u(h,c,s),i=u(h,c,s-1/3)}return"rgba("+255*t+","+255*n+","+255*i+","+l+")"}(e):void 0;var t,n,i,r}(e);if(/\s/g.test(e))return e;var n=T(e),i=n?e.substr(0,e.length-n.length):e;return t?i+t:i}function F(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function D(e){for(var t,n=e.points,i=0,r=0;r<n.numberOfItems;r++){var s=n.getItem(r);r>0&&(i+=F(t,s)),t=s}return i}function I(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return s=e,2*Math.PI*P(s,"r");case"rect":return 2*P(r=e,"width")+2*P(r,"height");case"line":return F({x:P(i=e,"x1"),y:P(i,"y1")},{x:P(i,"x2"),y:P(i,"y2")});case"polyline":return D(e);case"polygon":return n=(t=e).points,D(t)+F(n.getItem(n.numberOfItems-1),n.getItem(0))}var t,n,i,r,s}function N(e,t){var n=t||{},i=n.el||function(e){for(var t=e.parentNode;o.svg(t)&&o.svg(t.parentNode);)t=t.parentNode;return t}(e),r=i.getBoundingClientRect(),s=P(i,"viewBox"),a=r.width,l=r.height,u=n.viewBox||(s?s.split(" "):[0,0,a,l]);return{el:i,viewBox:u,x:u[0]/1,y:u[1]/1,w:a,h:l,vW:u[2],vH:u[3]}}function z(e,t,n){function i(n){void 0===n&&(n=0);var i=t+n>=1?t+n:0;return e.el.getPointAtLength(i)}var r=N(e.el,e.svg),s=i(),a=i(-1),o=i(1),l=n?1:r.w/r.vW,u=n?1:r.h/r.vH;switch(e.property){case"x":return(s.x-r.x)*l;case"y":return(s.y-r.y)*u;case"angle":return 180*Math.atan2(o.y-a.y,o.x-a.x)/Math.PI}}function U(e,t){var n=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,i=L(o.pth(e)?e.totalLength:e,t)+"";return{original:i,numbers:i.match(n)?i.match(n).map(Number):[0],strings:o.str(e)||t?i.split(n):[]}}function V(e){return v(e?y(o.arr(e)?e.map(b):b(e)):[],function(e,t,n){return n.indexOf(e)===t})}function B(e){var t=V(e);return t.map(function(e,n){return{target:e,id:n,total:t.length,transforms:{list:A(e)}}})}function j(e,t){var n=x(t);if(/^spring/.test(n.easing)&&(n.duration=u(n.easing)),o.arr(e)){var i=e.length;2!==i||o.obj(e[0])?o.fnc(t.duration)||(n.duration=t.duration/i):e={value:e}}var r=o.arr(e)?e:[e];return r.map(function(e,n){var i=o.obj(e)&&!o.pth(e)?e:{value:e};return o.und(i.delay)&&(i.delay=n?0:t.delay),o.und(i.endDelay)&&(i.endDelay=n===r.length-1?t.endDelay:0),i}).map(function(e){return k(e,n)})}function H(e,t){var n=[],i=t.keyframes;for(var r in i&&(t=k(function(e){for(var t=v(y(e.map(function(e){return Object.keys(e)})),function(e){return o.key(e)}).reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[]),n={},i=function(i){var r=t[i];n[r]=e.map(function(e){var t={};for(var n in e)o.key(n)?n==r&&(t.value=e[n]):t[n]=e[n];return t})},r=0;r<t.length;r++)i(r);return n}(i),t)),t)o.key(r)&&n.push({name:r,tweens:j(t[r],e)});return n}var W={css:function(e,t,n){return e.style[t]=n},attribute:function(e,t,n){return e.setAttribute(t,n)},object:function(e,t,n){return e[t]=n},transform:function(e,t,n,i,r){if(i.list.set(t,n),t===i.last||r){var s="";i.list.forEach(function(e,t){s+=t+"("+e+") "}),e.style.transform=s}}};function q(e,t){B(e).forEach(function(e){for(var n in t){var i=E(t[n],e),r=e.target,s=T(i),a=M(r,n,s,e),o=O(L(i,s||T(a)),a),l=R(r,n);W[l](r,n,o,e.transforms,!0)}})}function X(e,t){return v(y(e.map(function(e){return t.map(function(t){return function(e,t){var n=R(e.target,t.name);if(n){var i=function(e,t){var n;return e.tweens.map(function(i){var r=function(e,t){var n={};for(var i in e){var r=E(e[i],t);o.arr(r)&&1===(r=r.map(function(e){return E(e,t)})).length&&(r=r[0]),n[i]=r}return n.duration=parseFloat(n.duration),n.delay=parseFloat(n.delay),n}(i,t),s=r.value,a=o.arr(s)?s[1]:s,l=T(a),u=M(t.target,e.name,l,t),c=n?n.to.original:u,h=o.arr(s)?s[0]:c,d=T(h)||T(u),f=l||d;return o.und(a)&&(a=c),r.from=U(h,f),r.to=U(O(a,h),f),r.start=n?n.end:0,r.end=r.start+r.delay+r.duration+r.endDelay,r.easing=m(r.easing,r.duration),r.isPath=o.pth(s),r.isPathTargetInsideSVG=r.isPath&&o.svg(t.target),r.isColor=o.col(r.from.original),r.isColor&&(r.round=1),n=r,r})}(t,e),r=i[i.length-1];return{type:n,property:t.name,animatable:e,tweens:i,duration:r.end,delay:i[0].delay,endDelay:r.endDelay}}}(e,t)})})),function(e){return!o.und(e)})}function G(e,t){var n=e.length,i=function(e){return e.timelineOffset?e.timelineOffset:0},r={};return r.duration=n?Math.max.apply(Math,e.map(function(e){return i(e)+e.duration})):t.duration,r.delay=n?Math.min.apply(Math,e.map(function(e){return i(e)+e.delay})):t.delay,r.endDelay=n?r.duration-Math.max.apply(Math,e.map(function(e){return i(e)+e.duration-e.endDelay})):t.endDelay,r}var Y=0,Z=[],K=function(){var e;function t(n){for(var i=Z.length,r=0;r<i;){var s=Z[r];s.paused?(Z.splice(r,1),i--):(s.tick(n),r++)}e=r>0?requestAnimationFrame(t):void 0}return"undefined"!=typeof document&&document.addEventListener("visibilitychange",function(){$.suspendWhenDocumentHidden&&(Q()?e=cancelAnimationFrame(e):(Z.forEach(function(e){return e._onDocumentVisibility()}),K()))}),function(){e||Q()&&$.suspendWhenDocumentHidden||!(Z.length>0)||(e=requestAnimationFrame(t))}}();function Q(){return!!document&&document.hidden}function $(n){void 0===n&&(n={});var i,s=0,a=0,o=0,l=0,u=null;function c(e){var t=window.Promise&&new Promise(function(e){return u=e});return e.finished=t,t}var h,d,f,p,m,g,y,b,_=(d=w(e,h=n),p=H(f=w(t,h),h),y=G(g=X(m=B(h.targets),p),f),b=Y,Y++,k(d,{id:b,children:[],animatables:m,animations:g,duration:y.duration,delay:y.delay,endDelay:y.endDelay}));function x(){var e=_.direction;"alternate"!==e&&(_.direction="normal"!==e?"normal":"reverse"),_.reversed=!_.reversed,i.forEach(function(e){return e.reversed=_.reversed})}function T(e){return _.reversed?_.duration-e:e}function E(){s=0,a=T(_.currentTime)*(1/$.speed)}function P(e,t){t&&t.seek(e-t.timelineOffset)}function S(e){for(var t=0,n=_.animations,i=n.length;t<i;){var s=n[t],a=s.animatable,o=s.tweens,l=o.length-1,u=o[l];l&&(u=v(o,function(t){return e<t.end})[0]||u);for(var c=r(e-u.start-u.delay,0,u.duration)/u.duration,h=isNaN(c)?1:u.easing(c),d=u.to.strings,f=u.round,p=[],m=u.to.numbers.length,g=void 0,y=0;y<m;y++){var b=void 0,x=u.to.numbers[y],w=u.from.numbers[y]||0;b=u.isPath?z(u.value,h*x,u.isPathTargetInsideSVG):w+h*(x-w),f&&(u.isColor&&y>2||(b=Math.round(b*f)/f)),p.push(b)}var k=d.length;if(k){g=d[0];for(var T=0;T<k;T++){d[T];var E=d[T+1],P=p[T];isNaN(P)||(g+=E?P+E:P+" ")}}else g=p[0];W[s.type](a.target,s.property,g,a.transforms),s.currentValue=g,t++}}function C(e){_[e]&&!_.passThrough&&_[e](_)}function R(e){var t=_.duration,n=_.delay,h=t-_.endDelay,d=T(e);_.progress=r(d/t*100,0,100),_.reversePlayback=d<_.currentTime,i&&function(e){if(_.reversePlayback)for(var t=l;t--;)P(e,i[t]);else for(var n=0;n<l;n++)P(e,i[n])}(d),!_.began&&_.currentTime>0&&(_.began=!0,C("begin")),!_.loopBegan&&_.currentTime>0&&(_.loopBegan=!0,C("loopBegin")),d<=n&&0!==_.currentTime&&S(0),(d>=h&&_.currentTime!==t||!t)&&S(t),d>n&&d<h?(_.changeBegan||(_.changeBegan=!0,_.changeCompleted=!1,C("changeBegin")),C("change"),S(d)):_.changeBegan&&(_.changeCompleted=!0,_.changeBegan=!1,C("changeComplete")),_.currentTime=r(d,0,t),_.began&&C("update"),e>=t&&(a=0,_.remaining&&!0!==_.remaining&&_.remaining--,_.remaining?(s=o,C("loopComplete"),_.loopBegan=!1,"alternate"===_.direction&&x()):(_.paused=!0,_.completed||(_.completed=!0,C("loopComplete"),C("complete"),!_.passThrough&&"Promise"in window&&(u(),c(_)))))}return c(_),_.reset=function(){var e=_.direction;_.passThrough=!1,_.currentTime=0,_.progress=0,_.paused=!0,_.began=!1,_.loopBegan=!1,_.changeBegan=!1,_.completed=!1,_.changeCompleted=!1,_.reversePlayback=!1,_.reversed="reverse"===e,_.remaining=_.loop,i=_.children;for(var t=l=i.length;t--;)_.children[t].reset();(_.reversed&&!0!==_.loop||"alternate"===e&&1===_.loop)&&_.remaining++,S(_.reversed?_.duration:0)},_._onDocumentVisibility=E,_.set=function(e,t){return q(e,t),_},_.tick=function(e){o=e,s||(s=o),R((o+(a-s))*$.speed)},_.seek=function(e){R(T(e))},_.pause=function(){_.paused=!0,E()},_.play=function(){_.paused&&(_.completed&&_.reset(),_.paused=!1,Z.push(_),E(),K())},_.reverse=function(){x(),_.completed=!_.reversed,E()},_.restart=function(){_.reset(),_.play()},_.remove=function(e){ee(V(e),_)},_.reset(),_.autoplay&&_.play(),_}function J(e,t){for(var n=t.length;n--;)_(e,t[n].animatable.target)&&t.splice(n,1)}function ee(e,t){var n=t.animations,i=t.children;J(e,n);for(var r=i.length;r--;){var s=i[r],a=s.animations;J(e,a),a.length||s.children.length||i.splice(r,1)}n.length||i.length||t.pause()}return $.version="3.2.1",$.speed=1,$.suspendWhenDocumentHidden=!0,$.running=Z,$.remove=function(e){for(var t=V(e),n=Z.length;n--;)ee(t,Z[n])},$.get=M,$.set=q,$.convertPx=S,$.path=function(e,t){var n=o.str(e)?g(e)[0]:e,i=t||100;return function(e){return{property:e,el:n,svg:N(n),totalLength:I(n)*(i/100)}}},$.setDashoffset=function(e){var t=I(e);return e.setAttribute("stroke-dasharray",t),t},$.stagger=function(e,t){void 0===t&&(t={});var n=t.direction||"normal",i=t.easing?m(t.easing):null,r=t.grid,s=t.axis,a=t.from||0,l="first"===a,u="center"===a,c="last"===a,h=o.arr(e),d=h?parseFloat(e[0]):parseFloat(e),f=h?parseFloat(e[1]):0,p=T(h?e[1]:e)||0,g=t.start||0+(h?d:0),v=[],y=0;return function(e,t,o){if(l&&(a=0),u&&(a=(o-1)/2),c&&(a=o-1),!v.length){for(var m=0;m<o;m++){if(r){var b=u?(r[0]-1)/2:a%r[0],_=u?(r[1]-1)/2:Math.floor(a/r[0]),x=b-m%r[0],w=_-Math.floor(m/r[0]),k=Math.sqrt(x*x+w*w);"x"===s&&(k=-x),"y"===s&&(k=-w),v.push(k)}else v.push(Math.abs(a-m));y=Math.max.apply(Math,v)}i&&(v=v.map(function(e){return i(e/y)*y})),"reverse"===n&&(v=v.map(function(e){return s?e<0?-1*e:-e:Math.abs(y-e)}))}return g+(h?(f-d)/y:d)*(Math.round(100*v[t])/100)+p}},$.timeline=function(e){void 0===e&&(e={});var n=$(e);return n.duration=0,n.add=function(i,r){var s=Z.indexOf(n),a=n.children;function l(e){e.passThrough=!0}s>-1&&Z.splice(s,1);for(var u=0;u<a.length;u++)l(a[u]);var c=k(i,w(t,e));c.targets=c.targets||e.targets;var h=n.duration;c.autoplay=!1,c.direction=n.direction,c.timelineOffset=o.und(r)?h:O(r,h),l(n),n.seek(c.timelineOffset);var d=$(c);l(d),a.push(d);var f=G(a,e);return n.delay=f.delay,n.endDelay=f.endDelay,n.duration=f.duration,n.seek(0),n.reset(),n.autoplay&&n.play(),n},n},$.easing=m,$.penner=p,$.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},$}),"object"==typeof navigator&&function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Plyr",t):(e="undefined"!=typeof globalThis?globalThis:e||self).Plyr=t()}(this,function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(i=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{i||null==o.return||o.return()}finally{if(r)throw s}}return n}}(e,t)||u(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||u(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){d(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var m={addCSS:!0,thumbWidth:15,watch:!0};var g=function(e){return null!=e?e.constructor:null},v=function(e,t){return!!(e&&t&&e instanceof t)},y=function(e){return g(e)===String},b=function(e){return Array.isArray(e)},_=function(e){return v(e,NodeList)},x=y,w=b,k=_,T=function(e){return v(e,Element)},E=function(e){return v(e,Event)},P=function(e){return function(e){return null==e}(e)||(y(e)||b(e)||_(e))&&!e.length||function(e){return g(e)===Object}(e)&&!Object.keys(e).length};var S,C,R,A=function(){function e(t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),T(t)?this.element=t:x(t)&&(this.element=document.querySelector(t)),T(this.element)&&P(this.element.rangeTouch)&&(this.config=p({},m,{},n),this.init())}return function(e,t,n){t&&h(e.prototype,t),n&&h(e,n)}(e,[{key:"init",value:function(){e.enabled&&(this.config.addCSS&&(this.element.style.userSelect="none",this.element.style.webKitUserSelect="none",this.element.style.touchAction="manipulation"),this.listeners(!0),this.element.rangeTouch=this)}},{key:"destroy",value:function(){e.enabled&&(this.config.addCSS&&(this.element.style.userSelect="",this.element.style.webKitUserSelect="",this.element.style.touchAction=""),this.listeners(!1),this.element.rangeTouch=null)}},{key:"listeners",value:function(e){var t=this,n=e?"addEventListener":"removeEventListener";["touchstart","touchmove","touchend"].forEach(function(e){t.element[n](e,function(e){return t.set(e)},!1)})}},{key:"get",value:function(t){if(!e.enabled||!E(t))return null;var n,i=t.target,r=t.changedTouches[0],s=parseFloat(i.getAttribute("min"))||0,a=parseFloat(i.getAttribute("max"))||100,o=parseFloat(i.getAttribute("step"))||1,l=i.getBoundingClientRect(),u=100/l.width*(this.config.thumbWidth/2)/100;return 0>(n=100/l.width*(r.clientX-l.left))?n=0:100<n&&(n=100),50>n?n-=(100-2*n)*u:50<n&&(n+=2*(n-50)*u),s+function(e,t){if(1>t){var n=function(e){var t="".concat(e).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0}(t);return parseFloat(e.toFixed(n))}return Math.round(e/t)*t}(n/100*(a-s),o)}},{key:"set",value:function(t){e.enabled&&E(t)&&!t.target.disabled&&(t.preventDefault(),t.target.value=this.get(t),function(e,t){if(e&&t){var n=new Event(t,{bubbles:!0});e.dispatchEvent(n)}}(t.target,"touchend"===t.type?"change":"input"))}}],[{key:"setup",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=null;if(P(t)||x(t)?i=Array.from(document.querySelectorAll(x(t)?t:'input[type="range"]')):T(t)?i=[t]:k(t)?i=Array.from(t):w(t)&&(i=t.filter(T)),P(i))return null;var r=p({},m,{},n);x(t)&&r.watch&&new MutationObserver(function(n){Array.from(n).forEach(function(n){Array.from(n.addedNodes).forEach(function(n){T(n)&&function(e,t){return function(){return Array.from(document.querySelectorAll(t)).includes(this)}.call(e,t)}(n,t)&&new e(n,r)})})}).observe(document.body,{childList:!0,subtree:!0});return i.map(function(t){return new e(t,n)})}},{key:"enabled",get:function(){return"ontouchstart"in document.documentElement}}]),e}(),M=function(e){return null!=e?e.constructor:null},O=function(e,t){return Boolean(e&&t&&e instanceof t)},L=function(e){return null==e},F=function(e){return M(e)===Object},D=function(e){return M(e)===String},I=function(e){return M(e)===Function},N=function(e){return Array.isArray(e)},z=function(e){return O(e,NodeList)},U=function(e){return L(e)||(D(e)||N(e)||z(e))&&!e.length||F(e)&&!Object.keys(e).length},V=L,B=F,j=function(e){return M(e)===Number&&!Number.isNaN(e)},H=D,W=function(e){return M(e)===Boolean},q=I,X=N,G=z,Y=function(t){return null!==t&&"object"===e(t)&&1===t.nodeType&&"object"===e(t.style)&&"object"===e(t.ownerDocument)},Z=function(e){return O(e,Event)},K=function(e){return O(e,KeyboardEvent)},Q=function(e){return O(e,TextTrack)||!L(e)&&D(e.kind)},$=function(e){return O(e,Promise)&&I(e.then)},J=function(e){if(O(e,window.URL))return!0;if(!D(e))return!1;var t=e;e.startsWith("http://")&&e.startsWith("https://")||(t="http://".concat(e));try{return!U(new URL(t).hostname)}catch(e){return!1}},ee=U,te=(S=document.createElement("span"),C={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},R=Object.keys(C).find(function(e){return void 0!==S.style[e]}),!!H(R)&&C[R]);function ne(e,t){setTimeout(function(){try{e.hidden=!0,e.offsetHeight,e.hidden=!1}catch(e){}},t)}var ie={isIE:!!document.documentMode,isEdge:window.navigator.userAgent.includes("Edge"),isWebkit:"WebkitAppearance"in document.documentElement.style&&!/Edge/.test(navigator.userAgent),isIPhone:/(iPhone|iPod)/gi.test(navigator.platform),isIos:/(iPad|iPhone|iPod)/gi.test(navigator.platform)};function re(e,t){return t.split(".").reduce(function(e,t){return e&&e[t]},e)}function se(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(!n.length)return e;var s=n.shift();return B(s)?(Object.keys(s).forEach(function(t){B(s[t])?(Object.keys(e).includes(t)||Object.assign(e,r({},t,{})),se(e[t],s[t])):Object.assign(e,r({},t,s[t]))}),se.apply(void 0,[e].concat(n))):e}function ae(e,t){var n=e.length?e:[e];Array.from(n).reverse().forEach(function(e,n){var i=n>0?t.cloneNode(!0):t,r=e.parentNode,s=e.nextSibling;i.appendChild(e),s?r.insertBefore(i,s):r.appendChild(i)})}function oe(e,t){Y(e)&&!ee(t)&&Object.entries(t).filter(function(e){var t=o(e,2)[1];return!V(t)}).forEach(function(t){var n=o(t,2),i=n[0],r=n[1];return e.setAttribute(i,r)})}function le(e,t,n){var i=document.createElement(e);return B(t)&&oe(i,t),H(n)&&(i.innerText=n),i}function ue(e,t,n,i){Y(t)&&t.appendChild(le(e,n,i))}function ce(e){G(e)||X(e)?Array.from(e).forEach(ce):Y(e)&&Y(e.parentNode)&&e.parentNode.removeChild(e)}function he(e){if(Y(e))for(var t=e.childNodes.length;t>0;)e.removeChild(e.lastChild),t-=1}function de(e,t){return Y(t)&&Y(t.parentNode)&&Y(e)?(t.parentNode.replaceChild(e,t),e):null}function fe(e,t){if(!H(e)||ee(e))return{};var n={},i=se({},t);return e.split(",").forEach(function(e){var t=e.trim(),r=t.replace(".",""),s=t.replace(/[[\]]/g,"").split("="),a=o(s,1)[0],l=s.length>1?s[1].replace(/["']/g,""):"";switch(t.charAt(0)){case".":H(i.class)?n.class="".concat(i.class," ").concat(r):n.class=r;break;case"#":n.id=t.replace("#","");break;case"[":n[a]=l}}),se(i,n)}function pe(e,t){if(Y(e)){var n=t;W(n)||(n=!e.hidden),e.hidden=n}}function me(e,t,n){if(G(e))return Array.from(e).map(function(e){return me(e,t,n)});if(Y(e)){var i="toggle";return void 0!==n&&(i=n?"add":"remove"),e.classList[i](t),e.classList.contains(t)}return!1}function ge(e,t){return Y(e)&&e.classList.contains(t)}function ve(e,t){var n=Element.prototype;return(n.matches||n.webkitMatchesSelector||n.mozMatchesSelector||n.msMatchesSelector||function(){return Array.from(document.querySelectorAll(t)).includes(this)}).call(e,t)}function ye(e){return this.elements.container.querySelectorAll(e)}function be(e){return this.elements.container.querySelector(e)}function _e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Y(e)&&(e.focus({preventScroll:!0}),t&&me(e,this.config.classNames.tabFocus))}var xe,we={"audio/ogg":"vorbis","audio/wav":"1","video/webm":"vp8, vorbis","video/mp4":"avc1.42E01E, mp4a.40.2","video/ogg":"theora"},ke={audio:"canPlayType"in document.createElement("audio"),video:"canPlayType"in document.createElement("video"),check:function(e,t,n){var i=ie.isIPhone&&n&&ke.playsinline,r=ke[e]||"html5"!==t;return{api:r,ui:r&&ke.rangeInput&&("video"!==e||!ie.isIPhone||i)}},pip:!(ie.isIPhone||!q(le("video").webkitSetPresentationMode)&&(!document.pictureInPictureEnabled||le("video").disablePictureInPicture)),airplay:q(window.WebKitPlaybackTargetAvailabilityEvent),playsinline:"playsInline"in document.createElement("video"),mime:function(e){if(ee(e))return!1;var t=o(e.split("/"),1)[0],n=e;if(!this.isHTML5||t!==this.type)return!1;Object.keys(we).includes(n)&&(n+='; codecs="'.concat(we[e],'"'));try{return Boolean(n&&this.media.canPlayType(n).replace(/no/,""))}catch(e){return!1}},textTracks:"textTracks"in document.createElement("video"),rangeInput:(xe=document.createElement("input"),xe.type="range","range"===xe.type),touch:"ontouchstart"in document.documentElement,transitions:!1!==te,reducedMotion:"matchMedia"in window&&window.matchMedia("(prefers-reduced-motion)").matches},Te=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){return e=!0,null}});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(e){}return e}();function Ee(e,t,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(e&&"addEventListener"in e&&!ee(t)&&q(n)){var o=t.split(" "),l=a;Te&&(l={passive:s,capture:a}),o.forEach(function(t){i&&i.eventListeners&&r&&i.eventListeners.push({element:e,type:t,callback:n,options:l}),e[r?"addEventListener":"removeEventListener"](t,n,l)})}}function Pe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Ee.call(this,e,t,n,!0,i,r)}function Se(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Ee.call(this,e,t,n,!1,i,r)}function Ce(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Ee.call(this,e,n,function a(){Se(e,n,a,r,s);for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];i.apply(t,l)},!0,r,s)}function Re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(Y(e)&&!ee(t)){var r=new CustomEvent(t,{bubbles:n,detail:a(a({},i),{},{plyr:this})});e.dispatchEvent(r)}}function Ae(e){$(e)&&e.then(null,function(){})}function Me(e){return!!(X(e)||H(e)&&e.includes(":"))&&(X(e)?e:e.split(":")).map(Number).every(j)}function Oe(e){if(!X(e)||!e.every(j))return null;var t=o(e,2),n=t[0],i=t[1],r=function e(t,n){return 0===n?t:e(n,t%n)}(n,i);return[n/r,i/r]}function Le(e){var t=function(e){return Me(e)?e.split(":").map(Number):null},n=t(e);if(null===n&&(n=t(this.config.ratio)),null===n&&!ee(this.embed)&&X(this.embed.ratio)&&(n=this.embed.ratio),null===n&&this.isHTML5){var i=this.media;n=Oe([i.videoWidth,i.videoHeight])}return n}function Fe(e){if(!this.isVideo)return{};var t=this.elements.wrapper,n=Le.call(this,e),i=o(X(n)?n:[0,0],2),r=100/i[0]*i[1];if(t.style.paddingBottom="".concat(r,"%"),this.isVimeo&&!this.config.vimeo.premium&&this.supported.ui){var s=100/this.media.offsetWidth*parseInt(window.getComputedStyle(this.media).paddingBottom,10),a=(s-r)/(s/50);this.fullscreen.active?t.style.paddingBottom=null:this.media.style.transform="translateY(-".concat(a,"%)")}else this.isHTML5&&t.classList.toggle(this.config.classNames.videoFixedRatio,null!==n);return{padding:r,ratio:n}}var De={getSources:function(){var e=this;return this.isHTML5?Array.from(this.media.querySelectorAll("source")).filter(function(t){var n=t.getAttribute("type");return!!ee(n)||ke.mime.call(e,n)}):[]},getQualityOptions:function(){return this.config.quality.forced?this.config.quality.options:De.getSources.call(this).map(function(e){return Number(e.getAttribute("size"))}).filter(Boolean)},setup:function(){if(this.isHTML5){var e=this;e.options.speed=e.config.speed.options,ee(this.config.ratio)||Fe.call(e),Object.defineProperty(e.media,"quality",{get:function(){var t=De.getSources.call(e).find(function(t){return t.getAttribute("src")===e.source});return t&&Number(t.getAttribute("size"))},set:function(t){if(e.quality!==t){if(e.config.quality.forced&&q(e.config.quality.onChange))e.config.quality.onChange(t);else{var n=De.getSources.call(e).find(function(e){return Number(e.getAttribute("size"))===t});if(!n)return;var i=e.media,r=i.currentTime,s=i.paused,a=i.preload,o=i.readyState,l=i.playbackRate;e.media.src=n.getAttribute("src"),("none"!==a||o)&&(e.once("loadedmetadata",function(){e.speed=l,e.currentTime=r,s||Ae(e.play())}),e.media.load())}Re.call(e,e.media,"qualitychange",!1,{quality:t})}}})}},cancelRequests:function(){this.isHTML5&&(ce(De.getSources.call(this)),this.media.setAttribute("src",this.config.blankVideo),this.media.load(),this.debug.log("Cancelled network requests"))}};function Ie(e){return X(e)?e.filter(function(t,n){return e.indexOf(t)===n}):e}function Ne(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return ee(e)?e:e.toString().replace(/{(\d+)}/g,function(e,t){return n[t].toString()})}var ze=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return e.replace(new RegExp(t.toString().replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),"g"),n.toString())},Ue=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})};function Ve(e){var t=document.createElement("div");return t.appendChild(e),t.innerHTML}var Be={pip:"PIP",airplay:"AirPlay",html5:"HTML5",vimeo:"Vimeo",youtube:"YouTube"},je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(ee(e)||ee(t))return"";var n=re(t.i18n,e);if(ee(n))return Object.keys(Be).includes(e)?Be[e]:"";var i={"{seektime}":t.seekTime,"{title}":t.title};return Object.entries(i).forEach(function(e){var t=o(e,2),i=t[0],r=t[1];n=ze(n,i,r)}),n},He=function(){function e(n){var i=this;t(this,e),r(this,"get",function(t){if(!e.supported||!i.enabled)return null;var n=window.localStorage.getItem(i.key);if(ee(n))return null;var r=JSON.parse(n);return H(t)&&t.length?r[t]:r}),r(this,"set",function(t){if(e.supported&&i.enabled&&B(t)){var n=i.get();ee(n)&&(n={}),se(n,t),window.localStorage.setItem(i.key,JSON.stringify(n))}}),this.enabled=n.config.storage.enabled,this.key=n.config.storage.key}return i(e,null,[{key:"supported",get:function(){try{if(!("localStorage"in window))return!1;var e="___test";return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(e){return!1}}}]),e}();function We(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";return new Promise(function(n,i){try{var r=new XMLHttpRequest;if(!("withCredentials"in r))return;r.addEventListener("load",function(){if("text"===t)try{n(JSON.parse(r.responseText))}catch(e){n(r.responseText)}else n(r.response)}),r.addEventListener("error",function(){throw new Error(r.status)}),r.open("GET",e,!0),r.responseType=t,r.send()}catch(e){i(e)}})}function qe(e,t){if(H(e)){var n="cache",i=H(t),r=function(){return null!==document.getElementById(t)},s=function(e,t){e.innerHTML=t,i&&r()||document.body.insertAdjacentElement("afterbegin",e)};if(!i||!r()){var a=He.supported,o=document.createElement("div");if(o.setAttribute("hidden",""),i&&o.setAttribute("id",t),a){var l=window.localStorage.getItem("".concat(n,"-").concat(t));if(null!==l){var u=JSON.parse(l);s(o,u.content)}}We(e).then(function(e){ee(e)||(a&&window.localStorage.setItem("".concat(n,"-").concat(t),JSON.stringify({content:e})),s(o,e))}).catch(function(){})}}}var Xe=function(e){return Math.trunc(e/60/60%60,10)},Ge=function(e){return Math.trunc(e/60%60,10)},Ye=function(e){return Math.trunc(e%60,10)};function Ze(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!j(e))return Ze(void 0,t,n);var i=function(e){return"0".concat(e).slice(-2)},r=Xe(e),s=Ge(e),a=Ye(e);return r=t||r>0?"".concat(r,":"):"","".concat(n&&e>0?"-":"").concat(r).concat(i(s),":").concat(i(a))}var Ke={getIconUrl:function(){var e=new URL(this.config.iconUrl,window.location).host!==window.location.host||ie.isIE&&!window.svg4everybody;return{url:this.config.iconUrl,cors:e}},findElements:function(){try{return this.elements.controls=be.call(this,this.config.selectors.controls.wrapper),this.elements.buttons={play:ye.call(this,this.config.selectors.buttons.play),pause:be.call(this,this.config.selectors.buttons.pause),restart:be.call(this,this.config.selectors.buttons.restart),rewind:be.call(this,this.config.selectors.buttons.rewind),fastForward:be.call(this,this.config.selectors.buttons.fastForward),mute:be.call(this,this.config.selectors.buttons.mute),pip:be.call(this,this.config.selectors.buttons.pip),airplay:be.call(this,this.config.selectors.buttons.airplay),settings:be.call(this,this.config.selectors.buttons.settings),captions:be.call(this,this.config.selectors.buttons.captions),fullscreen:be.call(this,this.config.selectors.buttons.fullscreen)},this.elements.progress=be.call(this,this.config.selectors.progress),this.elements.inputs={seek:be.call(this,this.config.selectors.inputs.seek),volume:be.call(this,this.config.selectors.inputs.volume)},this.elements.display={buffer:be.call(this,this.config.selectors.display.buffer),currentTime:be.call(this,this.config.selectors.display.currentTime),duration:be.call(this,this.config.selectors.display.duration)},Y(this.elements.progress)&&(this.elements.display.seekTooltip=this.elements.progress.querySelector(".".concat(this.config.classNames.tooltip))),!0}catch(e){return this.debug.warn("It looks like there is a problem with your custom controls HTML",e),this.toggleNativeControls(!0),!1}},createIcon:function(e,t){var n="https://www.w3.org/2000/svg",i=Ke.getIconUrl.call(this),r="".concat(i.cors?"":i.url,"#").concat(this.config.iconPrefix),s=document.createElementNS(n,"svg");oe(s,se(t,{"aria-hidden":"true",focusable:"false"}));var a=document.createElementNS(n,"use"),o="".concat(r,"-").concat(e);return"href"in a&&a.setAttributeNS("https://www.w3.org/1999/xlink","href",o),a.setAttributeNS("https://www.w3.org/1999/xlink","xlink:href",o),s.appendChild(a),s},createLabel:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=je(e,this.config);return le("span",a(a({},t),{},{class:[t.class,this.config.classNames.hidden].filter(Boolean).join(" ")}),n)},createBadge:function(e){if(ee(e))return null;var t=le("span",{class:this.config.classNames.menu.value});return t.appendChild(le("span",{class:this.config.classNames.menu.badge},e)),t},createButton:function(e,t){var n=this,i=se({},t),r=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString();return(e=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toString();return e=ze(e,"-"," "),e=ze(e,"_"," "),e=Ue(e),ze(e," ","")}(e)).charAt(0).toLowerCase()+e.slice(1)}(e),s={element:"button",toggle:!1,label:null,icon:null,labelPressed:null,iconPressed:null};switch(["element","icon","label"].forEach(function(e){Object.keys(i).includes(e)&&(s[e]=i[e],delete i[e])}),"button"!==s.element||Object.keys(i).includes("type")||(i.type="button"),Object.keys(i).includes("class")?i.class.split(" ").some(function(e){return e===n.config.classNames.control})||se(i,{class:"".concat(i.class," ").concat(this.config.classNames.control)}):i.class=this.config.classNames.control,e){case"play":s.toggle=!0,s.label="play",s.labelPressed="pause",s.icon="play",s.iconPressed="pause";break;case"mute":s.toggle=!0,s.label="mute",s.labelPressed="unmute",s.icon="volume",s.iconPressed="muted";break;case"captions":s.toggle=!0,s.label="enableCaptions",s.labelPressed="disableCaptions",s.icon="captions-off",s.iconPressed="captions-on";break;case"fullscreen":s.toggle=!0,s.label="enterFullscreen",s.labelPressed="exitFullscreen",s.icon="enter-fullscreen",s.iconPressed="exit-fullscreen";break;case"play-large":i.class+=" ".concat(this.config.classNames.control,"--overlaid"),r="play",s.label="play",s.icon="play";break;default:ee(s.label)&&(s.label=r),ee(s.icon)&&(s.icon=e)}var a=le(s.element);return s.toggle?(a.appendChild(Ke.createIcon.call(this,s.iconPressed,{class:"icon--pressed"})),a.appendChild(Ke.createIcon.call(this,s.icon,{class:"icon--not-pressed"})),a.appendChild(Ke.createLabel.call(this,s.labelPressed,{class:"label--pressed"})),a.appendChild(Ke.createLabel.call(this,s.label,{class:"label--not-pressed"}))):(a.appendChild(Ke.createIcon.call(this,s.icon)),a.appendChild(Ke.createLabel.call(this,s.label))),se(i,fe(this.config.selectors.buttons[r],i)),oe(a,i),"play"===r?(X(this.elements.buttons[r])||(this.elements.buttons[r]=[]),this.elements.buttons[r].push(a)):this.elements.buttons[r]=a,a},createRange:function(e,t){var n=le("input",se(fe(this.config.selectors.inputs[e]),{type:"range",min:0,max:100,step:.01,value:0,autocomplete:"off",role:"slider","aria-label":je(e,this.config),"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":0},t));return this.elements.inputs[e]=n,Ke.updateRangeFill.call(this,n),A.setup(n),n},createProgress:function(e,t){var n=le("progress",se(fe(this.config.selectors.display[e]),{min:0,max:100,value:0,role:"progressbar","aria-hidden":!0},t));if("volume"!==e){n.appendChild(le("span",null,"0"));var i={played:"played",buffer:"buffered"}[e],r=i?je(i,this.config):"";n.innerText="% ".concat(r.toLowerCase())}return this.elements.display[e]=n,n},createTime:function(e,t){var n=fe(this.config.selectors.display[e],t),i=le("div",se(n,{class:"".concat(n.class?n.class:""," ").concat(this.config.classNames.display.time," ").trim(),"aria-label":je(e,this.config)}),"00:00");return this.elements.display[e]=i,i},bindMenuItemShortcuts:function(e,t){var n=this;Pe.call(this,e,"keydown keyup",function(i){if([32,38,39,40].includes(i.which)&&(i.preventDefault(),i.stopPropagation(),"keydown"!==i.type)){var r,s=ve(e,'[role="menuitemradio"]');!s&&[32,39].includes(i.which)?Ke.showMenuPanel.call(n,t,!0):32!==i.which&&(40===i.which||s&&39===i.which?(r=e.nextElementSibling,Y(r)||(r=e.parentNode.firstElementChild)):(r=e.previousElementSibling,Y(r)||(r=e.parentNode.lastElementChild)),_e.call(n,r,!0))}},!1),Pe.call(this,e,"keyup",function(e){13===e.which&&Ke.focusFirstMenuItem.call(n,null,!0)})},createMenuItem:function(e){var t=this,n=e.value,i=e.list,r=e.type,s=e.title,a=e.badge,o=void 0===a?null:a,l=e.checked,u=void 0!==l&&l,c=fe(this.config.selectors.inputs[r]),h=le("button",se(c,{type:"button",role:"menuitemradio",class:"".concat(this.config.classNames.control," ").concat(c.class?c.class:"").trim(),"aria-checked":u,value:n})),d=le("span");d.innerHTML=s,Y(o)&&d.appendChild(o),h.appendChild(d),Object.defineProperty(h,"checked",{enumerable:!0,get:function(){return"true"===h.getAttribute("aria-checked")},set:function(e){e&&Array.from(h.parentNode.children).filter(function(e){return ve(e,'[role="menuitemradio"]')}).forEach(function(e){return e.setAttribute("aria-checked","false")}),h.setAttribute("aria-checked",e?"true":"false")}}),this.listeners.bind(h,"click keyup",function(e){if(!K(e)||32===e.which){switch(e.preventDefault(),e.stopPropagation(),h.checked=!0,r){case"language":t.currentTrack=Number(n);break;case"quality":t.quality=n;break;case"speed":t.speed=parseFloat(n)}Ke.showMenuPanel.call(t,"home",K(e))}},r,!1),Ke.bindMenuItemShortcuts.call(this,h,r),i.appendChild(h)},formatTime:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return j(e)?Ze(e,Xe(this.duration)>0,t):e},updateTimeDisplay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Y(e)&&j(t)&&(e.innerText=Ke.formatTime(t,n))},updateVolume:function(){this.supported.ui&&(Y(this.elements.inputs.volume)&&Ke.setRange.call(this,this.elements.inputs.volume,this.muted?0:this.volume),Y(this.elements.buttons.mute)&&(this.elements.buttons.mute.pressed=this.muted||0===this.volume))},setRange:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Y(e)&&(e.value=t,Ke.updateRangeFill.call(this,e))},updateProgress:function(e){var t=this;if(this.supported.ui&&Z(e)){var n,i,r=0;if(e)switch(e.type){case"timeupdate":case"seeking":case"seeked":n=this.currentTime,i=this.duration,r=0===n||0===i||Number.isNaN(n)||Number.isNaN(i)?0:(n/i*100).toFixed(2),"timeupdate"===e.type&&Ke.setRange.call(this,this.elements.inputs.seek,r);break;case"playing":case"progress":!function(e,n){var i=j(n)?n:0,r=Y(e)?e:t.elements.display.buffer;if(Y(r)){r.value=i;var s=r.getElementsByTagName("span")[0];Y(s)&&(s.childNodes[0].nodeValue=i)}}(this.elements.display.buffer,100*this.buffered)}}},updateRangeFill:function(e){var t=Z(e)?e.target:e;if(Y(t)&&"range"===t.getAttribute("type")){if(ve(t,this.config.selectors.inputs.seek)){t.setAttribute("aria-valuenow",this.currentTime);var n=Ke.formatTime(this.currentTime),i=Ke.formatTime(this.duration),r=je("seekLabel",this.config);t.setAttribute("aria-valuetext",r.replace("{currentTime}",n).replace("{duration}",i))}else if(ve(t,this.config.selectors.inputs.volume)){var s=100*t.value;t.setAttribute("aria-valuenow",s),t.setAttribute("aria-valuetext","".concat(s.toFixed(1),"%"))}else t.setAttribute("aria-valuenow",t.value);ie.isWebkit&&t.style.setProperty("--value","".concat(t.value/t.max*100,"%"))}},updateSeekTooltip:function(e){var t=this;if(this.config.tooltips.seek&&Y(this.elements.inputs.seek)&&Y(this.elements.display.seekTooltip)&&0!==this.duration){var n="".concat(this.config.classNames.tooltip,"--visible"),i=function(e){return me(t.elements.display.seekTooltip,n,e)};if(this.touch)i(!1);else{var r=0,s=this.elements.progress.getBoundingClientRect();if(Z(e))r=100/s.width*(e.pageX-s.left);else{if(!ge(this.elements.display.seekTooltip,n))return;r=parseFloat(this.elements.display.seekTooltip.style.left,10)}r<0?r=0:r>100&&(r=100),Ke.updateTimeDisplay.call(this,this.elements.display.seekTooltip,this.duration/100*r),this.elements.display.seekTooltip.style.left="".concat(r,"%"),Z(e)&&["mouseenter","mouseleave"].includes(e.type)&&i("mouseenter"===e.type)}}},timeUpdate:function(e){var t=!Y(this.elements.display.duration)&&this.config.invertTime;Ke.updateTimeDisplay.call(this,this.elements.display.currentTime,t?this.duration-this.currentTime:this.currentTime,t),e&&"timeupdate"===e.type&&this.media.seeking||Ke.updateProgress.call(this,e)},durationUpdate:function(){if(this.supported.ui&&(this.config.invertTime||!this.currentTime)){if(this.duration>=Math.pow(2,32))return pe(this.elements.display.currentTime,!0),void pe(this.elements.progress,!0);Y(this.elements.inputs.seek)&&this.elements.inputs.seek.setAttribute("aria-valuemax",this.duration);var e=Y(this.elements.display.duration);!e&&this.config.displayDuration&&this.paused&&Ke.updateTimeDisplay.call(this,this.elements.display.currentTime,this.duration),e&&Ke.updateTimeDisplay.call(this,this.elements.display.duration,this.duration),Ke.updateSeekTooltip.call(this)}},toggleMenuButton:function(e,t){pe(this.elements.settings.buttons[e],!t)},updateSetting:function(e,t,n){var i=this.elements.settings.panels[e],r=null,s=t;if("captions"===e)r=this.currentTrack;else{if(r=ee(n)?this[e]:n,ee(r)&&(r=this.config[e].default),!ee(this.options[e])&&!this.options[e].includes(r))return void this.debug.warn("Unsupported value of '".concat(r,"' for ").concat(e));if(!this.config[e].options.includes(r))return void this.debug.warn("Disabled value of '".concat(r,"' for ").concat(e))}if(Y(s)||(s=i&&i.querySelector('[role="menu"]')),Y(s)){this.elements.settings.buttons[e].querySelector(".".concat(this.config.classNames.menu.value)).innerHTML=Ke.getLabel.call(this,e,r);var a=s&&s.querySelector('[value="'.concat(r,'"]'));Y(a)&&(a.checked=!0)}},getLabel:function(e,t){switch(e){case"speed":return 1===t?je("normal",this.config):"".concat(t,"&times;");case"quality":if(j(t)){var n=je("qualityLabel.".concat(t),this.config);return n.length?n:"".concat(t,"p")}return Ue(t);case"captions":return Je.getLabel.call(this);default:return null}},setQualityMenu:function(e){var t=this;if(Y(this.elements.settings.panels.quality)){var n="quality",i=this.elements.settings.panels.quality.querySelector('[role="menu"]');X(e)&&(this.options.quality=Ie(e).filter(function(e){return t.config.quality.options.includes(e)}));var r=!ee(this.options.quality)&&this.options.quality.length>1;if(Ke.toggleMenuButton.call(this,n,r),he(i),Ke.checkMenu.call(this),r){var s=function(e){var n=je("qualityBadge.".concat(e),t.config);return n.length?Ke.createBadge.call(t,n):null};this.options.quality.sort(function(e,n){var i=t.config.quality.options;return i.indexOf(e)>i.indexOf(n)?1:-1}).forEach(function(e){Ke.createMenuItem.call(t,{value:e,list:i,type:n,title:Ke.getLabel.call(t,"quality",e),badge:s(e)})}),Ke.updateSetting.call(this,n,i)}}},setCaptionsMenu:function(){var e=this;if(Y(this.elements.settings.panels.captions)){var t="captions",n=this.elements.settings.panels.captions.querySelector('[role="menu"]'),i=Je.getTracks.call(this),r=Boolean(i.length);if(Ke.toggleMenuButton.call(this,t,r),he(n),Ke.checkMenu.call(this),r){var s=i.map(function(t,i){return{value:i,checked:e.captions.toggled&&e.currentTrack===i,title:Je.getLabel.call(e,t),badge:t.language&&Ke.createBadge.call(e,t.language.toUpperCase()),list:n,type:"language"}});s.unshift({value:-1,checked:!this.captions.toggled,title:je("disabled",this.config),list:n,type:"language"}),s.forEach(Ke.createMenuItem.bind(this)),Ke.updateSetting.call(this,t,n)}}},setSpeedMenu:function(){var e=this;if(Y(this.elements.settings.panels.speed)){var t="speed",n=this.elements.settings.panels.speed.querySelector('[role="menu"]');this.options.speed=this.options.speed.filter(function(t){return t>=e.minimumSpeed&&t<=e.maximumSpeed});var i=!ee(this.options.speed)&&this.options.speed.length>1;Ke.toggleMenuButton.call(this,t,i),he(n),Ke.checkMenu.call(this),i&&(this.options.speed.forEach(function(i){Ke.createMenuItem.call(e,{value:i,list:n,type:t,title:Ke.getLabel.call(e,"speed",i)})}),Ke.updateSetting.call(this,t,n))}},checkMenu:function(){var e=this.elements.settings.buttons,t=!ee(e)&&Object.values(e).some(function(e){return!e.hidden});pe(this.elements.settings.menu,!t)},focusFirstMenuItem:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.elements.settings.popup.hidden){var n=e;Y(n)||(n=Object.values(this.elements.settings.panels).find(function(e){return!e.hidden}));var i=n.querySelector('[role^="menuitem"]');_e.call(this,i,t)}},toggleMenu:function(e){var t=this.elements.settings.popup,n=this.elements.buttons.settings;if(Y(t)&&Y(n)){var i=t.hidden,r=i;if(W(e))r=e;else if(K(e)&&27===e.which)r=!1;else if(Z(e)){var s=q(e.composedPath)?e.composedPath()[0]:e.target,a=t.contains(s);if(a||!a&&e.target!==n&&r)return}n.setAttribute("aria-expanded",r),pe(t,!r),me(this.elements.container,this.config.classNames.menu.open,r),r&&K(e)?Ke.focusFirstMenuItem.call(this,null,!0):r||i||_e.call(this,n,K(e))}},getMenuSize:function(e){var t=e.cloneNode(!0);t.style.position="absolute",t.style.opacity=0,t.removeAttribute("hidden"),e.parentNode.appendChild(t);var n=t.scrollWidth,i=t.scrollHeight;return ce(t),{width:n,height:i}},showMenuPanel:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.elements.container.querySelector("#plyr-settings-".concat(this.id,"-").concat(t));if(Y(i)){var r=i.parentNode,s=Array.from(r.children).find(function(e){return!e.hidden});if(ke.transitions&&!ke.reducedMotion){r.style.width="".concat(s.scrollWidth,"px"),r.style.height="".concat(s.scrollHeight,"px");var a=Ke.getMenuSize.call(this,i);Pe.call(this,r,te,function t(n){n.target===r&&["width","height"].includes(n.propertyName)&&(r.style.width="",r.style.height="",Se.call(e,r,te,t))}),r.style.width="".concat(a.width,"px"),r.style.height="".concat(a.height,"px")}pe(s,!0),pe(i,!1),Ke.focusFirstMenuItem.call(this,i,n)}},setDownloadUrl:function(){var e=this.elements.buttons.download;Y(e)&&e.setAttribute("href",this.download)},create:function(e){var t=this,n=Ke.bindMenuItemShortcuts,i=Ke.createButton,r=Ke.createProgress,s=Ke.createRange,a=Ke.createTime,o=Ke.setQualityMenu,l=Ke.setSpeedMenu,u=Ke.showMenuPanel;this.elements.controls=null,X(this.config.controls)&&this.config.controls.includes("play-large")&&this.elements.container.appendChild(i.call(this,"play-large"));var c=le("div",fe(this.config.selectors.controls.wrapper));this.elements.controls=c;var h={class:"plyr__controls__item"};return Ie(X(this.config.controls)?this.config.controls:[]).forEach(function(o){if("restart"===o&&c.appendChild(i.call(t,"restart",h)),"rewind"===o&&c.appendChild(i.call(t,"rewind",h)),"play"===o&&c.appendChild(i.call(t,"play",h)),"fast-forward"===o&&c.appendChild(i.call(t,"fast-forward",h)),"progress"===o){var l=le("div",{class:"".concat(h.class," plyr__progress__container")}),d=le("div",fe(t.config.selectors.progress));if(d.appendChild(s.call(t,"seek",{id:"plyr-seek-".concat(e.id)})),d.appendChild(r.call(t,"buffer")),t.config.tooltips.seek){var f=le("span",{class:t.config.classNames.tooltip},"00:00");d.appendChild(f),t.elements.display.seekTooltip=f}t.elements.progress=d,l.appendChild(t.elements.progress),c.appendChild(l)}if("current-time"===o&&c.appendChild(a.call(t,"currentTime",h)),"duration"===o&&c.appendChild(a.call(t,"duration",h)),"mute"===o||"volume"===o){var p=t.elements.volume;if(Y(p)&&c.contains(p)||(p=le("div",se({},h,{class:"".concat(h.class," plyr__volume").trim()})),t.elements.volume=p,c.appendChild(p)),"mute"===o&&p.appendChild(i.call(t,"mute")),"volume"===o&&!ie.isIos){var m={max:1,step:.05,value:t.config.volume};p.appendChild(s.call(t,"volume",se(m,{id:"plyr-volume-".concat(e.id)})))}}if("captions"===o&&c.appendChild(i.call(t,"captions",h)),"settings"===o&&!ee(t.config.settings)){var g=le("div",se({},h,{class:"".concat(h.class," plyr__menu").trim(),hidden:""}));g.appendChild(i.call(t,"settings",{"aria-haspopup":!0,"aria-controls":"plyr-settings-".concat(e.id),"aria-expanded":!1}));var v=le("div",{class:"plyr__menu__container",id:"plyr-settings-".concat(e.id),hidden:""}),y=le("div"),b=le("div",{id:"plyr-settings-".concat(e.id,"-home")}),_=le("div",{role:"menu"});b.appendChild(_),y.appendChild(b),t.elements.settings.panels.home=b,t.config.settings.forEach(function(i){var r=le("button",se(fe(t.config.selectors.buttons.settings),{type:"button",class:"".concat(t.config.classNames.control," ").concat(t.config.classNames.control,"--forward"),role:"menuitem","aria-haspopup":!0,hidden:""}));n.call(t,r,i),Pe.call(t,r,"click",function(){u.call(t,i,!1)});var s=le("span",null,je(i,t.config)),a=le("span",{class:t.config.classNames.menu.value});a.innerHTML=e[i],s.appendChild(a),r.appendChild(s),_.appendChild(r);var o=le("div",{id:"plyr-settings-".concat(e.id,"-").concat(i),hidden:""}),l=le("button",{type:"button",class:"".concat(t.config.classNames.control," ").concat(t.config.classNames.control,"--back")});l.appendChild(le("span",{"aria-hidden":!0},je(i,t.config))),l.appendChild(le("span",{class:t.config.classNames.hidden},je("menuBack",t.config))),Pe.call(t,o,"keydown",function(e){37===e.which&&(e.preventDefault(),e.stopPropagation(),u.call(t,"home",!0))},!1),Pe.call(t,l,"click",function(){u.call(t,"home",!1)}),o.appendChild(l),o.appendChild(le("div",{role:"menu"})),y.appendChild(o),t.elements.settings.buttons[i]=r,t.elements.settings.panels[i]=o}),v.appendChild(y),g.appendChild(v),c.appendChild(g),t.elements.settings.popup=v,t.elements.settings.menu=g}if("pip"===o&&ke.pip&&c.appendChild(i.call(t,"pip",h)),"airplay"===o&&ke.airplay&&c.appendChild(i.call(t,"airplay",h)),"download"===o){var x=se({},h,{element:"a",href:t.download,target:"_blank"});t.isHTML5&&(x.download="");var w=t.config.urls.download;!J(w)&&t.isEmbed&&se(x,{icon:"logo-".concat(t.provider),label:t.provider}),c.appendChild(i.call(t,"download",x))}"fullscreen"===o&&c.appendChild(i.call(t,"fullscreen",h))}),this.isHTML5&&o.call(this,De.getQualityOptions.call(this)),l.call(this),c},inject:function(){var e=this;if(this.config.loadSprite){var t=Ke.getIconUrl.call(this);t.cors&&qe(t.url,"sprite-plyr")}this.id=Math.floor(1e4*Math.random());var n=null;this.elements.controls=null;var i,r,s={id:this.id,seektime:this.config.seekTime,title:this.config.title},a=!0;if(q(this.config.controls)&&(this.config.controls=this.config.controls.call(this,s)),this.config.controls||(this.config.controls=[]),Y(this.config.controls)||H(this.config.controls)?n=this.config.controls:(n=Ke.create.call(this,{id:this.id,seektime:this.config.seekTime,speed:this.speed,quality:this.quality,captions:Je.getLabel.call(this)}),a=!1),a&&H(this.config.controls)&&(i=n,Object.entries(s).forEach(function(e){var t=o(e,2),n=t[0],r=t[1];i=ze(i,"{".concat(n,"}"),r)}),n=i),H(this.config.selectors.controls.container)&&(r=document.querySelector(this.config.selectors.controls.container)),Y(r)||(r=this.elements.container),r[Y(n)?"insertAdjacentElement":"insertAdjacentHTML"]("afterbegin",n),Y(this.elements.controls)||Ke.findElements.call(this),!ee(this.elements.buttons)){var l=function(t){var n=e.config.classNames.controlPressed;Object.defineProperty(t,"pressed",{enumerable:!0,get:function(){return ge(t,n)},set:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];me(t,n,e)}})};Object.values(this.elements.buttons).filter(Boolean).forEach(function(e){X(e)||G(e)?Array.from(e).filter(Boolean).forEach(l):l(e)})}if(ie.isEdge&&ne(r),this.config.tooltips.controls){var u=this.config,c=u.classNames,h=u.selectors,d="".concat(h.controls.wrapper," ").concat(h.labels," .").concat(c.hidden),f=ye.call(this,d);Array.from(f).forEach(function(t){me(t,e.config.classNames.hidden,!1),me(t,e.config.classNames.tooltip,!0)})}}};function Qe(e){var t=e;if(!(arguments.length>1&&void 0!==arguments[1])||arguments[1]){var n=document.createElement("a");n.href=t,t=n.href}try{return new URL(t)}catch(e){return null}}function $e(e){var t=new URLSearchParams;return B(e)&&Object.entries(e).forEach(function(e){var n=o(e,2),i=n[0],r=n[1];t.set(i,r)}),t}var Je={setup:function(){if(this.supported.ui)if(!this.isVideo||this.isYouTube||this.isHTML5&&!ke.textTracks)X(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&Ke.setCaptionsMenu.call(this);else{if(Y(this.elements.captions)||(this.elements.captions=le("div",fe(this.config.selectors.captions)),function(e,t){Y(e)&&Y(t)&&t.parentNode.insertBefore(e,t.nextSibling)}(this.elements.captions,this.elements.wrapper)),ie.isIE&&window.URL){var e=this.media.querySelectorAll("track");Array.from(e).forEach(function(e){var t=e.getAttribute("src"),n=Qe(t);null!==n&&n.hostname!==window.location.href.hostname&&["http:","https:"].includes(n.protocol)&&We(t,"blob").then(function(t){e.setAttribute("src",window.URL.createObjectURL(t))}).catch(function(){ce(e)})})}var t=Ie((navigator.languages||[navigator.language||navigator.userLanguage||"en"]).map(function(e){return e.split("-")[0]})),n=(this.storage.get("language")||this.config.captions.language||"auto").toLowerCase();"auto"===n&&(n=o(t,1)[0]);var i=this.storage.get("captions");if(W(i)||(i=this.config.captions.active),Object.assign(this.captions,{toggled:!1,active:i,language:n,languages:t}),this.isHTML5){var r=this.config.captions.update?"addtrack removetrack":"removetrack";Pe.call(this,this.media.textTracks,r,Je.update.bind(this))}setTimeout(Je.update.bind(this),0)}},update:function(){var e=this,t=Je.getTracks.call(this,!0),n=this.captions,i=n.active,r=n.language,s=n.meta,a=n.currentTrackNode,o=Boolean(t.find(function(e){return e.language===r}));this.isHTML5&&this.isVideo&&t.filter(function(e){return!s.get(e)}).forEach(function(t){e.debug.log("Track added",t),s.set(t,{default:"showing"===t.mode}),"showing"===t.mode&&(t.mode="hidden"),Pe.call(e,t,"cuechange",function(){return Je.updateCues.call(e)})}),(o&&this.language!==r||!t.includes(a))&&(Je.setLanguage.call(this,r),Je.toggle.call(this,i&&o)),me(this.elements.container,this.config.classNames.captions.enabled,!ee(t)),X(this.config.controls)&&this.config.controls.includes("settings")&&this.config.settings.includes("captions")&&Ke.setCaptionsMenu.call(this)},toggle:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.supported.ui){var i=this.captions.toggled,r=this.config.classNames.captions.active,s=V(e)?!i:e;if(s!==i){if(n||(this.captions.active=s,this.storage.set({captions:s})),!this.language&&s&&!n){var a=Je.getTracks.call(this),o=Je.findTrack.call(this,[this.captions.language].concat(l(this.captions.languages)),!0);return this.captions.language=o.language,void Je.set.call(this,a.indexOf(o))}this.elements.buttons.captions&&(this.elements.buttons.captions.pressed=s),me(this.elements.container,r,s),this.captions.toggled=s,Ke.updateSetting.call(this,"captions"),Re.call(this,this.media,s?"captionsenabled":"captionsdisabled")}setTimeout(function(){s&&t.captions.toggled&&(t.captions.currentTrackNode.mode="hidden")})}},set:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Je.getTracks.call(this);if(-1!==e)if(j(e))if(e in n){if(this.captions.currentTrack!==e){this.captions.currentTrack=e;var i=n[e],r=(i||{}).language;this.captions.currentTrackNode=i,Ke.updateSetting.call(this,"captions"),t||(this.captions.language=r,this.storage.set({language:r})),this.isVimeo&&this.embed.enableTextTrack(r),Re.call(this,this.media,"languagechange")}Je.toggle.call(this,!0,t),this.isHTML5&&this.isVideo&&Je.updateCues.call(this)}else this.debug.warn("Track not found",e);else this.debug.warn("Invalid caption argument",e);else Je.toggle.call(this,!1,t)},setLanguage:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(H(e)){var n=e.toLowerCase();this.captions.language=n;var i=Je.getTracks.call(this),r=Je.findTrack.call(this,[n]);Je.set.call(this,i.indexOf(r),t)}else this.debug.warn("Invalid language argument",e)},getTracks:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Array.from((this.media||{}).textTracks||[]).filter(function(n){return!e.isHTML5||t||e.captions.meta.has(n)}).filter(function(e){return["captions","subtitles"].includes(e.kind)})},findTrack:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Je.getTracks.call(this),s=function(e){return Number((n.captions.meta.get(e)||{}).default)},a=Array.from(r).sort(function(e,t){return s(t)-s(e)});return e.every(function(e){return!(t=a.find(function(t){return t.language===e}))}),t||(i?a[0]:void 0)},getCurrentTrack:function(){return Je.getTracks.call(this)[this.currentTrack]},getLabel:function(e){var t=e;return!Q(t)&&ke.textTracks&&this.captions.toggled&&(t=Je.getCurrentTrack.call(this)),Q(t)?ee(t.label)?ee(t.language)?je("enabled",this.config):e.language.toUpperCase():t.label:je("disabled",this.config)},updateCues:function(e){if(this.supported.ui)if(Y(this.elements.captions))if(V(e)||Array.isArray(e)){var t=e;if(!t){var n=Je.getCurrentTrack.call(this);t=Array.from((n||{}).activeCues||[]).map(function(e){return e.getCueAsHTML()}).map(Ve)}var i=t.map(function(e){return e.trim()}).join("\n");if(i!==this.elements.captions.innerHTML){he(this.elements.captions);var r=le("span",fe(this.config.selectors.caption));r.innerHTML=i,this.elements.captions.appendChild(r),Re.call(this,this.media,"cuechange")}}else this.debug.warn("updateCues: Invalid input",e);else this.debug.warn("No captions element to render to")}},et={enabled:!0,title:"",debug:!1,autoplay:!1,autopause:!0,playsinline:!0,seekTime:10,volume:1,muted:!1,duration:null,displayDuration:!0,invertTime:!0,toggleInvert:!0,ratio:null,clickToPlay:!0,hideControls:!0,resetOnEnd:!1,disableContextMenu:!0,loadSprite:!0,iconPrefix:"plyr",iconUrl:"https://cdn.plyr.io/3.6.4/plyr.svg",blankVideo:"https://cdn.plyr.io/static/blank.mp4",quality:{default:576,options:[4320,2880,2160,1440,1080,720,576,480,360,240],forced:!1,onChange:null},loop:{active:!1},speed:{selected:1,options:[.5,.75,1,1.25,1.5,1.75,2,4]},keyboard:{focused:!0,global:!1},tooltips:{controls:!1,seek:!0},captions:{active:!1,language:"auto",update:!1},fullscreen:{enabled:!0,fallback:!0,iosNative:!1},storage:{enabled:!0,key:"plyr"},controls:["play-large","play","progress","current-time","mute","volume","captions","settings","pip","airplay","fullscreen"],settings:["captions","quality","speed"],i18n:{restart:"Restart",rewind:"Rewind {seektime}s",play:"Play",pause:"Pause",fastForward:"Forward {seektime}s",seek:"Seek",seekLabel:"{currentTime} of {duration}",played:"Played",buffered:"Buffered",currentTime:"Current time",duration:"Duration",volume:"Volume",mute:"Mute",unmute:"Unmute",enableCaptions:"Enable captions",disableCaptions:"Disable captions",download:"Download",enterFullscreen:"Enter fullscreen",exitFullscreen:"Exit fullscreen",frameTitle:"Player for {title}",captions:"Captions",settings:"Settings",pip:"PIP",menuBack:"Go back to previous menu",speed:"Speed",normal:"Normal",quality:"Quality",loop:"Loop",start:"Start",end:"End",all:"All",reset:"Reset",disabled:"Disabled",enabled:"Enabled",advertisement:"Ad",qualityBadge:{2160:"4K",1440:"HD",1080:"HD",720:"HD",576:"SD",480:"SD"}},urls:{download:null,vimeo:{sdk:"https://player.vimeo.com/api/player.js",iframe:"https://player.vimeo.com/video/{0}?{1}",api:"https://vimeo.com/api/oembed.json?url={0}"},youtube:{sdk:"https://www.youtube.com/iframe_api",api:"https://noembed.com/embed?url=https://www.youtube.com/watch?v={0}"},googleIMA:{sdk:"https://imasdk.googleapis.com/js/sdkloader/ima3.js"}},listeners:{seek:null,play:null,pause:null,restart:null,rewind:null,fastForward:null,mute:null,volume:null,captions:null,download:null,fullscreen:null,pip:null,airplay:null,speed:null,quality:null,loop:null,language:null},events:["ended","progress","stalled","playing","waiting","canplay","canplaythrough","loadstart","loadeddata","loadedmetadata","timeupdate","volumechange","play","pause","error","seeking","seeked","emptied","ratechange","cuechange","download","enterfullscreen","exitfullscreen","captionsenabled","captionsdisabled","languagechange","controlshidden","controlsshown","ready","statechange","qualitychange","adsloaded","adscontentpause","adscontentresume","adstarted","adsmidpoint","adscomplete","adsallcomplete","adsimpression","adsclick"],selectors:{editable:"input, textarea, select, [contenteditable]",container:".plyr",controls:{container:null,wrapper:".plyr__controls"},labels:"[data-plyr]",buttons:{play:'[data-plyr="play"]',pause:'[data-plyr="pause"]',restart:'[data-plyr="restart"]',rewind:'[data-plyr="rewind"]',fastForward:'[data-plyr="fast-forward"]',mute:'[data-plyr="mute"]',captions:'[data-plyr="captions"]',download:'[data-plyr="download"]',fullscreen:'[data-plyr="fullscreen"]',pip:'[data-plyr="pip"]',airplay:'[data-plyr="airplay"]',settings:'[data-plyr="settings"]',loop:'[data-plyr="loop"]'},inputs:{seek:'[data-plyr="seek"]',volume:'[data-plyr="volume"]',speed:'[data-plyr="speed"]',language:'[data-plyr="language"]',quality:'[data-plyr="quality"]'},display:{currentTime:".plyr__time--current",duration:".plyr__time--duration",buffer:".plyr__progress__buffer",loop:".plyr__progress__loop",volume:".plyr__volume--display"},progress:".plyr__progress",captions:".plyr__captions",caption:".plyr__caption"},classNames:{type:"plyr--{0}",provider:"plyr--{0}",video:"plyr__video-wrapper",embed:"plyr__video-embed",videoFixedRatio:"plyr__video-wrapper--fixed-ratio",embedContainer:"plyr__video-embed__container",poster:"plyr__poster",posterEnabled:"plyr__poster-enabled",ads:"plyr__ads",control:"plyr__control",controlPressed:"plyr__control--pressed",playing:"plyr--playing",paused:"plyr--paused",stopped:"plyr--stopped",loading:"plyr--loading",hover:"plyr--hover",tooltip:"plyr__tooltip",cues:"plyr__cues",hidden:"plyr__sr-only",hideControls:"plyr--hide-controls",isIos:"plyr--is-ios",isTouch:"plyr--is-touch",uiSupported:"plyr--full-ui",noTransition:"plyr--no-transition",display:{time:"plyr__time"},menu:{value:"plyr__menu__value",badge:"plyr__badge",open:"plyr--menu-open"},captions:{enabled:"plyr--captions-enabled",active:"plyr--captions-active"},fullscreen:{enabled:"plyr--fullscreen-enabled",fallback:"plyr--fullscreen-fallback"},pip:{supported:"plyr--pip-supported",active:"plyr--pip-active"},airplay:{supported:"plyr--airplay-supported",active:"plyr--airplay-active"},tabFocus:"plyr__tab-focus",previewThumbnails:{thumbContainer:"plyr__preview-thumb",thumbContainerShown:"plyr__preview-thumb--is-shown",imageContainer:"plyr__preview-thumb__image-container",timeContainer:"plyr__preview-thumb__time-container",scrubbingContainer:"plyr__preview-scrubbing",scrubbingContainerShown:"plyr__preview-scrubbing--is-shown"}},attributes:{embed:{provider:"data-plyr-provider",id:"data-plyr-embed-id"}},ads:{enabled:!1,publisherId:"",tagUrl:""},previewThumbnails:{enabled:!1,src:""},vimeo:{byline:!1,portrait:!1,title:!1,speed:!0,transparent:!1,customControls:!0,referrerPolicy:null,premium:!1},youtube:{rel:0,showinfo:0,iv_load_policy:3,modestbranding:1,customControls:!0,noCookie:!1}},tt="picture-in-picture",nt={html5:"html5",youtube:"youtube",vimeo:"vimeo"},it="video",rt=function(){},st=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t(this,e),this.enabled=window.console&&n,this.enabled&&this.log("Debugging enabled")}return i(e,[{key:"log",get:function(){return this.enabled?Function.prototype.bind.call(console.log,console):rt}},{key:"warn",get:function(){return this.enabled?Function.prototype.bind.call(console.warn,console):rt}},{key:"error",get:function(){return this.enabled?Function.prototype.bind.call(console.error,console):rt}}]),e}(),at=function(){function e(n){var i=this;t(this,e),r(this,"onChange",function(){if(i.enabled){var e=i.player.elements.buttons.fullscreen;Y(e)&&(e.pressed=i.active);var t=i.target===i.player.media?i.target:i.player.elements.container;Re.call(i.player,t,i.active?"enterfullscreen":"exitfullscreen",!0)}}),r(this,"toggleFallback",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e?i.scrollPosition={x:window.scrollX||0,y:window.scrollY||0}:window.scrollTo(i.scrollPosition.x,i.scrollPosition.y),document.body.style.overflow=e?"hidden":"",me(i.target,i.player.config.classNames.fullscreen.fallback,e),ie.isIos){var t=document.head.querySelector('meta[name="viewport"]'),n="viewport-fit=cover";t||(t=document.createElement("meta")).setAttribute("name","viewport");var r=H(t.content)&&t.content.includes(n);e?(i.cleanupViewport=!r,r||(t.content+=",".concat(n))):i.cleanupViewport&&(t.content=t.content.split(",").filter(function(e){return e.trim()!==n}).join(","))}i.onChange()}),r(this,"trapFocus",function(e){if(!ie.isIos&&i.active&&"Tab"===e.key&&9===e.keyCode){var t=document.activeElement,n=ye.call(i.player,"a[href], button:not(:disabled), input:not(:disabled), [tabindex]"),r=o(n,1)[0],s=n[n.length-1];t!==s||e.shiftKey?t===r&&e.shiftKey&&(s.focus(),e.preventDefault()):(r.focus(),e.preventDefault())}}),r(this,"update",function(){var t;i.enabled?(t=i.forceFallback?"Fallback (forced)":e.native?"Native":"Fallback",i.player.debug.log("".concat(t," fullscreen enabled"))):i.player.debug.log("Fullscreen not supported and fallback disabled"),me(i.player.elements.container,i.player.config.classNames.fullscreen.enabled,i.enabled)}),r(this,"enter",function(){i.enabled&&(ie.isIos&&i.player.config.fullscreen.iosNative?i.player.isVimeo?i.player.embed.requestFullscreen():i.target.webkitEnterFullscreen():!e.native||i.forceFallback?i.toggleFallback(!0):i.prefix?ee(i.prefix)||i.target["".concat(i.prefix,"Request").concat(i.property)]():i.target.requestFullscreen({navigationUI:"hide"}))}),r(this,"exit",function(){if(i.enabled)if(ie.isIos&&i.player.config.fullscreen.iosNative)i.target.webkitExitFullscreen(),Ae(i.player.play());else if(!e.native||i.forceFallback)i.toggleFallback(!1);else if(i.prefix){if(!ee(i.prefix)){var t="moz"===i.prefix?"Cancel":"Exit";document["".concat(i.prefix).concat(t).concat(i.property)]()}}else(document.cancelFullScreen||document.exitFullscreen).call(document)}),r(this,"toggle",function(){i.active?i.exit():i.enter()}),this.player=n,this.prefix=e.prefix,this.property=e.property,this.scrollPosition={x:0,y:0},this.forceFallback="force"===n.config.fullscreen.fallback,this.player.elements.fullscreen=n.config.fullscreen.container&&function(e,t){return(Element.prototype.closest||function(){var e=this;do{if(ve.matches(e,t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null}).call(e,t)}(this.player.elements.container,n.config.fullscreen.container),Pe.call(this.player,document,"ms"===this.prefix?"MSFullscreenChange":"".concat(this.prefix,"fullscreenchange"),function(){i.onChange()}),Pe.call(this.player,this.player.elements.container,"dblclick",function(e){Y(i.player.elements.controls)&&i.player.elements.controls.contains(e.target)||i.player.listeners.proxy(e,i.toggle,"fullscreen")}),Pe.call(this,this.player.elements.container,"keydown",function(e){return i.trapFocus(e)}),this.update()}return i(e,[{key:"usingNative",get:function(){return e.native&&!this.forceFallback}},{key:"enabled",get:function(){return(e.native||this.player.config.fullscreen.fallback)&&this.player.config.fullscreen.enabled&&this.player.supported.ui&&this.player.isVideo}},{key:"active",get:function(){if(!this.enabled)return!1;if(!e.native||this.forceFallback)return ge(this.target,this.player.config.classNames.fullscreen.fallback);var t=this.prefix?document["".concat(this.prefix).concat(this.property,"Element")]:document.fullscreenElement;return t&&t.shadowRoot?t===this.target.getRootNode().host:t===this.target}},{key:"target",get:function(){return ie.isIos&&this.player.config.fullscreen.iosNative?this.player.media:this.player.elements.fullscreen||this.player.elements.container}}],[{key:"native",get:function(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)}},{key:"prefix",get:function(){if(q(document.exitFullscreen))return"";var e="";return["webkit","moz","ms"].some(function(t){return!(!q(document["".concat(t,"ExitFullscreen")])&&!q(document["".concat(t,"CancelFullScreen")])||(e=t,0))}),e}},{key:"property",get:function(){return"moz"===this.prefix?"FullScreen":"Fullscreen"}}]),e}();function ot(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Promise(function(n,i){var r=new Image,s=function(){delete r.onload,delete r.onerror,(r.naturalWidth>=t?n:i)(r)};Object.assign(r,{onload:s,onerror:s,src:e})})}var lt={addStyleHook:function(){me(this.elements.container,this.config.selectors.container.replace(".",""),!0),me(this.elements.container,this.config.classNames.uiSupported,this.supported.ui)},toggleNativeControls:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.isHTML5?this.media.setAttribute("controls",""):this.media.removeAttribute("controls")},build:function(){var e=this;if(this.listeners.media(),!this.supported.ui)return this.debug.warn("Basic support only for ".concat(this.provider," ").concat(this.type)),void lt.toggleNativeControls.call(this,!0);Y(this.elements.controls)||(Ke.inject.call(this),this.listeners.controls()),lt.toggleNativeControls.call(this),this.isHTML5&&Je.setup.call(this),this.volume=null,this.muted=null,this.loop=null,this.quality=null,this.speed=null,Ke.updateVolume.call(this),Ke.timeUpdate.call(this),lt.checkPlaying.call(this),me(this.elements.container,this.config.classNames.pip.supported,ke.pip&&this.isHTML5&&this.isVideo),me(this.elements.container,this.config.classNames.airplay.supported,ke.airplay&&this.isHTML5),me(this.elements.container,this.config.classNames.isIos,ie.isIos),me(this.elements.container,this.config.classNames.isTouch,this.touch),this.ready=!0,setTimeout(function(){Re.call(e,e.media,"ready")},0),lt.setTitle.call(this),this.poster&&lt.setPoster.call(this,this.poster,!1).catch(function(){}),this.config.duration&&Ke.durationUpdate.call(this)},setTitle:function(){var e=je("play",this.config);if(H(this.config.title)&&!ee(this.config.title)&&(e+=", ".concat(this.config.title)),Array.from(this.elements.buttons.play||[]).forEach(function(t){t.setAttribute("aria-label",e)}),this.isEmbed){var t=be.call(this,"iframe");if(!Y(t))return;var n=ee(this.config.title)?"video":this.config.title,i=je("frameTitle",this.config);t.setAttribute("title",i.replace("{title}",n))}},togglePoster:function(e){me(this.elements.container,this.config.classNames.posterEnabled,e)},setPoster:function(e){var t=this;return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.poster?Promise.reject(new Error("Poster already set")):(this.media.setAttribute("data-poster",e),this.elements.poster.removeAttribute("hidden"),function(){var e=this;return new Promise(function(t){return e.ready?setTimeout(t,0):Pe.call(e,e.elements.container,"ready",t)}).then(function(){})}.call(this).then(function(){return ot(e)}).catch(function(n){throw e===t.poster&&lt.togglePoster.call(t,!1),n}).then(function(){if(e!==t.poster)throw new Error("setPoster cancelled by later call to setPoster")}).then(function(){return Object.assign(t.elements.poster.style,{backgroundImage:"url('".concat(e,"')"),backgroundSize:""}),lt.togglePoster.call(t,!0),e}))},checkPlaying:function(e){var t=this;me(this.elements.container,this.config.classNames.playing,this.playing),me(this.elements.container,this.config.classNames.paused,this.paused),me(this.elements.container,this.config.classNames.stopped,this.stopped),Array.from(this.elements.buttons.play||[]).forEach(function(e){Object.assign(e,{pressed:t.playing}),e.setAttribute("aria-label",je(t.playing?"pause":"play",t.config))}),Z(e)&&"timeupdate"===e.type||lt.toggleControls.call(this)},checkLoading:function(e){var t=this;this.loading=["stalled","waiting"].includes(e.type),clearTimeout(this.timers.loading),this.timers.loading=setTimeout(function(){me(t.elements.container,t.config.classNames.loading,t.loading),lt.toggleControls.call(t)},this.loading?250:0)},toggleControls:function(e){var t=this.elements.controls;if(t&&this.config.hideControls){var n=this.touch&&this.lastSeekTime+2e3>Date.now();this.toggleControls(Boolean(e||this.loading||this.paused||t.pressed||t.hover||n))}},migrateStyles:function(){var e=this;Object.values(a({},this.media.style)).filter(function(e){return!ee(e)&&H(e)&&e.startsWith("--plyr")}).forEach(function(t){e.elements.container.style.setProperty(t,e.media.style.getPropertyValue(t)),e.media.style.removeProperty(t)}),ee(this.media.style)&&this.media.removeAttribute("style")}},ut=function(){function e(n){var i=this;t(this,e),r(this,"firstTouch",function(){var e=i.player,t=e.elements;e.touch=!0,me(t.container,e.config.classNames.isTouch,!0)}),r(this,"setTabFocus",function(e){var t=i.player,n=t.elements;if(clearTimeout(i.focusTimer),"keydown"!==e.type||9===e.which){"keydown"===e.type&&(i.lastKeyDown=e.timeStamp);var r,s=e.timeStamp-i.lastKeyDown<=20;("focus"!==e.type||s)&&(r=t.config.classNames.tabFocus,me(ye.call(t,".".concat(r)),r,!1),"focusout"!==e.type&&(i.focusTimer=setTimeout(function(){var e=document.activeElement;n.container.contains(e)&&me(document.activeElement,t.config.classNames.tabFocus,!0)},10)))}}),r(this,"global",function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=i.player;t.config.keyboard.global&&Ee.call(t,window,"keydown keyup",i.handleKey,e,!1),Ee.call(t,document.body,"click",i.toggleMenu,e),Ce.call(t,document.body,"touchstart",i.firstTouch),Ee.call(t,document.body,"keydown focus blur focusout",i.setTabFocus,e,!1,!0)}),r(this,"container",function(){var e=i.player,t=e.config,n=e.elements,r=e.timers;!t.keyboard.global&&t.keyboard.focused&&Pe.call(e,n.container,"keydown keyup",i.handleKey,!1),Pe.call(e,n.container,"mousemove mouseleave touchstart touchmove enterfullscreen exitfullscreen",function(t){var i=n.controls;i&&"enterfullscreen"===t.type&&(i.pressed=!1,i.hover=!1);var s=0;["touchstart","touchmove","mousemove"].includes(t.type)&&(lt.toggleControls.call(e,!0),s=e.touch?3e3:2e3),clearTimeout(r.controls),r.controls=setTimeout(function(){return lt.toggleControls.call(e,!1)},s)});var s=function(t){if(!t)return Fe.call(e);var i=n.container.getBoundingClientRect(),r=i.width,s=i.height;return Fe.call(e,"".concat(r,":").concat(s))},a=function(){clearTimeout(r.resized),r.resized=setTimeout(s,50)};Pe.call(e,n.container,"enterfullscreen exitfullscreen",function(t){var i=e.fullscreen,r=i.target,l=i.usingNative;if(r===n.container&&(e.isEmbed||!ee(e.config.ratio))){var u="enterfullscreen"===t.type,c=s(u);c.padding,!function(t,n,i){if(e.isVimeo&&!e.config.vimeo.premium){var r=e.elements.wrapper.firstChild,s=o(t,2)[1],a=o(Le.call(e),2),l=a[0],u=a[1];r.style.maxWidth=i?"".concat(s/u*l,"px"):null,r.style.margin=i?"0 auto":null}}(c.ratio,0,u),u&&setTimeout(function(){return ne(n.container)},100),l||(u?Pe.call(e,window,"resize",a):Se.call(e,window,"resize",a))}})}),r(this,"media",function(){var e=i.player,t=e.elements;if(Pe.call(e,e.media,"timeupdate seeking seeked",function(t){return Ke.timeUpdate.call(e,t)}),Pe.call(e,e.media,"durationchange loadeddata loadedmetadata",function(t){return Ke.durationUpdate.call(e,t)}),Pe.call(e,e.media,"ended",function(){e.isHTML5&&e.isVideo&&e.config.resetOnEnd&&(e.restart(),e.pause())}),Pe.call(e,e.media,"progress playing seeking seeked",function(t){return Ke.updateProgress.call(e,t)}),Pe.call(e,e.media,"volumechange",function(t){return Ke.updateVolume.call(e,t)}),Pe.call(e,e.media,"playing play pause ended emptied timeupdate",function(t){return lt.checkPlaying.call(e,t)}),Pe.call(e,e.media,"waiting canplay seeked playing",function(t){return lt.checkLoading.call(e,t)}),e.supported.ui&&e.config.clickToPlay&&!e.isAudio){var n=be.call(e,".".concat(e.config.classNames.video));if(!Y(n))return;Pe.call(e,t.container,"click",function(r){([t.container,n].includes(r.target)||n.contains(r.target))&&(e.touch&&e.config.hideControls||(e.ended?(i.proxy(r,e.restart,"restart"),i.proxy(r,function(){Ae(e.play())},"play")):i.proxy(r,function(){Ae(e.togglePlay())},"play")))})}e.supported.ui&&e.config.disableContextMenu&&Pe.call(e,t.wrapper,"contextmenu",function(e){e.preventDefault()},!1),Pe.call(e,e.media,"volumechange",function(){e.storage.set({volume:e.volume,muted:e.muted})}),Pe.call(e,e.media,"ratechange",function(){Ke.updateSetting.call(e,"speed"),e.storage.set({speed:e.speed})}),Pe.call(e,e.media,"qualitychange",function(t){Ke.updateSetting.call(e,"quality",null,t.detail.quality)}),Pe.call(e,e.media,"ready qualitychange",function(){Ke.setDownloadUrl.call(e)});var r=e.config.events.concat(["keyup","keydown"]).join(" ");Pe.call(e,e.media,r,function(n){var i=n.detail,r=void 0===i?{}:i;"error"===n.type&&(r=e.media.error),Re.call(e,t.container,n.type,!0,r)})}),r(this,"proxy",function(e,t,n){var r=i.player,s=r.config.listeners[n],a=!0;q(s)&&(a=s.call(r,e)),!1!==a&&q(t)&&t.call(r,e)}),r(this,"bind",function(e,t,n,r){var s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=i.player,o=a.config.listeners[r],l=q(o);Pe.call(a,e,t,function(e){return i.proxy(e,n,r)},s&&!l)}),r(this,"controls",function(){var e=i.player,t=e.elements,n=ie.isIE?"change":"input";if(t.buttons.play&&Array.from(t.buttons.play).forEach(function(t){i.bind(t,"click",function(){Ae(e.togglePlay())},"play")}),i.bind(t.buttons.restart,"click",e.restart,"restart"),i.bind(t.buttons.rewind,"click",function(){e.lastSeekTime=Date.now(),e.rewind()},"rewind"),i.bind(t.buttons.fastForward,"click",function(){e.lastSeekTime=Date.now(),e.forward()},"fastForward"),i.bind(t.buttons.mute,"click",function(){e.muted=!e.muted},"mute"),i.bind(t.buttons.captions,"click",function(){return e.toggleCaptions()}),i.bind(t.buttons.download,"click",function(){Re.call(e,e.media,"download")},"download"),i.bind(t.buttons.fullscreen,"click",function(){e.fullscreen.toggle()},"fullscreen"),i.bind(t.buttons.pip,"click",function(){e.pip="toggle"},"pip"),i.bind(t.buttons.airplay,"click",e.airplay,"airplay"),i.bind(t.buttons.settings,"click",function(t){t.stopPropagation(),t.preventDefault(),Ke.toggleMenu.call(e,t)},null,!1),i.bind(t.buttons.settings,"keyup",function(t){var n=t.which;[13,32].includes(n)&&(13!==n?(t.preventDefault(),t.stopPropagation(),Ke.toggleMenu.call(e,t)):Ke.focusFirstMenuItem.call(e,null,!0))},null,!1),i.bind(t.settings.menu,"keydown",function(t){27===t.which&&Ke.toggleMenu.call(e,t)}),i.bind(t.inputs.seek,"mousedown mousemove",function(e){var n=t.progress.getBoundingClientRect(),i=100/n.width*(e.pageX-n.left);e.currentTarget.setAttribute("seek-value",i)}),i.bind(t.inputs.seek,"mousedown mouseup keydown keyup touchstart touchend",function(t){var n=t.currentTarget,i=t.keyCode?t.keyCode:t.which,r="play-on-seeked";if(!K(t)||39===i||37===i){e.lastSeekTime=Date.now();var s=n.hasAttribute(r),a=["mouseup","touchend","keyup"].includes(t.type);s&&a?(n.removeAttribute(r),Ae(e.play())):!a&&e.playing&&(n.setAttribute(r,""),e.pause())}}),ie.isIos){var r=ye.call(e,'input[type="range"]');Array.from(r).forEach(function(e){return i.bind(e,n,function(e){return ne(e.target)})})}i.bind(t.inputs.seek,n,function(t){var n=t.currentTarget,i=n.getAttribute("seek-value");ee(i)&&(i=n.value),n.removeAttribute("seek-value"),e.currentTime=i/n.max*e.duration},"seek"),i.bind(t.progress,"mouseenter mouseleave mousemove",function(t){return Ke.updateSeekTooltip.call(e,t)}),i.bind(t.progress,"mousemove touchmove",function(t){var n=e.previewThumbnails;n&&n.loaded&&n.startMove(t)}),i.bind(t.progress,"mouseleave touchend click",function(){var t=e.previewThumbnails;t&&t.loaded&&t.endMove(!1,!0)}),i.bind(t.progress,"mousedown touchstart",function(t){var n=e.previewThumbnails;n&&n.loaded&&n.startScrubbing(t)}),i.bind(t.progress,"mouseup touchend",function(t){var n=e.previewThumbnails;n&&n.loaded&&n.endScrubbing(t)}),ie.isWebkit&&Array.from(ye.call(e,'input[type="range"]')).forEach(function(t){i.bind(t,"input",function(t){return Ke.updateRangeFill.call(e,t.target)})}),e.config.toggleInvert&&!Y(t.display.duration)&&i.bind(t.display.currentTime,"click",function(){0!==e.currentTime&&(e.config.invertTime=!e.config.invertTime,Ke.timeUpdate.call(e))}),i.bind(t.inputs.volume,n,function(t){e.volume=t.target.value},"volume"),i.bind(t.controls,"mouseenter mouseleave",function(n){t.controls.hover=!e.touch&&"mouseenter"===n.type}),t.fullscreen&&Array.from(t.fullscreen.children).filter(function(e){return!e.contains(t.container)}).forEach(function(n){i.bind(n,"mouseenter mouseleave",function(n){t.controls.hover=!e.touch&&"mouseenter"===n.type})}),i.bind(t.controls,"mousedown mouseup touchstart touchend touchcancel",function(e){t.controls.pressed=["mousedown","touchstart"].includes(e.type)}),i.bind(t.controls,"focusin",function(){var n=e.config,r=e.timers;me(t.controls,n.classNames.noTransition,!0),lt.toggleControls.call(e,!0),setTimeout(function(){me(t.controls,n.classNames.noTransition,!1)},0);var s=i.touch?3e3:4e3;clearTimeout(r.controls),r.controls=setTimeout(function(){return lt.toggleControls.call(e,!1)},s)}),i.bind(t.inputs.volume,"wheel",function(t){var n=t.webkitDirectionInvertedFromDevice,i=o([t.deltaX,-t.deltaY].map(function(e){return n?-e:e}),2),r=i[0],s=i[1],a=Math.sign(Math.abs(r)>Math.abs(s)?r:s);e.increaseVolume(a/50);var l=e.media.volume;(1===a&&l<1||-1===a&&l>0)&&t.preventDefault()},"volume",!1)}),this.player=n,this.lastKey=null,this.focusTimer=null,this.lastKeyDown=null,this.handleKey=this.handleKey.bind(this),this.toggleMenu=this.toggleMenu.bind(this),this.setTabFocus=this.setTabFocus.bind(this),this.firstTouch=this.firstTouch.bind(this)}return i(e,[{key:"handleKey",value:function(e){var t=this.player,n=t.elements,i=e.keyCode?e.keyCode:e.which,r="keydown"===e.type,s=r&&i===this.lastKey;if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)&&j(i))if(r){var a=document.activeElement;if(Y(a)){var o=t.config.selectors.editable;if(a!==n.inputs.seek&&ve(a,o))return;if(32===e.which&&ve(a,'button, [role^="menuitem"]'))return}switch([32,37,38,39,40,48,49,50,51,52,53,54,56,57,67,70,73,75,76,77,79].includes(i)&&(e.preventDefault(),e.stopPropagation()),i){case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:s||(t.currentTime=t.duration/10*(i-48));break;case 32:case 75:s||Ae(t.togglePlay());break;case 38:t.increaseVolume(.1);break;case 40:t.decreaseVolume(.1);break;case 77:s||(t.muted=!t.muted);break;case 39:t.forward();break;case 37:t.rewind();break;case 70:t.fullscreen.toggle();break;case 67:s||t.toggleCaptions();break;case 76:t.loop=!t.loop}27===i&&!t.fullscreen.usingNative&&t.fullscreen.active&&t.fullscreen.toggle(),this.lastKey=i}else this.lastKey=null}},{key:"toggleMenu",value:function(e){Ke.toggleMenu.call(this.player,e)}}]),e}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var ct=function(e,t){return function(e,t){e.exports=function(){var e=function(){},t={},n={},i={};function r(e,t){if(e){var r=i[e];if(n[e]=t,r)for(;r.length;)r[0](e,t),r.splice(0,1)}}function s(t,n){t.call&&(t={success:t}),n.length?(t.error||e)(n):(t.success||e)(t)}function a(t,n,i,r){var s,o,l=document,u=i.async,c=(i.numRetries||0)+1,h=i.before||e,d=t.replace(/[\?|#].*$/,""),f=t.replace(/^(css|img)!/,"");r=r||0,/(^css!|\.css$)/.test(d)?((o=l.createElement("link")).rel="stylesheet",o.href=f,(s="hideFocus"in o)&&o.relList&&(s=0,o.rel="preload",o.as="style")):/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(d)?(o=l.createElement("img")).src=f:((o=l.createElement("script")).src=t,o.async=void 0===u||u),o.onload=o.onerror=o.onbeforeload=function(e){var l=e.type[0];if(s)try{o.sheet.cssText.length||(l="e")}catch(e){18!=e.code&&(l="e")}if("e"==l){if((r+=1)<c)return a(t,n,i,r)}else if("preload"==o.rel&&"style"==o.as)return o.rel="stylesheet";n(t,l,e.defaultPrevented)},!1!==h(t,o)&&l.head.appendChild(o)}function o(e,t,n){var i,r,s=(e=e.push?e:[e]).length,o=s,l=[];for(i=function(e,n,i){if("e"==n&&l.push(e),"b"==n){if(!i)return;l.push(e)}--s||t(l)},r=0;r<o;r++)a(e[r],i,n)}function l(e,n,i){var a,l;if(n&&n.trim&&(a=n),l=(a?i:n)||{},a){if(a in t)throw"LoadJS";t[a]=!0}function u(t,n){o(e,function(e){s(l,e),t&&s({success:t,error:n},e),r(a,e)},l)}if(l.returnPromise)return new Promise(u);u()}return l.ready=function(e,t){return function(e,t){e=e.push?e:[e];var r,s,a,o=[],l=e.length,u=l;for(r=function(e,n){n.length&&o.push(e),--u||t(o)};l--;)s=e[l],(a=n[s])?r(s,a):(i[s]=i[s]||[]).push(r)}(e,function(e){s(t,e)}),l},l.done=function(e){r(e,[])},l.reset=function(){t={},n={},i={}},l.isDefined=function(e){return e in t},l}()}(t={exports:{}}),t.exports}();function ht(e){return new Promise(function(t,n){ct(e,{success:t,error:n})})}function dt(e){e&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===e&&(this.media.paused=!e,Re.call(this,this.media,e?"play":"pause"))}var ft={setup:function(){var e=this;me(e.elements.wrapper,e.config.classNames.embed,!0),e.options.speed=e.config.speed.options,Fe.call(e),B(window.Vimeo)?ft.ready.call(e):ht(e.config.urls.vimeo.sdk).then(function(){ft.ready.call(e)}).catch(function(t){e.debug.warn("Vimeo SDK (player.js) failed to load",t)})},ready:function(){var e=this,t=this,n=t.config.vimeo,i=n.premium,r=n.referrerPolicy,s=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(n,["premium","referrerPolicy"]);i&&Object.assign(s,{controls:!1,sidedock:!1});var l=$e(a({loop:t.config.loop.active,autoplay:t.autoplay,muted:t.muted,gesture:"media",playsinline:!this.config.fullscreen.iosNative},s)),u=t.media.getAttribute("src");ee(u)&&(u=t.media.getAttribute(t.config.attributes.embed.id));var c,h=ee(c=u)?null:j(Number(c))?c:c.match(/^.*(vimeo.com\/|video\/)(\d+).*/)?RegExp.$2:c,d=le("iframe"),f=Ne(t.config.urls.vimeo.iframe,h,l);if(d.setAttribute("src",f),d.setAttribute("allowfullscreen",""),d.setAttribute("allow",["autoplay","fullscreen","picture-in-picture"].join("; ")),ee(r)||d.setAttribute("referrerPolicy",r),i||!n.customControls)d.setAttribute("data-poster",t.poster),t.media=de(d,t.media);else{var p=le("div",{class:t.config.classNames.embedContainer,"data-poster":t.poster});p.appendChild(d),t.media=de(p,t.media)}n.customControls||We(Ne(t.config.urls.vimeo.api,f)).then(function(e){!ee(e)&&e.thumbnail_url&&lt.setPoster.call(t,e.thumbnail_url).catch(function(){})}),t.embed=new window.Vimeo.Player(d,{autopause:t.config.autopause,muted:t.muted}),t.media.paused=!0,t.media.currentTime=0,t.supported.ui&&t.embed.disableTextTrack(),t.media.play=function(){return dt.call(t,!0),t.embed.play()},t.media.pause=function(){return dt.call(t,!1),t.embed.pause()},t.media.stop=function(){t.pause(),t.currentTime=0};var m=t.media.currentTime;Object.defineProperty(t.media,"currentTime",{get:function(){return m},set:function(e){var n=t.embed,i=t.media,r=t.paused,s=t.volume,a=r&&!n.hasPlayed;i.seeking=!0,Re.call(t,i,"seeking"),Promise.resolve(a&&n.setVolume(0)).then(function(){return n.setCurrentTime(e)}).then(function(){return a&&n.pause()}).then(function(){return a&&n.setVolume(s)}).catch(function(){})}});var g=t.config.speed.selected;Object.defineProperty(t.media,"playbackRate",{get:function(){return g},set:function(e){t.embed.setPlaybackRate(e).then(function(){g=e,Re.call(t,t.media,"ratechange")}).catch(function(){t.options.speed=[1]})}});var v=t.config.volume;Object.defineProperty(t.media,"volume",{get:function(){return v},set:function(e){t.embed.setVolume(e).then(function(){v=e,Re.call(t,t.media,"volumechange")})}});var y=t.config.muted;Object.defineProperty(t.media,"muted",{get:function(){return y},set:function(e){var n=!!W(e)&&e;t.embed.setVolume(n?0:t.config.volume).then(function(){y=n,Re.call(t,t.media,"volumechange")})}});var b,_=t.config.loop;Object.defineProperty(t.media,"loop",{get:function(){return _},set:function(e){var n=W(e)?e:t.config.loop.active;t.embed.setLoop(n).then(function(){_=n})}}),t.embed.getVideoUrl().then(function(e){b=e,Ke.setDownloadUrl.call(t)}).catch(function(t){e.debug.warn(t)}),Object.defineProperty(t.media,"currentSrc",{get:function(){return b}}),Object.defineProperty(t.media,"ended",{get:function(){return t.currentTime===t.duration}}),Promise.all([t.embed.getVideoWidth(),t.embed.getVideoHeight()]).then(function(n){var i=o(n,2),r=i[0],s=i[1];t.embed.ratio=[r,s],Fe.call(e)}),t.embed.setAutopause(t.config.autopause).then(function(e){t.config.autopause=e}),t.embed.getVideoTitle().then(function(n){t.config.title=n,lt.setTitle.call(e)}),t.embed.getCurrentTime().then(function(e){m=e,Re.call(t,t.media,"timeupdate")}),t.embed.getDuration().then(function(e){t.media.duration=e,Re.call(t,t.media,"durationchange")}),t.embed.getTextTracks().then(function(e){t.media.textTracks=e,Je.setup.call(t)}),t.embed.on("cuechange",function(e){var n=e.cues,i=(void 0===n?[]:n).map(function(e){return function(e){var t=document.createDocumentFragment(),n=document.createElement("div");return t.appendChild(n),n.innerHTML=e,t.firstChild.innerText}(e.text)});Je.updateCues.call(t,i)}),t.embed.on("loaded",function(){t.embed.getPaused().then(function(e){dt.call(t,!e),e||Re.call(t,t.media,"playing")}),Y(t.embed.element)&&t.supported.ui&&t.embed.element.setAttribute("tabindex",-1)}),t.embed.on("bufferstart",function(){Re.call(t,t.media,"waiting")}),t.embed.on("bufferend",function(){Re.call(t,t.media,"playing")}),t.embed.on("play",function(){dt.call(t,!0),Re.call(t,t.media,"playing")}),t.embed.on("pause",function(){dt.call(t,!1)}),t.embed.on("timeupdate",function(e){t.media.seeking=!1,m=e.seconds,Re.call(t,t.media,"timeupdate")}),t.embed.on("progress",function(e){t.media.buffered=e.percent,Re.call(t,t.media,"progress"),1===parseInt(e.percent,10)&&Re.call(t,t.media,"canplaythrough"),t.embed.getDuration().then(function(e){e!==t.media.duration&&(t.media.duration=e,Re.call(t,t.media,"durationchange"))})}),t.embed.on("seeked",function(){t.media.seeking=!1,Re.call(t,t.media,"seeked")}),t.embed.on("ended",function(){t.media.paused=!0,Re.call(t,t.media,"ended")}),t.embed.on("error",function(e){t.media.error=e,Re.call(t,t.media,"error")}),n.customControls&&setTimeout(function(){return lt.build.call(t)},0)}};function pt(e){e&&!this.embed.hasPlayed&&(this.embed.hasPlayed=!0),this.media.paused===e&&(this.media.paused=!e,Re.call(this,this.media,e?"play":"pause"))}function mt(e){return e.noCookie?"https://www.youtube-nocookie.com":"http:"===window.location.protocol?"http://www.youtube.com":void 0}var gt,vt={setup:function(){var e=this;if(me(this.elements.wrapper,this.config.classNames.embed,!0),B(window.YT)&&q(window.YT.Player))vt.ready.call(this);else{var t=window.onYouTubeIframeAPIReady;window.onYouTubeIframeAPIReady=function(){q(t)&&t(),vt.ready.call(e)},ht(this.config.urls.youtube.sdk).catch(function(t){e.debug.warn("YouTube API failed to load",t)})}},getTitle:function(e){var t=this;We(Ne(this.config.urls.youtube.api,e)).then(function(e){if(B(e)){var n=e.title,i=e.height,r=e.width;t.config.title=n,lt.setTitle.call(t),t.embed.ratio=[r,i]}Fe.call(t)}).catch(function(){Fe.call(t)})},ready:function(){var e=this,t=e.config.youtube,n=e.media&&e.media.getAttribute("id");if(ee(n)||!n.startsWith("youtube-")){var i=e.media.getAttribute("src");ee(i)&&(i=e.media.getAttribute(this.config.attributes.embed.id));var r,s,a=ee(r=i)?null:r.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/)?RegExp.$2:r,o=le("div",{id:(s=e.provider,"".concat(s,"-").concat(Math.floor(1e4*Math.random()))),"data-poster":t.customControls?e.poster:void 0});if(e.media=de(o,e.media),t.customControls){var l=function(e){return"https://i.ytimg.com/vi/".concat(a,"/").concat(e,"default.jpg")};ot(l("maxres"),121).catch(function(){return ot(l("sd"),121)}).catch(function(){return ot(l("hq"))}).then(function(t){return lt.setPoster.call(e,t.src)}).then(function(t){t.includes("maxres")||(e.elements.poster.style.backgroundSize="cover")}).catch(function(){})}e.embed=new window.YT.Player(e.media,{videoId:a,host:mt(t),playerVars:se({},{autoplay:e.config.autoplay?1:0,hl:e.config.hl,controls:e.supported.ui&&t.customControls?0:1,disablekb:1,playsinline:e.config.fullscreen.iosNative?0:1,cc_load_policy:e.captions.active?1:0,cc_lang_pref:e.config.captions.language,widget_referrer:window?window.location.href:null},t),events:{onError:function(t){if(!e.media.error){var n=t.data,i={2:"The request contains an invalid parameter value. For example, this error occurs if you specify a video ID that does not have 11 characters, or if the video ID contains invalid characters, such as exclamation points or asterisks.",5:"The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",100:"The video requested was not found. This error occurs when a video has been removed (for any reason) or has been marked as private.",101:"The owner of the requested video does not allow it to be played in embedded players.",150:"The owner of the requested video does not allow it to be played in embedded players."}[n]||"An unknown error occured";e.media.error={code:n,message:i},Re.call(e,e.media,"error")}},onPlaybackRateChange:function(t){var n=t.target;e.media.playbackRate=n.getPlaybackRate(),Re.call(e,e.media,"ratechange")},onReady:function(n){if(!q(e.media.play)){var i=n.target;vt.getTitle.call(e,a),e.media.play=function(){pt.call(e,!0),i.playVideo()},e.media.pause=function(){pt.call(e,!1),i.pauseVideo()},e.media.stop=function(){i.stopVideo()},e.media.duration=i.getDuration(),e.media.paused=!0,e.media.currentTime=0,Object.defineProperty(e.media,"currentTime",{get:function(){return Number(i.getCurrentTime())},set:function(t){e.paused&&!e.embed.hasPlayed&&e.embed.mute(),e.media.seeking=!0,Re.call(e,e.media,"seeking"),i.seekTo(t)}}),Object.defineProperty(e.media,"playbackRate",{get:function(){return i.getPlaybackRate()},set:function(e){i.setPlaybackRate(e)}});var r=e.config.volume;Object.defineProperty(e.media,"volume",{get:function(){return r},set:function(t){r=t,i.setVolume(100*r),Re.call(e,e.media,"volumechange")}});var s=e.config.muted;Object.defineProperty(e.media,"muted",{get:function(){return s},set:function(t){var n=W(t)?t:s;s=n,i[n?"mute":"unMute"](),i.setVolume(100*r),Re.call(e,e.media,"volumechange")}}),Object.defineProperty(e.media,"currentSrc",{get:function(){return i.getVideoUrl()}}),Object.defineProperty(e.media,"ended",{get:function(){return e.currentTime===e.duration}});var o=i.getAvailablePlaybackRates();e.options.speed=o.filter(function(t){return e.config.speed.options.includes(t)}),e.supported.ui&&t.customControls&&e.media.setAttribute("tabindex",-1),Re.call(e,e.media,"timeupdate"),Re.call(e,e.media,"durationchange"),clearInterval(e.timers.buffering),e.timers.buffering=setInterval(function(){e.media.buffered=i.getVideoLoadedFraction(),(null===e.media.lastBuffered||e.media.lastBuffered<e.media.buffered)&&Re.call(e,e.media,"progress"),e.media.lastBuffered=e.media.buffered,1===e.media.buffered&&(clearInterval(e.timers.buffering),Re.call(e,e.media,"canplaythrough"))},200),t.customControls&&setTimeout(function(){return lt.build.call(e)},50)}},onStateChange:function(n){var i=n.target;switch(clearInterval(e.timers.playing),e.media.seeking&&[1,2].includes(n.data)&&(e.media.seeking=!1,Re.call(e,e.media,"seeked")),n.data){case-1:Re.call(e,e.media,"timeupdate"),e.media.buffered=i.getVideoLoadedFraction(),Re.call(e,e.media,"progress");break;case 0:pt.call(e,!1),e.media.loop?(i.stopVideo(),i.playVideo()):Re.call(e,e.media,"ended");break;case 1:t.customControls&&!e.config.autoplay&&e.media.paused&&!e.embed.hasPlayed?e.media.pause():(pt.call(e,!0),Re.call(e,e.media,"playing"),e.timers.playing=setInterval(function(){Re.call(e,e.media,"timeupdate")},50),e.media.duration!==i.getDuration()&&(e.media.duration=i.getDuration(),Re.call(e,e.media,"durationchange")));break;case 2:e.muted||e.embed.unMute(),pt.call(e,!1);break;case 3:Re.call(e,e.media,"waiting")}Re.call(e,e.elements.container,"statechange",!1,{code:n.data})}}})}}},yt={setup:function(){this.media?(me(this.elements.container,this.config.classNames.type.replace("{0}",this.type),!0),me(this.elements.container,this.config.classNames.provider.replace("{0}",this.provider),!0),this.isEmbed&&me(this.elements.container,this.config.classNames.type.replace("{0}","video"),!0),this.isVideo&&(this.elements.wrapper=le("div",{class:this.config.classNames.video}),ae(this.media,this.elements.wrapper),this.elements.poster=le("div",{class:this.config.classNames.poster,hidden:""}),this.elements.wrapper.appendChild(this.elements.poster)),this.isHTML5?De.setup.call(this):this.isYouTube?vt.setup.call(this):this.isVimeo&&ft.setup.call(this)):this.debug.warn("No media element found!")}},bt=function(){function e(n){var i=this;t(this,e),r(this,"load",function(){i.enabled&&(B(window.google)&&B(window.google.ima)?i.ready():ht(i.player.config.urls.googleIMA.sdk).then(function(){i.ready()}).catch(function(){i.trigger("error",new Error("Google IMA SDK failed to load"))}))}),r(this,"ready",function(){var e;i.enabled||((e=i).manager&&e.manager.destroy(),e.elements.displayContainer&&e.elements.displayContainer.destroy(),e.elements.container.remove()),i.startSafetyTimer(12e3,"ready()"),i.managerPromise.then(function(){i.clearSafetyTimer("onAdsManagerLoaded()")}),i.listeners(),i.setupIMA()}),r(this,"setupIMA",function(){i.elements.container=le("div",{class:i.player.config.classNames.ads}),i.player.elements.container.appendChild(i.elements.container),google.ima.settings.setVpaidMode(google.ima.ImaSdkSettings.VpaidMode.ENABLED),google.ima.settings.setLocale(i.player.config.ads.language),google.ima.settings.setDisableCustomPlaybackForIOS10Plus(i.player.config.playsinline),i.elements.displayContainer=new google.ima.AdDisplayContainer(i.elements.container,i.player.media),i.loader=new google.ima.AdsLoader(i.elements.displayContainer),i.loader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(e){return i.onAdsManagerLoaded(e)},!1),i.loader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(e){return i.onAdError(e)},!1),i.requestAds()}),r(this,"requestAds",function(){var e=i.player.elements.container;try{var t=new google.ima.AdsRequest;t.adTagUrl=i.tagUrl,t.linearAdSlotWidth=e.offsetWidth,t.linearAdSlotHeight=e.offsetHeight,t.nonLinearAdSlotWidth=e.offsetWidth,t.nonLinearAdSlotHeight=e.offsetHeight,t.forceNonLinearFullSlot=!1,t.setAdWillPlayMuted(!i.player.muted),i.loader.requestAds(t)}catch(e){i.onAdError(e)}}),r(this,"pollCountdown",function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0]))return clearInterval(i.countdownTimer),void i.elements.container.removeAttribute("data-badge-text");i.countdownTimer=setInterval(function(){var e=Ze(Math.max(i.manager.getRemainingTime(),0)),t="".concat(je("advertisement",i.player.config)," - ").concat(e);i.elements.container.setAttribute("data-badge-text",t)},100)}),r(this,"onAdsManagerLoaded",function(e){if(i.enabled){var t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!0,t.enablePreloading=!0,i.manager=e.getAdsManager(i.player,t),i.cuePoints=i.manager.getCuePoints(),i.manager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,function(e){return i.onAdError(e)}),Object.keys(google.ima.AdEvent.Type).forEach(function(e){i.manager.addEventListener(google.ima.AdEvent.Type[e],function(e){return i.onAdEvent(e)})}),i.trigger("loaded")}}),r(this,"addCuePoints",function(){ee(i.cuePoints)||i.cuePoints.forEach(function(e){if(0!==e&&-1!==e&&e<i.player.duration){var t=i.player.elements.progress;if(Y(t)){var n=100/i.player.duration*e,r=le("span",{class:i.player.config.classNames.cues});r.style.left="".concat(n.toString(),"%"),t.appendChild(r)}}})}),r(this,"onAdEvent",function(e){var t=i.player.elements.container,n=e.getAd(),r=e.getAdData();switch(function(e){Re.call(i.player,i.player.media,"ads".concat(e.replace(/_/g,"").toLowerCase()))}(e.type),e.type){case google.ima.AdEvent.Type.LOADED:i.trigger("loaded"),i.pollCountdown(!0),n.isLinear()||(n.width=t.offsetWidth,n.height=t.offsetHeight);break;case google.ima.AdEvent.Type.STARTED:i.manager.setVolume(i.player.volume);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:i.player.ended?i.loadAds():i.loader.contentComplete();break;case google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED:i.pauseContent();break;case google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED:i.pollCountdown(),i.resumeContent();break;case google.ima.AdEvent.Type.LOG:r.adError&&i.player.debug.warn("Non-fatal ad error: ".concat(r.adError.getMessage()))}}),r(this,"onAdError",function(e){i.cancel(),i.player.debug.warn("Ads error",e)}),r(this,"listeners",function(){var e,t=i.player.elements.container;i.player.on("canplay",function(){i.addCuePoints()}),i.player.on("ended",function(){i.loader.contentComplete()}),i.player.on("timeupdate",function(){e=i.player.currentTime}),i.player.on("seeked",function(){var t=i.player.currentTime;ee(i.cuePoints)||i.cuePoints.forEach(function(n,r){e<n&&n<t&&(i.manager.discardAdBreak(),i.cuePoints.splice(r,1))})}),window.addEventListener("resize",function(){i.manager&&i.manager.resize(t.offsetWidth,t.offsetHeight,google.ima.ViewMode.NORMAL)})}),r(this,"play",function(){var e=i.player.elements.container;i.managerPromise||i.resumeContent(),i.managerPromise.then(function(){i.manager.setVolume(i.player.volume),i.elements.displayContainer.initialize();try{i.initialized||(i.manager.init(e.offsetWidth,e.offsetHeight,google.ima.ViewMode.NORMAL),i.manager.start()),i.initialized=!0}catch(e){i.onAdError(e)}}).catch(function(){})}),r(this,"resumeContent",function(){i.elements.container.style.zIndex="",i.playing=!1,Ae(i.player.media.play())}),r(this,"pauseContent",function(){i.elements.container.style.zIndex=3,i.playing=!0,i.player.media.pause()}),r(this,"cancel",function(){i.initialized&&i.resumeContent(),i.trigger("error"),i.loadAds()}),r(this,"loadAds",function(){i.managerPromise.then(function(){i.manager&&i.manager.destroy(),i.managerPromise=new Promise(function(e){i.on("loaded",e),i.player.debug.log(i.manager)}),i.initialized=!1,i.requestAds()}).catch(function(){})}),r(this,"trigger",function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var s=i.events[e];X(s)&&s.forEach(function(e){q(e)&&e.apply(i,n)})}),r(this,"on",function(e,t){return X(i.events[e])||(i.events[e]=[]),i.events[e].push(t),i}),r(this,"startSafetyTimer",function(e,t){i.player.debug.log("Safety timer invoked from: ".concat(t)),i.safetyTimer=setTimeout(function(){i.cancel(),i.clearSafetyTimer("startSafetyTimer()")},e)}),r(this,"clearSafetyTimer",function(e){V(i.safetyTimer)||(i.player.debug.log("Safety timer cleared from: ".concat(e)),clearTimeout(i.safetyTimer),i.safetyTimer=null)}),this.player=n,this.config=n.config.ads,this.playing=!1,this.initialized=!1,this.elements={container:null,displayContainer:null},this.manager=null,this.loader=null,this.cuePoints=null,this.events={},this.safetyTimer=null,this.countdownTimer=null,this.managerPromise=new Promise(function(e,t){i.on("loaded",e),i.on("error",t)}),this.load()}return i(e,[{key:"enabled",get:function(){var e=this.config;return this.player.isHTML5&&this.player.isVideo&&e.enabled&&(!ee(e.publisherId)||J(e.tagUrl))}},{key:"tagUrl",get:function(){var e=this.config;if(J(e.tagUrl))return e.tagUrl;var t={AV_PUBLISHERID:"58c25bb0073ef448b1087ad6",AV_CHANNELID:"5a0458dc28a06145e4519d21",AV_URL:window.location.hostname,cb:Date.now(),AV_WIDTH:640,AV_HEIGHT:480,AV_CDIM2:e.publisherId};return"".concat("https://go.aniview.com/api/adserver6/vast/","?").concat($e(t))}}]),e}(),_t=function(e,t){var n={};return e>t.width/t.height?(n.width=t.width,n.height=1/e*t.width):(n.height=t.height,n.width=e*t.height),n},xt=function(){function e(n){var i=this;t(this,e),r(this,"load",function(){i.player.elements.display.seekTooltip&&(i.player.elements.display.seekTooltip.hidden=i.enabled),i.enabled&&i.getThumbnails().then(function(){i.enabled&&(i.render(),i.determineContainerAutoSizing(),i.loaded=!0)})}),r(this,"getThumbnails",function(){return new Promise(function(e){var t=i.player.config.previewThumbnails.src;if(ee(t))throw new Error("Missing previewThumbnails.src config attribute");var n=function(){i.thumbnails.sort(function(e,t){return e.height-t.height}),i.player.debug.log("Preview thumbnails",i.thumbnails),e()};if(q(t))t(function(e){i.thumbnails=e,n()});else{var r=(H(t)?[t]:t).map(function(e){return i.getThumbnail(e)});Promise.all(r).then(n)}})}),r(this,"getThumbnail",function(e){return new Promise(function(t){We(e).then(function(n){var r,s,a={frames:(r=n,s=[],r.split(/\r\n\r\n|\n\n|\r\r/).forEach(function(e){var t={};e.split(/\r\n|\n|\r/).forEach(function(e){if(j(t.startTime)){if(!ee(e.trim())&&ee(t.text)){var n=e.trim().split("#xywh="),i=o(n,1);if(t.text=i[0],n[1]){var r=o(n[1].split(","),4);t.x=r[0],t.y=r[1],t.w=r[2],t.h=r[3]}}}else{var s=e.match(/([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})( ?--> ?)([0-9]{2})?:?([0-9]{2}):([0-9]{2}).([0-9]{2,3})/);s&&(t.startTime=60*Number(s[1]||0)*60+60*Number(s[2])+Number(s[3])+Number("0.".concat(s[4])),t.endTime=60*Number(s[6]||0)*60+60*Number(s[7])+Number(s[8])+Number("0.".concat(s[9])))}}),t.text&&s.push(t)}),s),height:null,urlPrefix:""};a.frames[0].text.startsWith("/")||a.frames[0].text.startsWith("http://")||a.frames[0].text.startsWith("https://")||(a.urlPrefix=e.substring(0,e.lastIndexOf("/")+1));var l=new Image;l.onload=function(){a.height=l.naturalHeight,a.width=l.naturalWidth,i.thumbnails.push(a),t()},l.src=a.urlPrefix+a.frames[0].text})})}),r(this,"startMove",function(e){if(i.loaded&&Z(e)&&["touchmove","mousemove"].includes(e.type)&&i.player.media.duration){if("touchmove"===e.type)i.seekTime=i.player.media.duration*(i.player.elements.inputs.seek.value/100);else{var t=i.player.elements.progress.getBoundingClientRect(),n=100/t.width*(e.pageX-t.left);i.seekTime=i.player.media.duration*(n/100),i.seekTime<0&&(i.seekTime=0),i.seekTime>i.player.media.duration-1&&(i.seekTime=i.player.media.duration-1),i.mousePosX=e.pageX,i.elements.thumb.time.innerText=Ze(i.seekTime)}i.showImageAtCurrentTime()}}),r(this,"endMove",function(){i.toggleThumbContainer(!1,!0)}),r(this,"startScrubbing",function(e){(V(e.button)||!1===e.button||0===e.button)&&(i.mouseDown=!0,i.player.media.duration&&(i.toggleScrubbingContainer(!0),i.toggleThumbContainer(!1,!0),i.showImageAtCurrentTime()))}),r(this,"endScrubbing",function(){i.mouseDown=!1,Math.ceil(i.lastTime)===Math.ceil(i.player.media.currentTime)?i.toggleScrubbingContainer(!1):Ce.call(i.player,i.player.media,"timeupdate",function(){i.mouseDown||i.toggleScrubbingContainer(!1)})}),r(this,"listeners",function(){i.player.on("play",function(){i.toggleThumbContainer(!1,!0)}),i.player.on("seeked",function(){i.toggleThumbContainer(!1)}),i.player.on("timeupdate",function(){i.lastTime=i.player.media.currentTime})}),r(this,"render",function(){i.elements.thumb.container=le("div",{class:i.player.config.classNames.previewThumbnails.thumbContainer}),i.elements.thumb.imageContainer=le("div",{class:i.player.config.classNames.previewThumbnails.imageContainer}),i.elements.thumb.container.appendChild(i.elements.thumb.imageContainer);var e=le("div",{class:i.player.config.classNames.previewThumbnails.timeContainer});i.elements.thumb.time=le("span",{},"00:00"),e.appendChild(i.elements.thumb.time),i.elements.thumb.container.appendChild(e),Y(i.player.elements.progress)&&i.player.elements.progress.appendChild(i.elements.thumb.container),i.elements.scrubbing.container=le("div",{class:i.player.config.classNames.previewThumbnails.scrubbingContainer}),i.player.elements.wrapper.appendChild(i.elements.scrubbing.container)}),r(this,"destroy",function(){i.elements.thumb.container&&i.elements.thumb.container.remove(),i.elements.scrubbing.container&&i.elements.scrubbing.container.remove()}),r(this,"showImageAtCurrentTime",function(){i.mouseDown?i.setScrubbingContainerSize():i.setThumbContainerSizeAndPos();var e=i.thumbnails[0].frames.findIndex(function(e){return i.seekTime>=e.startTime&&i.seekTime<=e.endTime}),t=e>=0,n=0;i.mouseDown||i.toggleThumbContainer(t),t&&(i.thumbnails.forEach(function(t,r){i.loadedImages.includes(t.frames[e].text)&&(n=r)}),e!==i.showingThumb&&(i.showingThumb=e,i.loadImage(n)))}),r(this,"loadImage",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=i.showingThumb,n=i.thumbnails[e],r=n.urlPrefix,s=n.frames[t],a=n.frames[t].text,o=r+a;if(i.currentImageElement&&i.currentImageElement.dataset.filename===a)i.showImage(i.currentImageElement,s,e,t,a,!1),i.currentImageElement.dataset.index=t,i.removeOldImages(i.currentImageElement);else{i.loadingImage&&i.usingSprites&&(i.loadingImage.onload=null);var l=new Image;l.src=o,l.dataset.index=t,l.dataset.filename=a,i.showingThumbFilename=a,i.player.debug.log("Loading image: ".concat(o)),l.onload=function(){return i.showImage(l,s,e,t,a,!0)},i.loadingImage=l,i.removeOldImages(l)}}),r(this,"showImage",function(e,t,n,r,s){var a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];i.player.debug.log("Showing thumb: ".concat(s,". num: ").concat(r,". qual: ").concat(n,". newimg: ").concat(a)),i.setImageSizeAndOffset(e,t),a&&(i.currentImageContainer.appendChild(e),i.currentImageElement=e,i.loadedImages.includes(s)||i.loadedImages.push(s)),i.preloadNearby(r,!0).then(i.preloadNearby(r,!1)).then(i.getHigherQuality(n,e,t,s))}),r(this,"removeOldImages",function(e){Array.from(i.currentImageContainer.children).forEach(function(t){if("img"===t.tagName.toLowerCase()){var n=i.usingSprites?500:1e3;if(t.dataset.index!==e.dataset.index&&!t.dataset.deleting){t.dataset.deleting=!0;var r=i.currentImageContainer;setTimeout(function(){r.removeChild(t),i.player.debug.log("Removing thumb: ".concat(t.dataset.filename))},n)}}})}),r(this,"preloadNearby",function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(function(n){setTimeout(function(){var r=i.thumbnails[0].frames[e].text;if(i.showingThumbFilename===r){var s;s=t?i.thumbnails[0].frames.slice(e):i.thumbnails[0].frames.slice(0,e).reverse();var a=!1;s.forEach(function(e){var t=e.text;if(t!==r&&!i.loadedImages.includes(t)){a=!0,i.player.debug.log("Preloading thumb filename: ".concat(t));var s=i.thumbnails[0].urlPrefix+t,o=new Image;o.src=s,o.onload=function(){i.player.debug.log("Preloaded thumb filename: ".concat(t)),i.loadedImages.includes(t)||i.loadedImages.push(t),n()}}}),a||n()}},300)})}),r(this,"getHigherQuality",function(e,t,n,r){if(e<i.thumbnails.length-1){var s=t.naturalHeight;i.usingSprites&&(s=n.h),s<i.thumbContainerHeight&&setTimeout(function(){i.showingThumbFilename===r&&(i.player.debug.log("Showing higher quality thumb for: ".concat(r)),i.loadImage(e+1))},300)}}),r(this,"toggleThumbContainer",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=i.player.config.classNames.previewThumbnails.thumbContainerShown;i.elements.thumb.container.classList.toggle(n,e),!e&&t&&(i.showingThumb=null,i.showingThumbFilename=null)}),r(this,"toggleScrubbingContainer",function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=i.player.config.classNames.previewThumbnails.scrubbingContainerShown;i.elements.scrubbing.container.classList.toggle(t,e),e||(i.showingThumb=null,i.showingThumbFilename=null)}),r(this,"determineContainerAutoSizing",function(){(i.elements.thumb.imageContainer.clientHeight>20||i.elements.thumb.imageContainer.clientWidth>20)&&(i.sizeSpecifiedInCSS=!0)}),r(this,"setThumbContainerSizeAndPos",function(){if(i.sizeSpecifiedInCSS){if(i.elements.thumb.imageContainer.clientHeight>20&&i.elements.thumb.imageContainer.clientWidth<20){var e=Math.floor(i.elements.thumb.imageContainer.clientHeight*i.thumbAspectRatio);i.elements.thumb.imageContainer.style.width="".concat(e,"px")}else if(i.elements.thumb.imageContainer.clientHeight<20&&i.elements.thumb.imageContainer.clientWidth>20){var t=Math.floor(i.elements.thumb.imageContainer.clientWidth/i.thumbAspectRatio);i.elements.thumb.imageContainer.style.height="".concat(t,"px")}}else{var n=Math.floor(i.thumbContainerHeight*i.thumbAspectRatio);i.elements.thumb.imageContainer.style.height="".concat(i.thumbContainerHeight,"px"),i.elements.thumb.imageContainer.style.width="".concat(n,"px")}i.setThumbContainerPos()}),r(this,"setThumbContainerPos",function(){var e=i.player.elements.progress.getBoundingClientRect(),t=i.player.elements.container.getBoundingClientRect(),n=i.elements.thumb.container,r=t.left-e.left+10,s=t.right-e.left-n.clientWidth-10,a=i.mousePosX-e.left-n.clientWidth/2;a<r&&(a=r),a>s&&(a=s),n.style.left="".concat(a,"px")}),r(this,"setScrubbingContainerSize",function(){var e=_t(i.thumbAspectRatio,{width:i.player.media.clientWidth,height:i.player.media.clientHeight}),t=e.width,n=e.height;i.elements.scrubbing.container.style.width="".concat(t,"px"),i.elements.scrubbing.container.style.height="".concat(n,"px")}),r(this,"setImageSizeAndOffset",function(e,t){if(i.usingSprites){var n=i.thumbContainerHeight/t.h;e.style.height="".concat(e.naturalHeight*n,"px"),e.style.width="".concat(e.naturalWidth*n,"px"),e.style.left="-".concat(t.x*n,"px"),e.style.top="-".concat(t.y*n,"px")}}),this.player=n,this.thumbnails=[],this.loaded=!1,this.lastMouseMoveTime=Date.now(),this.mouseDown=!1,this.loadedImages=[],this.elements={thumb:{},scrubbing:{}},this.load()}return i(e,[{key:"enabled",get:function(){return this.player.isHTML5&&this.player.isVideo&&this.player.config.previewThumbnails.enabled}},{key:"currentImageContainer",get:function(){return this.mouseDown?this.elements.scrubbing.container:this.elements.thumb.imageContainer}},{key:"usingSprites",get:function(){return Object.keys(this.thumbnails[0].frames[0]).includes("w")}},{key:"thumbAspectRatio",get:function(){return this.usingSprites?this.thumbnails[0].frames[0].w/this.thumbnails[0].frames[0].h:this.thumbnails[0].width/this.thumbnails[0].height}},{key:"thumbContainerHeight",get:function(){return this.mouseDown?_t(this.thumbAspectRatio,{width:this.player.media.clientWidth,height:this.player.media.clientHeight}).height:this.sizeSpecifiedInCSS?this.elements.thumb.imageContainer.clientHeight:Math.floor(this.player.media.clientWidth/this.thumbAspectRatio/4)}},{key:"currentImageElement",get:function(){return this.mouseDown?this.currentScrubbingImageElement:this.currentThumbnailImageElement},set:function(e){this.mouseDown?this.currentScrubbingImageElement=e:this.currentThumbnailImageElement=e}}]),e}(),wt={insertElements:function(e,t){var n=this;H(t)?ue(e,this.media,{src:t}):X(t)&&t.forEach(function(t){ue(e,n.media,t)})},change:function(e){var t=this;re(e,"sources.length")?(De.cancelRequests.call(this),this.destroy.call(this,function(){t.options.quality=[],ce(t.media),t.media=null,Y(t.elements.container)&&t.elements.container.removeAttribute("class");var n=e.sources,i=e.type,r=o(n,1)[0],s=r.provider,a=void 0===s?nt.html5:s,l=r.src,u="html5"===a?i:"div",c="html5"===a?{}:{src:l};Object.assign(t,{provider:a,type:i,supported:ke.check(i,a,t.config.playsinline),media:le(u,c)}),t.elements.container.appendChild(t.media),W(e.autoplay)&&(t.config.autoplay=e.autoplay),t.isHTML5&&(t.config.crossorigin&&t.media.setAttribute("crossorigin",""),t.config.autoplay&&t.media.setAttribute("autoplay",""),ee(e.poster)||(t.poster=e.poster),t.config.loop.active&&t.media.setAttribute("loop",""),t.config.muted&&t.media.setAttribute("muted",""),t.config.playsinline&&t.media.setAttribute("playsinline","")),lt.addStyleHook.call(t),t.isHTML5&&wt.insertElements.call(t,"source",n),t.config.title=e.title,yt.setup.call(t),t.isHTML5&&Object.keys(e).includes("tracks")&&wt.insertElements.call(t,"track",e.tracks),(t.isHTML5||t.isEmbed&&!t.supported.ui)&&lt.build.call(t),t.isHTML5&&t.media.load(),ee(e.previewThumbnails)||(Object.assign(t.config.previewThumbnails,e.previewThumbnails),t.previewThumbnails&&t.previewThumbnails.loaded&&(t.previewThumbnails.destroy(),t.previewThumbnails=null),t.config.previewThumbnails.enabled&&(t.previewThumbnails=new xt(t))),t.fullscreen.update()},!0)):this.debug.warn("Invalid source format")}},kt=function(){function e(n,i){var s=this;if(t(this,e),r(this,"play",function(){return q(s.media.play)?(s.ads&&s.ads.enabled&&s.ads.managerPromise.then(function(){return s.ads.play()}).catch(function(){return Ae(s.media.play())}),s.media.play()):null}),r(this,"pause",function(){return s.playing&&q(s.media.pause)?s.media.pause():null}),r(this,"togglePlay",function(e){return(W(e)?e:!s.playing)?s.play():s.pause()}),r(this,"stop",function(){s.isHTML5?(s.pause(),s.restart()):q(s.media.stop)&&s.media.stop()}),r(this,"restart",function(){s.currentTime=0}),r(this,"rewind",function(e){s.currentTime-=j(e)?e:s.config.seekTime}),r(this,"forward",function(e){s.currentTime+=j(e)?e:s.config.seekTime}),r(this,"increaseVolume",function(e){var t=s.media.muted?0:s.volume;s.volume=t+(j(e)?e:0)}),r(this,"decreaseVolume",function(e){s.increaseVolume(-e)}),r(this,"airplay",function(){ke.airplay&&s.media.webkitShowPlaybackTargetPicker()}),r(this,"toggleControls",function(e){if(s.supported.ui&&!s.isAudio){var t=ge(s.elements.container,s.config.classNames.hideControls),n=void 0===e?void 0:!e,i=me(s.elements.container,s.config.classNames.hideControls,n);if(i&&X(s.config.controls)&&s.config.controls.includes("settings")&&!ee(s.config.settings)&&Ke.toggleMenu.call(s,!1),i!==t){var r=i?"controlshidden":"controlsshown";Re.call(s,s.media,r)}return!i}return!1}),r(this,"on",function(e,t){Pe.call(s,s.elements.container,e,t)}),r(this,"once",function(e,t){Ce.call(s,s.elements.container,e,t)}),r(this,"off",function(e,t){Se(s.elements.container,e,t)}),r(this,"destroy",function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(s.ready){var n=function(){document.body.style.overflow="",s.embed=null,t?(Object.keys(s.elements).length&&(ce(s.elements.buttons.play),ce(s.elements.captions),ce(s.elements.controls),ce(s.elements.wrapper),s.elements.buttons.play=null,s.elements.captions=null,s.elements.controls=null,s.elements.wrapper=null),q(e)&&e()):(function(){this&&this.eventListeners&&(this.eventListeners.forEach(function(e){var t=e.element,n=e.type,i=e.callback,r=e.options;t.removeEventListener(n,i,r)}),this.eventListeners=[])}.call(s),De.cancelRequests.call(s),de(s.elements.original,s.elements.container),Re.call(s,s.elements.original,"destroyed",!0),q(e)&&e.call(s.elements.original),s.ready=!1,setTimeout(function(){s.elements=null,s.media=null},200))};s.stop(),clearTimeout(s.timers.loading),clearTimeout(s.timers.controls),clearTimeout(s.timers.resized),s.isHTML5?(lt.toggleNativeControls.call(s,!0),n()):s.isYouTube?(clearInterval(s.timers.buffering),clearInterval(s.timers.playing),null!==s.embed&&q(s.embed.destroy)&&s.embed.destroy(),n()):s.isVimeo&&(null!==s.embed&&s.embed.unload().then(n),setTimeout(n,200))}}),r(this,"supports",function(e){return ke.mime.call(s,e)}),this.timers={},this.ready=!1,this.loading=!1,this.failed=!1,this.touch=ke.touch,this.media=n,H(this.media)&&(this.media=document.querySelectorAll(this.media)),(window.jQuery&&this.media instanceof jQuery||G(this.media)||X(this.media))&&(this.media=this.media[0]),this.config=se({},et,e.defaults,i||{},function(){try{return JSON.parse(s.media.getAttribute("data-plyr-config"))}catch(e){return{}}}()),this.elements={container:null,fullscreen:null,captions:null,buttons:{},display:{},progress:{},inputs:{},settings:{popup:null,menu:null,panels:{},buttons:{}}},this.captions={active:null,currentTrack:-1,meta:new WeakMap},this.fullscreen={active:!1},this.options={speed:[],quality:[]},this.debug=new st(this.config.debug),this.debug.log("Config",this.config),this.debug.log("Support",ke),!V(this.media)&&Y(this.media))if(this.media.plyr)this.debug.warn("Target already setup");else if(this.config.enabled)if(ke.check().api){var a=this.media.cloneNode(!0);a.autoplay=!1,this.elements.original=a;var o=this.media.tagName.toLowerCase(),l=null,u=null;switch(o){case"div":if(l=this.media.querySelector("iframe"),Y(l)){if(u=Qe(l.getAttribute("src")),this.provider=function(e){return/^(https?:\/\/)?(www\.)?(youtube\.com|youtube-nocookie\.com|youtu\.?be)\/.+$/.test(e)?nt.youtube:/^https?:\/\/player.vimeo.com\/video\/\d{0,9}(?=\b|\/)/.test(e)?nt.vimeo:null}(u.toString()),this.elements.container=this.media,this.media=l,this.elements.container.className="",u.search.length){var c=["1","true"];c.includes(u.searchParams.get("autoplay"))&&(this.config.autoplay=!0),c.includes(u.searchParams.get("loop"))&&(this.config.loop.active=!0),this.isYouTube?(this.config.playsinline=c.includes(u.searchParams.get("playsinline")),this.config.youtube.hl=u.searchParams.get("hl")):this.config.playsinline=!0}}else this.provider=this.media.getAttribute(this.config.attributes.embed.provider),this.media.removeAttribute(this.config.attributes.embed.provider);if(ee(this.provider)||!Object.values(nt).includes(this.provider))return void this.debug.error("Setup failed: Invalid provider");this.type=it;break;case"video":case"audio":this.type=o,this.provider=nt.html5,this.media.hasAttribute("crossorigin")&&(this.config.crossorigin=!0),this.media.hasAttribute("autoplay")&&(this.config.autoplay=!0),(this.media.hasAttribute("playsinline")||this.media.hasAttribute("webkit-playsinline"))&&(this.config.playsinline=!0),this.media.hasAttribute("muted")&&(this.config.muted=!0),this.media.hasAttribute("loop")&&(this.config.loop.active=!0);break;default:return void this.debug.error("Setup failed: unsupported type")}this.supported=ke.check(this.type,this.provider,this.config.playsinline),this.supported.api?(this.eventListeners=[],this.listeners=new ut(this),this.storage=new He(this),this.media.plyr=this,Y(this.elements.container)||(this.elements.container=le("div",{tabindex:0}),ae(this.media,this.elements.container)),lt.migrateStyles.call(this),lt.addStyleHook.call(this),yt.setup.call(this),this.config.debug&&Pe.call(this,this.elements.container,this.config.events.join(" "),function(e){s.debug.log("event: ".concat(e.type))}),this.fullscreen=new at(this),(this.isHTML5||this.isEmbed&&!this.supported.ui)&&lt.build.call(this),this.listeners.container(),this.listeners.global(),this.config.ads.enabled&&(this.ads=new bt(this)),this.isHTML5&&this.config.autoplay&&this.once("canplay",function(){return Ae(s.play())}),this.lastSeekTime=0,this.config.previewThumbnails.enabled&&(this.previewThumbnails=new xt(this))):this.debug.error("Setup failed: no support")}else this.debug.error("Setup failed: no support");else this.debug.error("Setup failed: disabled by config");else this.debug.error("Setup failed: no suitable element passed")}return i(e,[{key:"toggleCaptions",value:function(e){Je.toggle.call(this,e,!1)}},{key:"isHTML5",get:function(){return this.provider===nt.html5}},{key:"isEmbed",get:function(){return this.isYouTube||this.isVimeo}},{key:"isYouTube",get:function(){return this.provider===nt.youtube}},{key:"isVimeo",get:function(){return this.provider===nt.vimeo}},{key:"isVideo",get:function(){return this.type===it}},{key:"isAudio",get:function(){return"audio"===this.type}},{key:"playing",get:function(){return Boolean(this.ready&&!this.paused&&!this.ended)}},{key:"paused",get:function(){return Boolean(this.media.paused)}},{key:"stopped",get:function(){return Boolean(this.paused&&0===this.currentTime)}},{key:"ended",get:function(){return Boolean(this.media.ended)}},{key:"currentTime",set:function(e){if(this.duration){var t=j(e)&&e>0;this.media.currentTime=t?Math.min(e,this.duration):0,this.debug.log("Seeking to ".concat(this.currentTime," seconds"))}},get:function(){return Number(this.media.currentTime)}},{key:"buffered",get:function(){var e=this.media.buffered;return j(e)?e:e&&e.length&&this.duration>0?e.end(0)/this.duration:0}},{key:"seeking",get:function(){return Boolean(this.media.seeking)}},{key:"duration",get:function(){var e=parseFloat(this.config.duration),t=(this.media||{}).duration,n=j(t)&&t!==1/0?t:0;return e||n}},{key:"volume",set:function(e){var t=e;H(t)&&(t=Number(t)),j(t)||(t=this.storage.get("volume")),j(t)||(t=this.config.volume),t>1&&(t=1),t<0&&(t=0),this.config.volume=t,this.media.volume=t,!ee(e)&&this.muted&&t>0&&(this.muted=!1)},get:function(){return Number(this.media.volume)}},{key:"muted",set:function(e){var t=e;W(t)||(t=this.storage.get("muted")),W(t)||(t=this.config.muted),this.config.muted=t,this.media.muted=t},get:function(){return Boolean(this.media.muted)}},{key:"hasAudio",get:function(){return!this.isHTML5||!!this.isAudio||Boolean(this.media.mozHasAudio)||Boolean(this.media.webkitAudioDecodedByteCount)||Boolean(this.media.audioTracks&&this.media.audioTracks.length)}},{key:"speed",set:function(e){var t=this,n=null;j(e)&&(n=e),j(n)||(n=this.storage.get("speed")),j(n)||(n=this.config.speed.selected);var i=this.minimumSpeed,r=this.maximumSpeed;n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255;return Math.min(Math.max(e,t),n)}(n,i,r),this.config.speed.selected=n,setTimeout(function(){t.media.playbackRate=n},0)},get:function(){return Number(this.media.playbackRate)}},{key:"minimumSpeed",get:function(){return this.isYouTube?Math.min.apply(Math,l(this.options.speed)):this.isVimeo?.5:.0625}},{key:"maximumSpeed",get:function(){return this.isYouTube?Math.max.apply(Math,l(this.options.speed)):this.isVimeo?2:16}},{key:"quality",set:function(e){var t=this.config.quality,n=this.options.quality;if(n.length){var i=[!ee(e)&&Number(e),this.storage.get("quality"),t.selected,t.default].find(j),r=!0;if(!n.includes(i)){var s=function(e,t){return X(e)&&e.length?e.reduce(function(e,n){return Math.abs(n-t)<Math.abs(e-t)?n:e}):null}(n,i);this.debug.warn("Unsupported quality option: ".concat(i,", using ").concat(s," instead")),i=s,r=!1}t.selected=i,this.media.quality=i,r&&this.storage.set({quality:i})}},get:function(){return this.media.quality}},{key:"loop",set:function(e){var t=W(e)?e:this.config.loop.active;this.config.loop.active=t,this.media.loop=t},get:function(){return Boolean(this.media.loop)}},{key:"source",set:function(e){wt.change.call(this,e)},get:function(){return this.media.currentSrc}},{key:"download",get:function(){var e=this.config.urls.download;return J(e)?e:this.source},set:function(e){J(e)&&(this.config.urls.download=e,Ke.setDownloadUrl.call(this))}},{key:"poster",set:function(e){this.isVideo?lt.setPoster.call(this,e,!1).catch(function(){}):this.debug.warn("Poster can only be set for video")},get:function(){return this.isVideo?this.media.getAttribute("poster")||this.media.getAttribute("data-poster"):null}},{key:"ratio",get:function(){if(!this.isVideo)return null;var e=Oe(Le.call(this));return X(e)?e.join(":"):e},set:function(e){this.isVideo?H(e)&&Me(e)?(this.config.ratio=e,Fe.call(this)):this.debug.error("Invalid aspect ratio specified (".concat(e,")")):this.debug.warn("Aspect ratio can only be set for video")}},{key:"autoplay",set:function(e){var t=W(e)?e:this.config.autoplay;this.config.autoplay=t},get:function(){return Boolean(this.config.autoplay)}},{key:"currentTrack",set:function(e){Je.set.call(this,e,!1)},get:function(){var e=this.captions,t=e.toggled,n=e.currentTrack;return t?n:-1}},{key:"language",set:function(e){Je.setLanguage.call(this,e,!1)},get:function(){return(Je.getCurrentTrack.call(this)||{}).language}},{key:"pip",set:function(e){if(ke.pip){var t=W(e)?e:!this.pip;q(this.media.webkitSetPresentationMode)&&this.media.webkitSetPresentationMode(t?tt:"inline"),q(this.media.requestPictureInPicture)&&(!this.pip&&t?this.media.requestPictureInPicture():this.pip&&!t&&document.exitPictureInPicture())}},get:function(){return ke.pip?ee(this.media.webkitPresentationMode)?this.media===document.pictureInPictureElement:this.media.webkitPresentationMode===tt:null}}],[{key:"supported",value:function(e,t,n){return ke.check(e,t,n)}},{key:"loadSprite",value:function(e,t){return qe(e,t)}},{key:"setup",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=null;return H(t)?i=Array.from(document.querySelectorAll(t)):G(t)?i=Array.from(t):X(t)&&(i=t.filter(Y)),ee(i)?null:i.map(function(t){return new e(t,n)})}}]),e}();return kt.defaults=(gt=et,JSON.parse(JSON.stringify(gt))),kt});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){for(var e=["DocumentType","Element","CharacterData"],t=function(){null!=this.parentNode&&this.parentNode.removeChild(this)},n=0;n<e.length;n++){var i=e[n];window[i]&&!window[i].prototype.remove&&(window[i].prototype.remove=t)}}(),function(e){function t(){}function n(e){if("object"!==_typeof(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function i(e,t){for(;3===e._state;)e=e._value;return 0===e._state?void e._deferreds.push(t):(e._handled=!0,void n._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var i;try{i=n(e._value)}catch(e){return void s(t.promise,e)}r(t.promise,i)}else(1===e._state?r:s)(t.promise,e._value)}))}function r(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"===(void 0===t?"undefined":_typeof(t))||"function"==typeof t)){var i=t.then;if(t instanceof n)return e._state=3,e._value=t,void a(e);if("function"==typeof i)return void l(function(e,t){return function(){e.apply(t,arguments)}}(i,t),e)}e._state=1,e._value=t,a(e)}catch(t){s(e,t)}}function s(e,t){e._state=2,e._value=t,a(e)}function a(e){2===e._state&&0===e._deferreds.length&&n._immediateFn(function(){e._handled||n._unhandledRejectionFn(e._value)});for(var t=0,r=e._deferreds.length;t<r;t++)i(e,e._deferreds[t]);e._deferreds=null}function o(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function l(e,t){var n=!1;try{e(function(e){n||(n=!0,r(t,e))},function(e){n||(n=!0,s(t,e))})}catch(e){if(n)return;n=!0,s(t,e)}}var u=setTimeout;n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,n){var r=new this.constructor(t);return i(this,new o(e,n,r)),r},n.all=function(e){var t=Array.prototype.slice.call(e);return new n(function(e,n){function i(s,a){try{if(a&&("object"===(void 0===a?"undefined":_typeof(a))||"function"==typeof a)){var o=a.then;if("function"==typeof o)return void o.call(a,function(e){i(s,e)},n)}t[s]=a,0==--r&&e(t)}catch(e){n(e)}}if(0===t.length)return e([]);for(var r=t.length,s=0;s<t.length;s++)i(s,t[s])})},n.resolve=function(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,n){n(e)})},n.race=function(e){return new n(function(t,n){for(var i=0,r=e.length;i<r;i++)e[i].then(t,n)})},n._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){u(e,0)},n._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},n._setImmediateFn=function(e){n._immediateFn=e},n._setUnhandledRejectionFn=function(e){n._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=n:e.Promise||(e.Promise=n)}(window),function(e){e.Promise||(e.Promise=Promise);var t="required",n="email",i="minLength",r="maxLength",s="password",a="phone",o="remote",l="strength",u="function",c=function(e,t){if("string"==typeof e)return e;var n="post"===t.toLowerCase()?"":"?";return Array.isArray(e)?n+e.map(function(e){return e.name+"="+e.value}).join("&"):n+Object.keys(e).map(function(t){return t+"="+e[t]}).join("&")},h=function(e){var t=e.url,n=e.method,i=e.data,r=e.debug,s=e.callback,a=e.error;if(r)s("test");else{var o=!1!==e.async,l=new XMLHttpRequest,u=c(i,"get"),h=null;"post"===n.toLowerCase()&&(h=c(i,"post"),u=""),l.open(n,t+u,o),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){4===this.readyState&&(200===this.status?s(this.responseText):a&&a(this.responseText))},l.send(h)}},d=function(e,t){this.options=t||{},this.rules=this.options.rules||{},this.messages=this.options.messages||void 0,this.colorWrong=this.options.colorWrong||"#ff0000",this.result={},this.elements=[],this.tooltip=this.options.tooltip||{},this.tooltipFadeOutTime=this.tooltip.fadeOutTime||5e3,this.tooltipFadeOutClass=this.tooltip.fadeOutClass||"just-validate-tooltip-hide",this.tooltipSelectorWrap=document.querySelectorAll(this.tooltip.selectorWrap).length?document.querySelectorAll(this.tooltip.selectorWrap):document.querySelectorAll(".just-validate-tooltip-container"),this.bindHandlerKeyup=this.handlerKeyup.bind(this),this.submitHandler=this.options.submitHandler||void 0,this.invalidFormCallback=this.options.invalidFormCallback||void 0,this.promisesRemote=[],this.isValidationSuccess=!1,this.focusWrongField=this.options.focusWrongField||!1,this.REGEXP={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,zip:/^\d{5}(-\d{4})?$/,phone:/^([0-9]( |-)?)?(\(?[0-9]{3}\)?|[0-9]{3})( |-)?([0-9]{3}( |-)?[0-9]{4}|[a-zA-Z0-9]{7})$/,password:/[^\w\d]*(([0-9]+.*[A-Za-z]+.*)|[A-Za-z]+.*([0-9]+.*))/,strengthPass:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]/},this.DEFAULT_REMOTE_ERROR="Error",this.state={tooltipsTimer:null},this.setForm(document.querySelector(e))};d.prototype={defaultRules:{email:{required:!0,email:!0},name:{required:!0,minLength:3,maxLength:15},text:{required:!0,maxLength:300,minLength:5},password:{required:!0,password:!0,minLength:4,maxLength:8},zip:{required:!0,zip:!0},phone:{phone:!0}},defaultMessages:{required:"The field is required",email:"Please, type a valid email",maxLength:"The field must contain a maximum of :value characters",minLength:"The field must contain a minimum of :value characters",password:"Password is not valid",remote:"Email already exists",strength:"Password must contents at least one uppercase letter, one lowercase letter and one number",function:"Function returned false"},handlerKeyup:function(e){var t=e.target,n={name:t.getAttribute("data-validate-field"),value:t.value};delete this.result[n.name],this.validateItem({name:n.name,value:n.value,group:[],isKeyupChange:!0}),this.renderErrors()},setterEventListener:function(e,t,n,i){switch("keyup"===t&&(n=this.bindHandlerKeyup),i){case"add":e.addEventListener(t,n);break;case"remove":e.removeEventListener(t,n)}},getElementsRealValue:function(){for(var e=this.$form.querySelectorAll("*"),t=void 0,n={},i=0,r=e.length;i<r;++i)if(t=e[i].getAttribute("name")){if("checkbox"===e[i].type){n[t]=e[i].checked;continue}n[t]=e[i].value}return n},validationFailed:function(){this.invalidFormCallback&&this.invalidFormCallback(this.result);var e=document.querySelector(".js-validate-error-field");this.focusWrongField&&e&&e.focus&&e.focus()},validationSuccess:function(){if(0===Object.keys(this.result).length){if(this.isValidationSuccess=!1,this.submitHandler){var e=this.getElementsRealValue();return void this.submitHandler(this.$form,e,h)}this.$form.submit()}},setForm:function(e){var t=this;this.$form=e,this.$form.setAttribute("novalidate","novalidate"),this.$form.addEventListener("submit",function(e){return e.preventDefault(),t.result=[],t.getElements(),t.promisesRemote.length?void Promise.all(t.promisesRemote).then(function(){t.promisesRemote=[],t.isValidationSuccess?t.validationSuccess():t.validationFailed()}):void(t.isValidationSuccess?t.validationSuccess():t.validationFailed())})},isEmail:function(e){return this.REGEXP.email.test(e)},isZip:function(e){return this.REGEXP.zip.test(e)},isPhone:function(e){return this.REGEXP.phone.test(e)},isPassword:function(e){return this.REGEXP.password.test(e)},isEmpty:function(e){var t=e;return e.trim&&(t=e.trim()),!t},checkLengthMax:function(e,t){return e.length<=t},checkLengthMin:function(e,t){return e.length>=t},checkStrengthPass:function(e){return this.REGEXP.strengthPass.test(e)},getElements:function(){var e=this,t=this.$form.querySelectorAll("[data-validate-field]");this.elements=[];for(var n=function(n,i){var r=t[n],s=r.getAttribute("data-validate-field"),a=r.value,o=!1,l=[];if("checkbox"===r.type&&(a=r.checked||"",r.addEventListener("change",function(t){var n=t.target,i={name:n.getAttribute("data-validate-field"),value:n.checked};delete e.result[i.name],e.validateItem({name:i.name,value:i.value,group:[]}),e.renderErrors()})),"radio"===r.type){var u=e.elements.filter(function(e){if(e.name===s)return e})[0];u?(u.group.push(r.checked),o=!0):l.push(r.checked),r.addEventListener("change",function(t){var n=t.target,i={name:n.getAttribute("data-validate-field"),value:n.checked};delete e.result[i.name],e.validateItem({name:i.name,value:i.value,group:[]}),e.renderErrors()})}e.setterEventListener(r,"keyup",e.handlerKeyup,"add"),o||e.elements.push({name:s,value:a,group:l})},i=0,r=t.length;i<r;++i)n(i);this.validateElements()},validateRequired:function(e){return!this.isEmpty(e)},validateEmail:function(e){return this.isEmail(e)},validatePhone:function(e){return this.isPhone(e)},validateMinLength:function(e,t){return this.checkLengthMin(e,t)},validateMaxLength:function(e,t){return this.checkLengthMax(e,t)},validateStrengthPass:function(e){return this.checkStrengthPass(e)},validatePassword:function(e){return this.isPassword(e)},validateZip:function(e){return this.isZip(e)},validateRemote:function(e){var t=e.value,n=e.name,i=e.url,r=e.successAnswer,s=e.sendParam,a=e.method;return new Promise(function(e){h({url:i,method:a,data:_defineProperty({},s,t),async:!0,callback:function(t){t.toLowerCase()===r.toLowerCase()&&e("ok"),e({type:"incorrect",name:n})},error:function(){e({type:"error",name:n})}})})},generateMessage:function(e,t,n){var i=this.messages||this.defaultMessages,r=i[t]&&i[t][e]||this.messages&&"string"==typeof this.messages[t]&&i[t]||this.defaultMessages[e]||this.DEFAULT_REMOTE_ERROR;n&&(r=r.replace(":value",n.toString())),this.result[t]={message:r}},validateElements:function(){var e=this;return this.lockForm(),this.elements.forEach(function(t){e.validateItem({name:t.name,value:t.value,group:t.group})}),this.promisesRemote.length?void Promise.all(this.promisesRemote).then(function(t){t.forEach(function(t){return"ok"===t?void e.renderErrors():("error"===t.type&&alert("Server error occured. Please try later."),e.generateMessage(o,t.name),void e.renderErrors())})}):void this.renderErrors()},validateItem:function(e){var c=this,h=e.name,d=e.group,f=e.value,p=e.isKeyupChange,m=this.rules[h]||this.defaultRules[h]||!1;if(m)for(var g in m){var v=m[g];if(g!==t&&g!==u&&""==f)return;switch(g){case u:if("function"!=typeof v)break;if(v(h,f))break;return void this.generateMessage(u,h,v);case t:if(!v)break;if(d.length){var y=!1;if(d.forEach(function(e){c.validateRequired(e)&&(y=!0)}),y)break}else if(this.validateRequired(f))break;return void this.generateMessage(t,h);case n:if(!v)break;if(this.validateEmail(f))break;return void this.generateMessage(n,h);case i:if(!v)break;if(this.validateMinLength(f,v))break;return void this.generateMessage(i,h,v);case r:if(!v)break;if(this.validateMaxLength(f,v))break;return void this.generateMessage(r,h,v);case a:if(!v)break;if(this.validatePhone(f))break;return void this.generateMessage(a,h);case s:if(!v)break;if(this.validatePassword(f))break;return void this.generateMessage(s,h);case l:if(!v||"object"!==(void 0===v?"undefined":_typeof(v)))break;if(v.default&&this.validateStrengthPass(f))break;if(v.custom){var b=void 0;try{b=new RegExp(v.custom)}catch(e){b=this.REGEXP.strengthPass,console.error("Custom regexp for strength rule is not valid. Default regexp was used.")}if(b.test(f))break}return void this.generateMessage(l,h);case"zip":if(!v)break;if(this.validateZip(f))break;return void this.generateMessage("zip",h);case o:if(p)break;if(!v)break;var _=v.url,x=v.successAnswer,w=v.method,k=v.sendParam,T=this.$form.querySelector('input[data-validate-field="'+h+'"]');return this.setterEventListener(T,"keyup",this.handlerKeyup,"remove"),void this.promisesRemote.push(this.validateRemote({name:h,value:f,url:_,method:w,sendParam:k,successAnswer:x}))}}},clearErrors:function(){for(var e=document.querySelectorAll(".js-validate-error-label"),t=0,n=e.length;t<n;++t)e[t].remove();for(var i=0,r=(e=document.querySelectorAll(".js-validate-error-field")).length;i<r;++i)e[i].classList.remove("js-validate-error-field"),e[i].style.border="",e[i].style.color=""},renderErrors:function(){var e=this;if(this.clearErrors(),this.unlockForm(),this.isValidationSuccess=!1,0!==Object.keys(this.result).length){for(var t in this.result){var n=this.result[t].message,i=this.$form.querySelectorAll('[data-validate-field="'+t+'"]'),r=i[i.length-1],s=document.createElement("div");if(s.innerHTML=n,s.className="js-validate-error-label",s.setAttribute("style","color: "+this.colorWrong),r.style.border="1px solid "+this.colorWrong,r.style.color=""+this.colorWrong,r.classList.add("js-validate-error-field"),"checkbox"===r.type||"radio"===r.type){var a=document.querySelector('label[for="'+r.getAttribute("id")+'"]');"label"===r.parentNode.tagName.toLowerCase()?r.parentNode.parentNode.insertBefore(s,null):a?a.parentNode.insertBefore(s,a.nextSibling):r.parentNode.insertBefore(s,r.nextSibling)}else r.parentNode.insertBefore(s,r.nextSibling)}this.tooltipSelectorWrap.length&&(this.state.tooltipsTimer=setTimeout(function(){e.hideTooltips()},this.tooltipFadeOutTime))}else this.isValidationSuccess=!0},hideTooltips:function(){var e=this;document.querySelectorAll(".js-validate-error-label").forEach(function(t){t.classList.add(e.tooltipFadeOutClass)}),this.state.tooltipsTimer=null},lockForm:function(){for(var e=this.$form.querySelectorAll("input, textarea, button, select"),t=0,n=e.length;t<n;++t)e[t].setAttribute("disabled","disabled"),e[t].style.pointerEvents="none",e[t].style.webitFilter="grayscale(100%)",e[t].style.filter="grayscale(100%)"},unlockForm:function(){for(var e=this.$form.querySelectorAll("input, textarea, button, select"),t=0,n=e.length;t<n;++t)e[t].removeAttribute("disabled"),e[t].style.pointerEvents="",e[t].style.webitFilter="",e[t].style.filter=""}},e.JustValidate=d}(window),function(){var e={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform float opacity;\n\n\t\tuniform sampler2D tDiffuse;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec4 texel = texture2D( tDiffuse, vUv );\n\t\t\tgl_FragColor = opacity * texel;\n\n\t\t}"};THREE.CopyShader=e}(),function(){const e=new THREE.OrthographicCamera(-1,1,1,-1,0,1),t=new THREE.BufferGeometry;t.setAttribute("position",new THREE.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),t.setAttribute("uv",new THREE.Float32BufferAttribute([0,2,0,0,2,0],2));THREE.EffectComposer=class{constructor(e,t){if(this.renderer=e,void 0===t){const n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat},i=e.getSize(new THREE.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(t=new THREE.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,n)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===THREE.ShaderPass&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader),this.clock=new THREE.Clock}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let t=0,i=this.passes.length;t<i;t++){const i=this.passes[t];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),i.needsSwap){if(n){const t=this.renderer.getContext(),n=this.renderer.state.buffers.stencil;n.setFunc(t.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),n.setFunc(t.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==THREE.MaskPass&&(i instanceof THREE.MaskPass?n=!0:i instanceof THREE.ClearMaskPass&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){const t=this.renderer.getSize(new THREE.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}},THREE.FullScreenQuad=class{constructor(e){this._mesh=new THREE.Mesh(t,e)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,e)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},THREE.Pass=class{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}}(),function(){const e={uniforms:{tDiffuse:{value:null},amount:{value:.005},angle:{value:0}},vertexShader:"\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvUv = uv;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t}",fragmentShader:"\n\n\t\tuniform sampler2D tDiffuse;\n\t\tuniform float amount;\n\t\tuniform float angle;\n\n\t\tvarying vec2 vUv;\n\n\t\tvoid main() {\n\n\t\t\tvec2 offset = amount * vec2( cos(angle), sin(angle));\n\t\t\tvec4 cr = texture2D(tDiffuse, vUv + offset);\n\t\t\tvec4 cga = texture2D(tDiffuse, vUv);\n\t\t\tvec4 cb = texture2D(tDiffuse, vUv - offset);\n\t\t\tgl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);\n\n\t\t}"};THREE.RGBShiftShader=e}(),function(){THREE.RenderPass=class extends THREE.Pass{constructor(e,t,n,i,r){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=void 0!==r?r:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new THREE.Color}render(e,t,n){const i=e.autoClear;let r,s;e.autoClear=!1,void 0!==this.overrideMaterial&&(s=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=s),e.autoClear=i}}}(),function(){THREE.ShaderPass=class extends THREE.Pass{constructor(e,t){super(),this.textureID=void 0!==t?t:"tDiffuse",e instanceof THREE.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new THREE.FullScreenQuad(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}}();